__NUXT_JSONP__("/blog/2015/11/recover-discourse-backup-change-domain-name", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){return {data:[{},{},{},{canonical:u,content:{title:"Recover Discourse from a backup, adjust domain name",locale:r,created:"2015-11-20T00:00:00.000Z",updated:"2023-02-18T00:00:00.000Z",canonical:u,status:"publish",revising:q,migrateLinks:true,migrateImages:q,gallery:q,caption:q,categories:[v],tags:["procedure","operations","docker","webplatform"],keywords:["Discourse","DNS","migration"],coverImage:{src:w,text:x},preamble:{text:y},excerpt:"Here is some preliminary notes on how one can restore a Discourse instance and change the domain name.",toc:[],body:{type:s,children:[{type:b,tag:d,props:{},children:[{type:a,value:"Roughly based on "},{type:b,tag:f,props:{href:z,rel:[g,h,i],target:j},children:[{type:a,value:A}]},{type:a,value:" post.\nBut without using the web UI. Because sysadmins prefers terminal."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:t,props:{},children:[{type:a,value:"IMPORTANT"}]},{type:a,value:": Make "},{type:b,tag:t,props:{},children:[{type:a,value:"SURE"}]},{type:a,value:" the backup dump was generated from the same\nDiscourse version the one you'll import it into."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Copy from host backup into shared folder. Imagine you uploaded via SSH in your\nhost home directory."}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:e,props:{},children:[{type:b,tag:B,props:{className:[C,D]},children:[{type:a,value:"cp"}]},{type:a,value:" ~\u002Fsnapshot.tar.gz \u002Fsrv\u002Fwebplatform\u002Fshared\u002Fbackups\u002F\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Note that the folder "},{type:b,tag:e,props:{},children:[{type:a,value:"\u002Fsrv\u002Fwebplatform\u002Fdiscuss\u002Fshared\u002Fstandalone\u002Fbackups\u002F"}]},{type:a,value:" from\nthe docker host would end up to be in "},{type:b,tag:e,props:{},children:[{type:a,value:"\u002Fshared\u002Fbackups\u002F"}]},{type:a,value:" inside the container."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Enter the VM, make sure enable_restore is run from "},{type:b,tag:e,props:{},children:[{type:a,value:"discourse"}]},{type:a,value:" cli utility"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:e,props:{},children:[{type:a,value:".\u002Flauncher enter app\ndiscourse enable_restore\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Find the mounted backup file from within the container"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:e,props:{},children:[{type:a,value:"ll \u002Fshared\u002Fbackups\u002Fdefault\u002F\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Make sure "},{type:b,tag:e,props:{},children:[{type:a,value:"\u002Fshared\u002Fbackups\u002Ffoo.tar.gz"}]},{type:a,value:" is readable by can read"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:e,props:{},children:[{type:b,tag:B,props:{className:[C,D]},children:[{type:a,value:"chmod"}]},{type:a,value:" o+r \u002Fshared\u002Fbackups\u002Fdefault\u002Ffoo.tar.gz\ndiscourse restore foo.tar.gz\ndiscourse disable_restore\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Remap domain name"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:e,props:{},children:[{type:a,value:"discourse remap discourse.specifiction.org discuss.webplatform.org\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Then, work on user uploads and regenerate assets. That'll make sure ;"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:e,props:{},children:[{type:a,value:"rake uploads:clean_up\nrake posts:rebake\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Refer to"}]},{type:a,value:c},{type:b,tag:"ul",props:{},children:[{type:a,value:c},{type:b,tag:p,props:{},children:[{type:b,tag:f,props:{href:E,rel:[g,h,i],target:j},children:[{type:a,value:E}]}]},{type:a,value:c},{type:b,tag:p,props:{},children:[{type:b,tag:t,props:{},children:[{type:a,value:"Most helpful post"}]},{type:a,value:" "},{type:b,tag:f,props:{href:z,rel:[g,h,i],target:j},children:[{type:a,value:A}]}]},{type:a,value:c},{type:b,tag:p,props:{},children:[{type:b,tag:f,props:{href:F,rel:[g,h,i],target:j},children:[{type:a,value:F}]},{type:a,value:", and\nthe "},{type:b,tag:f,props:{href:"https:\u002F\u002Fgithub.com\u002Fdiscourse\u002Fdiscourse\u002Fblob\u002Fmaster\u002Fconfig\u002Fnginx.sample.conf",rel:[g,h,i],target:j},children:[{type:a,value:"referenced NGINX configuration in Discourse GitHub repo"}]}]},{type:a,value:c},{type:b,tag:p,props:{},children:[{type:b,tag:f,props:{href:G,rel:[g,h,i],target:j},children:[{type:a,value:G}]}]},{type:a,value:c},{type:b,tag:p,props:{},children:[{type:b,tag:f,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fops\u002Fissues\u002F152",rel:[g,h,i],target:j},children:[{type:a,value:"Work notes on WebPlatform GitHub issue tracker"}]}]},{type:a,value:c}]},{type:a,value:c}]},text:"---\ntitle: Recover Discourse from a backup, adjust domain name\nlocale: en-CA\ncreated: 2015-11-20\nupdated: 2023-02-18\ncanonical: \u003E-\n  https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F11\u002Frecover-discourse-backup-change-domain-name\u002F\nstatus: publish\nrevising: false\nmigrateLinks: true\nmigrateImages: false\ngallery: false\ncaption: false\ncategories:\n  - experiments\ntags:\n  - procedure\n  - operations\n  - docker\n  - webplatform\nkeywords:\n  - Discourse\n  - DNS\n  - migration\ncoverImage:\n  src: ~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F11\u002Fdiscourse_migration_list_gravatar_images.png\n  text: |\n    Side by side comparison while working on migrating Discourse\n    with WICG\npreamble:\n  text: |\n    This was written at the time I was closing loops at the [end of my time with the W3C][leaving-w3c].\n    The intent at the time (before WebPlatform project closed was to host *discuss.webplatform.org* what is now known as [W3C’s Web Platform Incubator Community Group (WICG)][wicg-article] and is available as [discourse.wicg.io][wicg]\n    [leaving-w3c]: \u002Fblog\u002F2015\u002F07\u002Fleaving-w3c\u002F \"Leaving W3C\"\n    [wicg]: https:\u002F\u002Fdiscourse.wicg.io\u002F\n    [wicg-article]: https:\u002F\u002Fwww.w3.org\u002Fblog\u002F2015\u002F07\u002Fwicg\u002F\nexcerpt: \u003E-\n  Here is some preliminary notes on how one can restore a Discourse instance and\n  change the domain name.\n---\n\nRoughly based on [Move your Discourse instance to a different server][0] post.\nBut without using the web UI. Because sysadmins prefers terminal.\n\n**IMPORTANT**: Make **SURE** the backup dump was generated from the same\nDiscourse version the one you'll import it into.\n\nCopy from host backup into shared folder. Imagine you uploaded via SSH in your\nhost home directory.\n\n```bash\ncp ~\u002Fsnapshot.tar.gz \u002Fsrv\u002Fwebplatform\u002Fshared\u002Fbackups\u002F\n```\n\nNote that the folder `\u002Fsrv\u002Fwebplatform\u002Fdiscuss\u002Fshared\u002Fstandalone\u002Fbackups\u002F` from\nthe docker host would end up to be in `\u002Fshared\u002Fbackups\u002F` inside the container.\n\nEnter the VM, make sure enable_restore is run from `discourse` cli utility\n\n```bash\n.\u002Flauncher enter app\ndiscourse enable_restore\n```\n\nFind the mounted backup file from within the container\n\n```bash\nll \u002Fshared\u002Fbackups\u002Fdefault\u002F\n```\n\nMake sure `\u002Fshared\u002Fbackups\u002Ffoo.tar.gz` is readable by can read\n\n```bash\nchmod o+r \u002Fshared\u002Fbackups\u002Fdefault\u002Ffoo.tar.gz\ndiscourse restore foo.tar.gz\ndiscourse disable_restore\n```\n\nRemap domain name\n\n```bash\ndiscourse remap discourse.specifiction.org discuss.webplatform.org\n```\n\nThen, work on user uploads and regenerate assets. That'll make sure ;\n\n```bash\nrake uploads:clean_up\nrake posts:rebake\n```\n\nRefer to\n\n- https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fchange-the-domain-name-or-rename-my-discourse\u002F16098\n- **Most helpful post** [Move your Discourse instance to a different server][0]\n- https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmultisite-configuration-with-docker\u002F14084\u002F32, and\n  the [referenced NGINX configuration in Discourse GitHub repo][1]\n- https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmultisite-configuration-with-docker\u002F14084\u002F8\n- [Work notes on WebPlatform GitHub issue tracker][2]\n\n\u003C!--#TODO-Improve-Code-Blocks--\u003E\n\n[0]:\n  https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmove-your-discourse-instance-to-a-different-server\u002F15721\n[1]: https:\u002F\u002Fgithub.com\u002Fdiscourse\u002Fdiscourse\u002Fblob\u002Fmaster\u002Fconfig\u002Fnginx.sample.conf\n[2]: https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fops\u002Fissues\u002F152\n\n",dir:"\u002Fblog\u002F2015\u002F11",path:"\u002Fblog\u002F2015\u002F11\u002Frecover-discourse-backup-change-domain-name",extension:".md",slug:H,createdAt:I,updatedAt:I,category:v},coverImage:{toc:[],body:{type:s,children:[{type:b,tag:d,props:{},children:[{type:a,value:"Side by side comparison while working on migrating Discourse\nwith WICG"}]}]},text:x,src:w},month:"11",next:{title:"Things I’ve worked on in the last two years while maintaining WebPlatform.org",locale:r,path:"\u002Fblog\u002F2017\u002F02\u002Fthings-i-ve-worked-on-while-maintaining-webplatform-org",slug:"things-i-ve-worked-on-while-maintaining-webplatform-org"},preamble:{toc:[],body:{type:s,children:[{type:b,tag:d,props:{},children:[{type:a,value:"This was written at the time I was closing loops at the "},{type:b,tag:"nuxt-link",props:{title:"Leaving W3C",to:"\u002Fblog\u002F2015\u002F07\u002Fleaving-w3c\u002F"},children:[{type:a,value:"end of my time with the W3C"}]},{type:a,value:".\nThe intent at the time (before WebPlatform project closed was to host "},{type:b,tag:"em",props:{},children:[{type:a,value:"discuss.webplatform.org"}]},{type:a,value:" what is now known as "},{type:b,tag:f,props:{href:"https:\u002F\u002Fwww.w3.org\u002Fblog\u002F2015\u002F07\u002Fwicg\u002F",rel:[g,h,i],target:j},children:[{type:a,value:"W3C’s Web Platform Incubator Community Group (WICG)"}]},{type:a,value:" and is available as "},{type:b,tag:f,props:{href:"https:\u002F\u002Fdiscourse.wicg.io\u002F",rel:[g,h,i],target:j},children:[{type:a,value:"discourse.wicg.io"}]}]}]},text:y},prettyfiedTemporalDate:{prettified:"Friday, November 20, 2015",temporalDate:"2015-11-20"},prev:{title:"Thoughts about improving load resiliency for CMS driven Websites",locale:r,path:"\u002Fblog\u002F2015\u002F08\u002Fthoughts-improving-load-resiliency-cms-driven-websites",slug:"thoughts-improving-load-resiliency-cms-driven-websites"},slug:H,year:"2015"}],fetch:[],mutations:void 0}}("text","element","\n","p","code","a","nofollow","noopener","noreferrer","_blank","div","nuxt-content-highlight","pre","language-bash","line-numbers","li",false,"en-CA","root","strong","https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F11\u002Frecover-discourse-backup-change-domain-name\u002F","experiments","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F11\u002Fdiscourse_migration_list_gravatar_images.png","Side by side comparison while working on migrating Discourse\nwith WICG\n","This was written at the time I was closing loops at the [end of my time with the W3C][leaving-w3c].\nThe intent at the time (before WebPlatform project closed was to host *discuss.webplatform.org* what is now known as [W3C’s Web Platform Incubator Community Group (WICG)][wicg-article] and is available as [discourse.wicg.io][wicg]\n[leaving-w3c]: \u002Fblog\u002F2015\u002F07\u002Fleaving-w3c\u002F \"Leaving W3C\"\n[wicg]: https:\u002F\u002Fdiscourse.wicg.io\u002F\n[wicg-article]: https:\u002F\u002Fwww.w3.org\u002Fblog\u002F2015\u002F07\u002Fwicg\u002F\n","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmove-your-discourse-instance-to-a-different-server\u002F15721","Move your Discourse instance to a different server","span","token","function","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fchange-the-domain-name-or-rename-my-discourse\u002F16098","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmultisite-configuration-with-docker\u002F14084\u002F32","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmultisite-configuration-with-docker\u002F14084\u002F8","recover-discourse-backup-change-domain-name","2024-10-24T19:50:04.935Z")));