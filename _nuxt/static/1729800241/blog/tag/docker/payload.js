__NUXT_JSONP__("/blog/tag/docker", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx){return {data:[{},{},{contents:[{title:"Recover Discourse from a backup, adjust domain name",locale:aA,created:"2015-11-20T00:00:00.000Z",updated:aB,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F11\u002Frecover-discourse-backup-change-domain-name\u002F",status:aC,revising:ab,migrateLinks:ac,migrateImages:ab,gallery:ab,caption:ab,categories:[aD],tags:[aE,aF,J,aG],keywords:["Discourse","DNS","migration"],coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F11\u002Fdiscourse_migration_list_gravatar_images.png",text:"Side by side comparison while working on migrating Discourse\nwith WICG\n"},preamble:{text:"This was written at the time I was closing loops at the [end of my time with the W3C][leaving-w3c].\nThe intent at the time (before WebPlatform project closed was to host *discuss.webplatform.org* what is now known as [W3C’s Web Platform Incubator Community Group (WICG)][wicg-article] and is available as [discourse.wicg.io][wicg]\n[leaving-w3c]: \u002Fblog\u002F2015\u002F07\u002Fleaving-w3c\u002F \"Leaving W3C\"\n[wicg]: https:\u002F\u002Fdiscourse.wicg.io\u002F\n[wicg-article]: https:\u002F\u002Fwww.w3.org\u002Fblog\u002F2015\u002F07\u002Fwicg\u002F\n"},excerpt:"Here is some preliminary notes on how one can restore a Discourse instance and change the domain name.",toc:[],body:{type:ad,children:[{type:b,tag:f,props:{},children:[{type:a,value:"Roughly based on "},{type:b,tag:m,props:{href:aH,rel:[v,w,x],target:y},children:[{type:a,value:aI}]},{type:a,value:" post.\nBut without using the web UI. Because sysadmins prefers terminal."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:K,props:{},children:[{type:a,value:"IMPORTANT"}]},{type:a,value:": Make "},{type:b,tag:K,props:{},children:[{type:a,value:"SURE"}]},{type:a,value:" the backup dump was generated from the same\nDiscourse version the one you'll import it into."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Copy from host backup into shared folder. Imagine you uploaded via SSH in your\nhost home directory."}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[s,p]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aJ}]},{type:a,value:" ~\u002Fsnapshot.tar.gz \u002Fsrv\u002Fwebplatform\u002Fshared\u002Fbackups\u002F\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Note that the folder "},{type:b,tag:g,props:{},children:[{type:a,value:"\u002Fsrv\u002Fwebplatform\u002Fdiscuss\u002Fshared\u002Fstandalone\u002Fbackups\u002F"}]},{type:a,value:" from\nthe docker host would end up to be in "},{type:b,tag:g,props:{},children:[{type:a,value:"\u002Fshared\u002Fbackups\u002F"}]},{type:a,value:" inside the container."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Enter the VM, make sure enable_restore is run from "},{type:b,tag:g,props:{},children:[{type:a,value:"discourse"}]},{type:a,value:" cli utility"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[s,p]},children:[{type:b,tag:g,props:{},children:[{type:a,value:".\u002Flauncher enter app\ndiscourse enable_restore\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Find the mounted backup file from within the container"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[s,p]},children:[{type:b,tag:g,props:{},children:[{type:a,value:"ll \u002Fshared\u002Fbackups\u002Fdefault\u002F\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Make sure "},{type:b,tag:g,props:{},children:[{type:a,value:"\u002Fshared\u002Fbackups\u002Ffoo.tar.gz"}]},{type:a,value:" is readable by can read"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[s,p]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"chmod"}]},{type:a,value:" o+r \u002Fshared\u002Fbackups\u002Fdefault\u002Ffoo.tar.gz\ndiscourse restore foo.tar.gz\ndiscourse disable_restore\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Remap domain name"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[s,p]},children:[{type:b,tag:g,props:{},children:[{type:a,value:"discourse remap discourse.specifiction.org discuss.webplatform.org\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Then, work on user uploads and regenerate assets. That'll make sure ;"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[s,p]},children:[{type:b,tag:g,props:{},children:[{type:a,value:"rake uploads:clean_up\nrake posts:rebake\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Refer to"}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:m,props:{href:aK,rel:[v,w,x],target:y},children:[{type:a,value:aK}]}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:K,props:{},children:[{type:a,value:"Most helpful post"}]},{type:a,value:h},{type:b,tag:m,props:{href:aH,rel:[v,w,x],target:y},children:[{type:a,value:aI}]}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:m,props:{href:aL,rel:[v,w,x],target:y},children:[{type:a,value:aL}]},{type:a,value:", and\nthe "},{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Fdiscourse\u002Fdiscourse\u002Fblob\u002Fmaster\u002Fconfig\u002Fnginx.sample.conf",rel:[v,w,x],target:y},children:[{type:a,value:"referenced NGINX configuration in Discourse GitHub repo"}]}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:m,props:{href:aM,rel:[v,w,x],target:y},children:[{type:a,value:aM}]}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fops\u002Fissues\u002F152",rel:[v,w,x],target:y},children:[{type:a,value:"Work notes on WebPlatform GitHub issue tracker"}]}]},{type:a,value:e}]},{type:a,value:e}]},dir:"\u002Fblog\u002F2015\u002F11",path:"\u002Fblog\u002F2015\u002F11\u002Frecover-discourse-backup-change-domain-name",extension:aN,slug:"recover-discourse-backup-change-domain-name",createdAt:aO,updatedAt:aO,category:aD,prettyfiedTemporalDate:{prettified:"Friday, November 20, 2015",temporalDate:"2015-11-20"}},{title:"Run a NodeJS process through forever from within a Docker container",locale:aA,created:"2015-05-12T00:00:00.000Z",updated:aB,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F05\u002Frun-nodejs-process-forever-within-docker-container\u002F",status:aC,revising:ac,migrateLinks:ac,categories:[aP],tags:["linux",J,"open-source",aF,aE,aG],coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-spec-rangefinder.png",alt:"Screen capture of the RangeFinder API using Publican",text:"Specification Document for RangeFinder API\n"},excerpt:"I’ve recently been through the steps to make a NodeJS web app to run from inside a Docker container. The objective of this project was to simplify the deployment of a web app that had many moving parts by making it a re-deployable service that is self-contained.",preamble:{disable:ac,text:h},toc:[{id:aQ,depth:2,text:"Run publican inside Docker"},{id:aR,depth:al,text:aS},{id:aT,depth:al,text:aU},{id:aV,depth:al,text:aW}],body:{type:ad,children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"One of the components that I worked on "},{type:b,tag:"nuxt-link",props:{to:"\u002Fblog\u002Ftag\u002Fwebplatform-docs"},children:[{type:a,value:"during my time on the WebPlatform\nproject"}]},{type:a,value:aX},{type:b,tag:m,props:{href:am,rel:[v,w,x],target:y},children:[{type:a,value:an}]},{type:a,value:", that I had to manage has many moving parts. The\nend product of that component is basically static HTML documents that ends up on\n"},{type:b,tag:m,props:{href:"https:\u002F\u002Fspecs.webplatform.org\u002F",rel:[v,w,x],target:y},children:[{type:a,value:"specs.webplatform.org"}]},{type:a,value:ao}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Since we need to have many packages installed in very specific version, and\nautomating the installation wouldn't bring any more benefit than being\nself-contained, I thought it would be best to go through the steps of converting\nit into a Docker container."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"The following is a procedure I wrote to teach "},{type:b,tag:m,props:{href:"https:\u002F\u002Fwww.w3.org\u002Fstaff\u002Falumni\u002F#robin-berjon",rel:[v,w,x],target:y},children:[{type:a,value:"my colleague"}]},{type:a,value:aX},{type:b,tag:m,props:{href:"https:\u002F\u002Fberjon.com\u002F",rel:[v,w,x],target:y},children:[{type:a,value:"Robin\nBerjon"}]},{type:a,value:", how to run his system called "},{type:b,tag:m,props:{href:am,rel:[v,w,x],target:y},children:[{type:a,value:an}]},{type:a,value:" from within a Docker\ncontainer. Publican is basically a GitHub hook listener that generates specs\nwritten to be parsed by "},{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Fw3c\u002Frespec",rel:[v,w,x],target:y},children:[{type:a,value:"ReSpec"}]},{type:a,value:ap},{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Ftabatkins\u002Fbikeshed",rel:[v,w,x],target:y},children:[{type:a,value:"Bikeshed"}]}]},{type:a,value:e},{type:b,tag:"h2",props:{id:aQ},children:[{type:b,tag:m,props:{href:"#run-publican-inside-docker",ariaHidden:N,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:"Run "},{type:b,tag:U,props:{},children:[{type:a,value:"publican"}]},{type:a,value:" inside Docker"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"What this'll do is basically build a VM that'll run a Docker container. The\ncontainer will write in files outside of it."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"You'll quickly notice that the paths will look the same, its confusing, sorry\nabout that. Fortunately for us, the paths in the procedure are the ones that\nwill be mounted through Docker Volume (the "},{type:b,tag:g,props:{},children:[{type:a,value:V}]},{type:a,value:" option when you call "},{type:b,tag:g,props:{},children:[{type:a,value:J}]},{type:a,value:")\nand will, in the end, be the same files."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Once you have a Docker container running on a VM, it'll replicate how a\nproduction VM will run the tasks. Since we know where the container will write\nfiles, we'll have our frontend servers to forward requests to publican, and\nserve files it generated."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Doing all this removes the need to do any rsync. NGINX within the VM that'll run\nDocker will take care of serving static files, and frontend server will expose\nit to the public."}]},{type:a,value:e},{type:b,tag:aq,props:{id:aR},children:[{type:b,tag:m,props:{href:"#steps",ariaHidden:N,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:aS}]},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Have "},{type:b,tag:m,props:{href:"https:\u002F\u002Fwww.vagrantup.com\u002F",rel:[v,w,x],target:y},children:[{type:a,value:"Vagrant"}]},{type:a,value:" and "},{type:b,tag:m,props:{href:"https:\u002F\u002Fwww.virtualbox.org\u002F",rel:[v,w,x],target:y},children:[{type:a,value:"VirtualBox"}]},{type:a,value:" installed"}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Follow what's in "},{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Frenoirb\u002Fsalt-basesystem",rel:[v,w,x],target:y},children:[{type:a,value:"renoirb\u002Fsalt-basesystem README.md"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Make sure you follow "},{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Frenoirb\u002Fsalt-basesystem#vagrant-sandbox-utilities",rel:[v,w,x],target:y},children:[{type:a,value:"Vagrant Sandbox utilities"}]},{type:a,value:" part"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:aY},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aZ}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:ar}]},{type:a,value:" salt-call state.highstate\n "},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:ar}]},{type:a,value:" salt-call state.sls vagrantsandbox.docker\n "},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:as}]},{type:a,value:e}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Reboot the VM by doing "},{type:b,tag:g,props:{},children:[{type:a,value:"vagrant reload"}]}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:" vagrant reload\n"}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:K,props:{},children:[{type:a,value:"No need"}]},{type:a,value:" to follow what's in "},{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fpublican\u002Fblob\u002Ftask-based-docker\u002FDOCKER.md",rel:[v,w,x],target:y},children:[{type:a,value:"webplatform\u002Fpublican DOCKER.md file"}]},{type:a,value:".\nThose are notes to show how to build a container. For this time, we'll "},{type:b,tag:m,props:{href:"https:\u002F\u002Fregistry.hub.docker.com\u002Fu\u002Fwebspecs\u002Fpublican\u002F",rel:[v,w,x],target:y},children:[{type:a,value:"use a\ncontainer I already built and pushed on "},{type:b,tag:K,props:{},children:[{type:a,value:"Docker hub"}]}]},{type:a,value:"!"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Setup what's required to run the container"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:aY},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aZ}]},{type:a,value:e}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Prepare the folders;"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:h},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:ar}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:"-s"}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:a$}]},{type:a,value:" webapps\n "},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"id"}]},{type:a,value:e}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"You should see"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,"language-text"]},children:[{type:b,tag:g,props:{},children:[{type:a,value:" uid=990(webapps) gid=990(webapps) groups=990(webapps),33(www-data),998(docker)\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Prepare the folders"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:h},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:af}]},{type:a,value:" \u002Fsrv\u002Fwebapps "},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:at}]},{type:a,value:" publican\u002Fdata "},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:af}]},{type:a,value:" publican\n"}]}]}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"If all went well so far; you should be able to do "},{type:b,tag:g,props:{},children:[{type:a,value:"docker ps"}]},{type:a,value:" as the\n"},{type:b,tag:g,props:{},children:[{type:a,value:"webapps"}]},{type:a,value:" user. Otherwise reboot and\u002For run "},{type:b,tag:g,props:{},children:[{type:a,value:"salt-call"}]},{type:a,value:" with both\n"},{type:b,tag:g,props:{},children:[{type:a,value:"state.highstate"}]},{type:a,value:h},{type:b,tag:g,props:{},children:[{type:a,value:"state.sls vagrantsandbox.docker"}]},{type:a,value:" states. There should be\nnothing left to do."}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:J}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"ps"}]},{type:a,value:"\n\nCONTAINER ID IMAGE COMMAND CREATED\n"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:".."}]},{type:a,value:".\n"}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Pull the publican Docker image I built (it'll take about 10 minutes)"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:h},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:J}]},{type:a,value:" pull webspecs\u002Fpublican:wip\n"}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:"Copy the other files in this Gist in your local coputer where you cloned the\n"},{type:b,tag:K,props:{},children:[{type:a,value:"salt-basesystem"}]},{type:a,value:" repository. From that folder you can move them inside the\nVagrant VM where you need."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Copy publican config"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:h},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aJ}]},{type:a,value:" \u002Fvagrant\u002Fconfig.json data\u002F\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:"del",props:{},children:[{type:a,value:"Download Bikeshed stuff that i didn't figure out yet what's important to\nkeep, extract it in "},{type:b,tag:g,props:{},children:[{type:a,value:"\u002Fsrv\u002Fwebapps\u002Fpublican\u002Fspec-data\u002F"}]}]},{type:a,value:ao}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:"rb-notice-box",props:{className:["my-5"],variant:"info"},children:[{type:a,value:e},{type:b,tag:K,props:{slot:"header"},children:[{type:a,value:"Archive mentioned no longer exists"}]},{type:a,value:"\nThe archive used in the initial procedure no longer exists, it was a series of W3C specification Git repository working copies that Publican was expecting.\n"}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"You can open up another terminal session and connect to the Vagrant VM\n"},{type:b,tag:g,props:{},children:[{type:a,value:"vagrant ssh"}]},{type:a,value:" (e.g. if you don't use "},{type:b,tag:g,props:{},children:[{type:a,value:"tmux"}]},{type:a,value:ap},{type:b,tag:g,props:{},children:[{type:a,value:"screen"}]},{type:a,value:W}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:at}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:X}]},{type:a,value:" spec-data\u002Freadonly\u002F\n"},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:at}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:X}]},{type:a,value:" data\u002F"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Y}]},{type:a,value:"gits,logs,publish,queue,temp"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Z}]},{type:a,value:e}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Run the container"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:J}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:av}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:aw}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:V}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ag},{type:b,tag:c,props:{className:[d,i]},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:ai}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]}]},{type:a,value:ba}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:z}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:V}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ag},{type:b,tag:c,props:{className:[d,i]},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:ai}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]}]},{type:a,value:bc}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:z}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:X}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:ax}]},{type:a,value:be}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"If you see the following, you're in the Docker container!!"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:"webapps@2f33f5c6e183:~$\n"}]}]}]},{type:a,value:e},{type:b,tag:S,props:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-init.png",alt:"A terminal window with a few commands and a build process status and green lines, no errors",figcaption:h},children:[{type:a,value:"\n  Launching the container\n"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Initiate the empty shell we just created (it'll create stuff in the "},{type:b,tag:g,props:{},children:[{type:a,value:"data\u002F"}]},{type:a,value:"\nfolder "},{type:b,tag:U,props:{},children:[{type:a,value:bf}]},{type:a,value:" of the container)"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:"publican.js init\n"}]}]}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:bg},{type:b,tag:U,props:{},children:[{type:a,value:"Launching the container"}]},{type:a,value:bh}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Once done, exit the container. Notice that by doing this, you lose the state\nof the VM and anything that has been written in the container. But, since we\nuse volumes (notice the "},{type:b,tag:g,props:{},children:[{type:a,value:"-v \u002Fhost\u002Fpath:\u002Fcontainer\u002Fpath"}]},{type:a,value:"), we actually wrote\n"},{type:b,tag:U,props:{},children:[{type:a,value:bf}]},{type:a,value:" of the container."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"We can "},{type:b,tag:K,props:{},children:[{type:a,value:"exit the container"}]}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:a,value:h},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:as}]},{type:a,value:e}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"At this stage, we had publican and bikeshed to generate files (we may call\nthis a \"cache warmup\" of softs). Now, let's prepare the Vagrant VM to serve\nthe static content. Notice that the next commands are there only for the\npurpose of a local workspace, in production this step will also be managed\nautomatically."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Let's get back as the "},{type:b,tag:K,props:{},children:[{type:a,value:ad}]},{type:a,value:" user, and create a quick web server;"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:as}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"apt-get"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:"-yqq"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"install"}]},{type:a,value:"\nnginx "},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"mv"}]},{type:a,value:" \u002Fvagrant\u002Fdefault.conf \u002Fetc\u002Fnginx\u002Fsites-available\u002Fdefault\n"},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"service"}]},{type:a,value:" restart nginx\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Let's return back to "},{type:b,tag:K,props:{},children:[{type:a,value:"as the webapps user and launch the runner"}]}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:a$}]},{type:a,value:" webapps "},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:af}]},{type:a,value:" \u002Fsrv\u002Fwebapps\u002Fpublican\u002F\n"}]}]}]},{type:a,value:e},{type:b,tag:S,props:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-run-hook.png",alt:"A terminal window with a build process status and green lines, no errors",figcaption:h},children:[{type:a,value:"\nStarting a build process\n"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:K,props:{},children:[{type:a,value:bi}]},{type:a,value:"; this will also be managed automatically in\nproduction."}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,"language-shell"]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:J}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:av}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:aw}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:V}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ag},{type:b,tag:c,props:{className:[d,i]},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:ai}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]}]},{type:a,value:ba}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:z}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:V}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ag},{type:b,tag:c,props:{className:[d,i]},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:ai}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]}]},{type:a,value:bc}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:z}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:X}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:ax}]},{type:a,value:be}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:bg},{type:b,tag:U,props:{},children:[{type:a,value:bi}]},{type:a,value:bh}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"get your Vagrant VM IP address"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"ifconfig"}]},{type:a,value:e}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Should start by "},{type:b,tag:g,props:{},children:[{type:a,value:"172..."}]},{type:a,value:ap},{type:b,tag:g,props:{},children:[{type:a,value:"192..."}]},{type:a,value:"; visit a browser to that address"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:aq,props:{id:aT},children:[{type:b,tag:m,props:{href:"#gists",ariaHidden:N,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:aU}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Here are the files mentioned in this post"}]},{type:a,value:e},{type:a,value:e},{type:b,tag:ay,props:{id:"configjson"},children:[{type:b,tag:m,props:{href:"#configjson",ariaHidden:N,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:"config.json"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:b,tag:m,props:{href:am,rel:[v,w,x],target:y},children:[{type:a,value:an}]},{type:a,value:" expects this file as "},{type:b,tag:g,props:{},children:[{type:a,value:"data\u002Fconfig.json"}]},{type:a,value:ao}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,"language-json"]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Y}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"bikeshed\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"\u002Fopt\u002Fbikeshed\u002Fbikeshed.py\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"rsyncPath\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"\u002Fsrv\u002Fwebapps\u002Fpublican\u002F\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"python\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"python2\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"logFile\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"logs\u002Fall.log\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"email\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Y}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"to\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bk}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"from\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bk}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"host\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"localhost\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"level\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"error\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"handleExceptions\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,"boolean"]},children:[{type:a,value:N}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"purgeAllURL\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"https:\u002F\u002Fapi.fastly.com\u002Fservice\u002Ffooo\u002Fpurge_all\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:M}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"purgeAllKey\""}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:I}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"baar\""}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Z}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:ay,props:{id:"defaultconf"},children:[{type:b,tag:m,props:{href:"#defaultconf",ariaHidden:N,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:"default.conf"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"A minimal NGINX web server digging for static content that Publican generates."}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,"language-nginx"]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# file: \u002Fetc\u002Fnginx\u002Fsites-enabled\u002Fdefault"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,R]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"server"}]}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Y}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,R]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"listen"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:"80"}]},{type:a,value:" default_server"}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aa}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,R]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:ad}]},{type:a,value:" \u002Fsrv\u002Fwebapps\u002Fpublican\u002Fdata\u002Fpublish"}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aa}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,R]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"index"}]},{type:a,value:" index.html index.htm"}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aa}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,R]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"server_name"}]},{type:a,value:" localhost"}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aa}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,R]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"location"}]},{type:a,value:" \u002F"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Y}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,R]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"try_files"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bl}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bl}]},{type:a,value:"\u002F =404"}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:aa}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Z}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:Z}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:"h5",props:{id:"dockerfile"},children:[{type:b,tag:m,props:{href:"#dockerfile",ariaHidden:N,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:"Dockerfile"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Here is the project's Dockerfile I created. I think it should be smaller, but\nPublican works with the following script."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Each step in a Dockerfile creates a \"commit\", make sure you have as few of them\nas possible, and also make sure that you clean after yourself. Remember that a\nDocker container is re-deployable and smallest the size of the container, the\nbetter!"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Notice a few details;"}]},{type:a,value:e},{type:b,tag:L,props:{},children:[{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"ENV DEBIAN_FRONTEND=noninteractive"}]},{type:a,value:" helps with dialogs"}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"USER webapps"}]},{type:a,value:" tells \"where\" the rest of the script will make commands as a\ndifferent user than root. Make sure what's required by root to be done before!"}]},{type:a,value:e},{type:b,tag:j,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"COPY ..."}]},{type:a,value:" this is basically how you import content inside the container (i.e.\nmake the container heavier)"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,"language-dockerfile"]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:bm}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Publican Docker runner"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:bm}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# See also:"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"#   * https:\u002F\u002Fgithub.com\u002Fnodesource\u002Fdocker-node\u002Fblob\u002Fmaster\u002Fubuntu\u002Ftrusty\u002Fnode\u002F0.10.36\u002FDockerfile"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"FROM"}]},{type:a,value:" nodesource\u002Ftrusty:0.10.36"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"MAINTAINER"}]},{type:a,value:" Renoir Boulanger \u003Crenoir@w3.org\u003E"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:" DEBIAN_FRONTEND=noninteractive"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Dependencies: Bikeshed, PhantomJS, Bikshed’s lxml"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:az}]},{type:a,value:" apt-get update && apt-get -y upgrade && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    apt-get install -yqq git python2.7 python-dev python-pip libxslt1-dev libxml2-dev zlib1g-dev && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    apt-get install -yqq libfontconfig1 libfreetype6 curl && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    apt-get autoremove -yqq --purge && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    pip install --upgrade lxml"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Copy everything we have locally into the container"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# REMINDER: Make sure you run `make clone-bikeshed`, we prefer to keep a copy locally outside"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# of the data volume. Otherwise it would make problems saying that bikeshed clone is not in the"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# same filesystem."}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"COPY"}]},{type:a,value:" . \u002Fsrv\u002Fwebapps\u002Fpublican\u002F"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Make sure we have a \"non root\" user and"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# delete any local workbench data\u002F directory"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:az}]},{type:a,value:" \u002Fusr\u002Fsbin\u002Fgroupadd --system --gid 990 webapps && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    \u002Fusr\u002Fsbin\u002Fuseradd --system --gid 990 --uid 990 -G sudo --home-dir \u002Fsrv\u002Fwebapps --shell \u002Fbin\u002Fbash webapps && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    sed -i "},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"'\u002F^%sudo\u002Fd'"}]},{type:a,value:" \u002Fetc\u002Fsudoers && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    echo "},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"'%sudo ALL=NOPASSWD: ALL'"}]},{type:a,value:" \u003E\u003E \u002Fetc\u002Fsudoers && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    mv \u002Fsrv\u002Fwebapps\u002Fpublican\u002Fbikeshed \u002Fopt && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    rm -rf data && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    mkdir -p data\u002Ftemp && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    rm -rf Dockerfile Makefile .git .gitignore DOCKER.md && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    chown -R webapps:webapps \u002Fsrv\u002Fwebapps\u002Fpublican && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    chown -R webapps:webapps \u002Fopt\u002Fbikeshed"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Switch from root to webapps system user"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# It **HAS to be** the SAME uid\u002Fgid as the owner on the host from which we’ll use as volume"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"USER"}]},{type:a,value:" webapps"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Where the session will start from"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"WORKDIR"}]},{type:a,value:" \u002Fsrv\u002Fwebapps\u002Fpublican"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Environment variables"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:" PATH \u002Fsrv\u002Fwebapps\u002Fpublican\u002Fnode_modules\u002F.bin:\u002Fsrv\u002Fwebapps\u002Fpublican\u002Fbin:\u002Fsrv\u002Fwebapps\u002Fpublican\u002F.local\u002Fbin:"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"$PATH"}]}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:" HOME \u002Fsrv\u002Fwebapps\u002Fpublican"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:" TMPDIR \u002Fsrv\u002Fwebapps\u002Fpublican\u002Fdata\u002Ftemp"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:" NODE_ENV production"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:T}]},{type:a,value:" GIT_DISCOVERY_ACROSS_FILESYSTEM true"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Run what `make deps` would do"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:az}]},{type:a,value:" pip install --upgrade --user --editable \u002Fopt\u002Fbikeshed && "},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:z}]},{type:a,value:"\n    mkdir -p node_modules && npm install"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Declare which port we expect to expose"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"EXPOSE"}]},{type:a,value:" 7002"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Allow cli entry for debug, but make sure docker-compose.yml uses \"command: bin\u002Frun.sh\""}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,C]},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"ENTRYPOINT"}]},{type:a,value:" ["},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"\u002Fbin\u002Fbash\""}]},{type:a,value:"]"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Note leftover: Ideally, it should exclusively run"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"#ENTRYPOINT [\"\u002Fbin\u002Fbash\", \"\u002Fsrv\u002Fwebapps\u002Fpublican\u002Fbin\u002Frun.sh\"]"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"# Note leftover: What it ends up doing"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"#CMD [\"node_modules\u002Fforever\u002Fbin\u002Fforever\", \"--fifo\", \"logs\", \"0\"]"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:ay,props:{id:"forever-start-script"},children:[{type:b,tag:m,props:{href:"#forever-start-script",ariaHidden:N,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:"Forever start script"}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"If you notice in the Docker run command, I call a file "},{type:b,tag:g,props:{},children:[{type:a,value:"bin\u002Frun.sh"}]},{type:a,value:", here it is."}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:J}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:av}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:z}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:aw}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:z}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:X}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:ax}]},{type:a,value:":7002 "},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:z}]},{type:a,value:"\n       webspecs\u002Fpublican:latest "},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:z}]},{type:a,value:"\n       bin\u002Frun.sh\n"}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"Publican runs its process using "},{type:b,tag:m,props:{href:"https:\u002F\u002Fgithub.com\u002Fforeverjs\u002Fforever",rel:[v,w,x],target:y},children:[{type:a,value:"Forever"}]},{type:a,value:". The objective of forever is to\nkeep a process to run at all times."}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"While this isn't ideal for NodeJS services, in the present use-case of a Docker\ncontainer who has the only purpose to run a process; Forever apt for the job!"}]},{type:a,value:e},{type:b,tag:l,props:{className:[n]},children:[{type:b,tag:o,props:{className:[p,s]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,"shebang","important"]},children:[{type:a,value:"#!\u002Fbin\u002Fbash"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:"export"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,"assign-left",i]},children:[{type:a,value:"RUNDIR"}]},{type:b,tag:c,props:{className:[d,q]},children:[{type:a,value:"="}]},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\"\u002Fsrv\u002Fwebapps\u002Fpublican\""}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F,G]},children:[{type:a,value:af}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bn}]},{type:a,value:"\nnode_modules\u002Fforever\u002Fbin\u002Fforever start "},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bn}]},{type:a,value:"\u002Fbin\u002Fserver.js\nnode_modules\u002Fforever\u002Fbin\u002Fforever "},{type:b,tag:c,props:{className:[d,A,i]},children:[{type:a,value:"--fifo"}]},{type:a,value:" logs "},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:"0"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"That’s it, it’s all I had."}]},{type:a,value:e},{type:b,tag:aq,props:{id:aV},children:[{type:b,tag:m,props:{href:"#screenshots",ariaHidden:N,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:aW}]},{type:a,value:e},{type:a,value:e},{type:b,tag:l,props:{style:bo,className:[bp,bq,br,bs,bt]},children:[{type:a,value:e},{type:b,tag:S,props:{className:[ak],src:bu,alt:"A W3C Specification preview where we can see on the left the specification, and on the right the source highlighting changes in the source",figcaption:h},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:"W3C Publican prototype build process helping with specification change tracking during review process"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:S,props:{className:[ak],src:bv,figcaption:h},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:bw}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:l,props:{style:bo,className:[bp,bq,br,bs,bt]},children:[{type:a,value:e},{type:b,tag:S,props:{className:[ak],src:bu,alt:"...",figcaption:h},children:[{type:a,value:"\n...\n"}]},{type:a,value:e},{type:b,tag:S,props:{className:[ak],src:bv,figcaption:h},children:[{type:a,value:e},{type:b,tag:f,props:{},children:[{type:a,value:bw}]},{type:a,value:e}]},{type:a,value:e}]}]},dir:"\u002Fblog\u002F2015\u002F05",path:"\u002Fblog\u002F2015\u002F05\u002Frun-nodejs-process-forever-within-docker-container",extension:aN,slug:"run-nodejs-process-forever-within-docker-container",createdAt:bx,updatedAt:bx,category:aP,prettyfiedTemporalDate:{prettified:"Tuesday, May 12, 2015",temporalDate:"2015-05-12"}}],taxonomyKey:J,taxonomy:{key:J,human:{key:J,text:"Docker",description:"Faisant usage de Docker\n"}}}],fetch:[],mutations:void 0}}("text","element","span","token","\n","p","code"," ","variable","li","punctuation","div","a","nuxt-content-highlight","pre","line-numbers","operator","function","language-bash","comment","keyword","nofollow","noopener","noreferrer","_blank","\\","parameter","string","instruction","\n\n","\n  ","builtin","class-name","property",":","docker","strong","ul",",","true",-1,"icon","icon-link","directive","app-image","ENV","em","-v",")","-p","{","}","number","\n    ",";",false,true,"root","ol","cd","\"","$(","pwd","\n       ","w-1\u002F3",3,"https:\u002F\u002Fgithub.com\u002Fwebspecs\u002Fpublican","Publican","."," or ","h3","sudo","exit","mkdir"," run ","-it","--rm","7002","h4","RUN","en-CA","2023-02-18T00:00:00.000Z","publish","experiments","procedure","operations","webplatform","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmove-your-discourse-instance-to-a-different-server\u002F15721","Move your Discourse instance to a different server","cp","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fchange-the-domain-name-or-rename-my-discourse\u002F16098","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmultisite-configuration-with-docker\u002F14084\u002F32","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmultisite-configuration-with-docker\u002F14084\u002F8",".md","2024-10-24T19:50:04.935Z","projects","run-publican-inside-docker","steps","Steps","gists","Gists","screenshots","Screenshots",", "," vagrant ","ssh","\n ","su","\u002Fdata\"",":\u002Fsrv\u002Fwebapps\u002Fpublican\u002Fdata ","\u002Fspec-data\"",":\u002Fopt\u002Fbikeshed\u002Fbikeshed\u002Fspec-data ",":7002 webspecs\u002Fpublican:wip\n","outside","It should look like the screenshot with caption \"","\".","Starting a build process","\n           ","\"jdoe@example.org\"","$uri","#","$RUNDIR","overflow:hidden;clear:both;","thumbnails","gallery","flex","flex-row","flex-wrap","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-preview.png","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-deleted-spec-regeneration-question.png","Annotated screenshot, when changing a file a hook is called and regenerates the specification","2024-10-24T19:50:04.933Z")));