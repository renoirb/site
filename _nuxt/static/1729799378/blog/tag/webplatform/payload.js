__NUXT_JSONP__("/blog/tag/webplatform", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,do0,dp,dq,dr,ds,dt,du,dv,dw,dx,dy,dz,dA,dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM,dN,dO,dP,dQ,dR,dS,dT,dU,dV,dW,dX,dY,dZ,d_,d$,ea,eb,ec,ed,ee,ef,eg,eh,ei,ej,ek,el,em,en,eo,ep,eq,er,es,et,eu,ev,ew,ex,ey,ez,eA,eB,eC,eD,eE,eF,eG,eH,eI,eJ,eK,eL,eM,eN,eO,eP,eQ,eR,eS,eT,eU,eV,eW,eX,eY,eZ,e_,e$,fa,fb,fc,fd,fe,ff,fg,fh,fi,fj){return {data:[{},{},{contents:[{title:"Recover Discourse from a backup, adjust domain name",locale:ak,created:"2015-11-20T00:00:00.000Z",updated:ap,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F11\u002Frecover-discourse-backup-change-domain-name\u002F",status:al,revising:M,migrateLinks:R,migrateImages:M,gallery:M,caption:M,categories:[aV],tags:[aq,at,ar,ad],keywords:[bt,"DNS",bu],coverImage:{src:bv,text:bw},preamble:{text:"This was written at the time I was closing loops at the [end of my time with the W3C][leaving-w3c].\nThe intent at the time (before WebPlatform project closed was to host *discuss.webplatform.org* what is now known as [W3C’s Web Platform Incubator Community Group (WICG)][wicg-article] and is available as [discourse.wicg.io][wicg]\n[leaving-w3c]: \u002Fblog\u002F2015\u002F07\u002Fleaving-w3c\u002F \"Leaving W3C\"\n[wicg]: https:\u002F\u002Fdiscourse.wicg.io\u002F\n[wicg-article]: https:\u002F\u002Fwww.w3.org\u002Fblog\u002F2015\u002F07\u002Fwicg\u002F\n"},excerpt:"Here is some preliminary notes on how one can restore a Discourse instance and change the domain name.",toc:[],body:{type:ae,children:[{type:b,tag:f,props:{},children:[{type:a,value:"Roughly based on "},{type:b,tag:j,props:{href:co,rel:[l,m,n],target:o},children:[{type:a,value:cp}]},{type:a,value:" post.\nBut without using the web UI. Because sysadmins prefers terminal."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:cq}]},{type:a,value:": Make "},{type:b,tag:E,props:{},children:[{type:a,value:"SURE"}]},{type:a,value:" the backup dump was generated from the same\nDiscourse version the one you'll import it into."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Copy from host backup into shared folder. Imagine you uploaded via SSH in your\nhost home directory."}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:cr}]},{type:a,value:" ~\u002Fsnapshot.tar.gz \u002Fsrv\u002Fwebplatform\u002Fshared\u002Fbackups\u002F\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Note that the folder "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fsrv\u002Fwebplatform\u002Fdiscuss\u002Fshared\u002Fstandalone\u002Fbackups\u002F"}]},{type:a,value:" from\nthe docker host would end up to be in "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fshared\u002Fbackups\u002F"}]},{type:a,value:" inside the container."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Enter the VM, make sure enable_restore is run from "},{type:b,tag:h,props:{},children:[{type:a,value:cs}]},{type:a,value:" cli utility"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:a,value:".\u002Flauncher enter app\ndiscourse enable_restore\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Find the mounted backup file from within the container"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"ll \u002Fshared\u002Fbackups\u002Fdefault\u002F\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Make sure "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fshared\u002Fbackups\u002Ffoo.tar.gz"}]},{type:a,value:" is readable by can read"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:"chmod"}]},{type:a,value:" o+r \u002Fshared\u002Fbackups\u002Fdefault\u002Ffoo.tar.gz\ndiscourse restore foo.tar.gz\ndiscourse disable_restore\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Remap domain name"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"discourse remap discourse.specifiction.org discuss.webplatform.org\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Then, work on user uploads and regenerate assets. That'll make sure ;"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"rake uploads:clean_up\nrake posts:rebake\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Refer to"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:ct,rel:[l,m,n],target:o},children:[{type:a,value:ct}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:"Most helpful post"}]},{type:a,value:g},{type:b,tag:j,props:{href:co,rel:[l,m,n],target:o},children:[{type:a,value:cp}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:cu,rel:[l,m,n],target:o},children:[{type:a,value:cu}]},{type:a,value:", and\nthe "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fdiscourse\u002Fdiscourse\u002Fblob\u002Fmaster\u002Fconfig\u002Fnginx.sample.conf",rel:[l,m,n],target:o},children:[{type:a,value:"referenced NGINX configuration in Discourse GitHub repo"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:cv,rel:[l,m,n],target:o},children:[{type:a,value:cv}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fops\u002Fissues\u002F152",rel:[l,m,n],target:o},children:[{type:a,value:"Work notes on WebPlatform GitHub issue tracker"}]}]},{type:a,value:c}]},{type:a,value:c}]},dir:"\u002Fblog\u002F2015\u002F11",path:"\u002Fblog\u002F2015\u002F11\u002Frecover-discourse-backup-change-domain-name",extension:am,slug:"recover-discourse-backup-change-domain-name",createdAt:cw,updatedAt:cw,category:aV,prettyfiedTemporalDate:{prettified:"Friday, November 20, 2015",temporalDate:"2015-11-20"}},{title:"Managing my PGP\u002FOpenPGP keys and share across many machines",locale:ak,created:"2015-08-06T00:00:00.000Z",updated:ap,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F08\u002Fmanaging-pgp-private-keys-share-across-machines\u002F",status:al,revising:M,migrateLinks:R,migrateImages:M,gallery:M,caption:M,categories:[aq],tags:[aW,"vulgarization",at,cx,ad],keywords:["PGP","subkey","OpenPGP"],excerpt:"A solution to the idea of sharing PGP private keys without risking to lose everything if one of the machines you shared it had been accessed.",preamble:{disable:R,text:g},toc:[],body:{type:ae,children:[{type:b,tag:f,props:{},children:[{type:a,value:"With "},{type:b,tag:an,props:{to:cy},children:[{type:a,value:"my previous position just finished"}]},{type:a,value:", I'm cleaning up my credential data\nI've stored on my computer. While doing so, I needed to update my PGP keys and I\nlearned something that I'm glad existed."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"When you use PGP to encrypt and\u002For sign your messages, you can only read\nmessages sent to you from the machine you have the private key. Right?"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The obvious solution would be to copy that private key everywhere; You mobile,\nservers, laptops."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"WRONG!"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The problem is that security experts would say that you shouldn't do that unless\nyou are certain things are \"safe\". But what is safe anyway, once somebody else,\nor a zombie process, accessed your machine, it's possible somebody gained access\nto your keys."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"OpenPGP has a way to address this issue and it's called \"SubKeys\". Quoting\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.gnupg.org\u002Fgph\u002Fen\u002Fmanual.html#AEN526",rel:[l,m,n],target:o},children:[{type:a,value:"gnupg.org manual"}]}]},{type:a,value:c},{type:b,tag:aX,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"By default, a DSA master signing key and an ElGamal encryption subkey are\ngenerated when you create a new keypair. This is convenient, because the roles\nof the two keys are different, (...). The master signing key is used to make\ndigital signatures (...). The encryption key is used only for decrypting\nencrypted documents sent to you."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This made me think I should make sure that I create a subkey, backup my main\nidentity, erase any traces of it from my main computer, then import the new\nsubkey."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"That way, I would only need to use the main key to update the data on key\nservers and to edit my keys."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"A nice effect of this way of working is that we can revoke a subkey. Since\nsubkeys, signatures and revocation are part of the public key that you sync with\nkey on keyservers, you can make the compromised subkey invalid."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The compromised key will be able to decrypt messages sent for that private\nsubkey, provided the attacker can also gain access to where the messages are\nstored, but you won't lose the most important part of the identity system.\nYou'll be able to create another subkey and keep the same identity."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"I hope I got it right. If I'm wrong, don't hesitate to tell me and I'll adjust!"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"I got to read more about all of this, but I am glad I learned about subkeys."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here are some notes I found that helped me understand this all better."}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Falexcabal.com\u002Fcreating-the-perfect-gpg-keypair\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"AlexCabal: Creating the perfect GPG keypair"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fwiki.debian.org\u002FSubkeys",rel:[l,m,n],target:o},children:[{type:a,value:"Debian Wiki: Using OpenPGP subkeys"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:"http:\u002F\u002Firtfweb.ifa.hawaii.edu\u002F~lockhart\u002Fgpg\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"GPG quick cheat sheet"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fsuperuser.com\u002Fquestions\u002F466396\u002Fhow-to-manage-gpg-keys-across-multiple-systems",rel:[l,m,n],target:o},children:[{type:a,value:"SuperUser: How to manage GPG keys across multiple systems"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fhelp.riseup.net\u002Fen\u002Fsecurity\u002Fmessage-security\u002Fopenpgp\u002Fbest-practices",rel:[l,m,n],target:o},children:[{type:a,value:"OpenPGP best practices"}]}]},{type:a,value:c}]}]},dir:"\u002Fblog\u002F2015\u002F08",path:"\u002Fblog\u002F2015\u002F08\u002Fmanaging-pgp-private-keys-share-across-machines",extension:am,slug:"managing-pgp-private-keys-share-across-machines",createdAt:aY,updatedAt:aY,category:aq,prettyfiedTemporalDate:{prettified:"Thursday, August 6, 2015",temporalDate:"2015-08-06"}},{title:"Migrating WebPlatform.org MediaWiki into Git as Markdown files",locale:ak,created:"2015-07-30T00:00:00.000Z",updated:"2020-11-18T00:00:00.000Z",status:al,revising:R,categories:[ai],tags:[cz,cA,at,ad],description:"How to take a full MediaWiki content and edit history into a Git repository keeping the history and author attributions into Markdown",coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F07\u002Fmonit_dashboard_201502_status.png",text:"The WebPlatform project was running from a about 20 VMs\nand the availability, in part, managed by Monit.\nAt the end of the project, the infrastructure \"had to go away\"\n"},preamble:{disable:R,text:g},toc:[{id:cB,depth:S,text:cC},{id:cD,depth:S,text:cE},{id:bu,depth:S,text:cF},{id:bx,depth:ao,text:cG},{id:cH,depth:ao,text:aI},{id:cI,depth:S,text:by},{id:cJ,depth:ao,text:bz},{id:aZ,depth:S,text:a_}],body:{type:ae,children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"On July 1st 2015, "},{type:b,tag:r,props:{},children:[{type:a,value:"The WebPlatform project"}]},{type:a,value:" has been discontinued, by having\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20130328132045\u002Fhttp:\u002F\u002Fwww.webplatform.org\u002Fstewards\u002F",rel:[l,m,n],target:o,title:"WebPlatform Project sponsors"},children:[{type:a,value:"its sponsors"}]},{type:a,value:" retracting from the project."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"I was hired by the W3C solely to maintain the WebPlatform project. Without\nfunding, and no budget at W3C\u002FMIT to transfer me, my contract was going to end."}]},{type:a,value:c},{type:a,value:c},{type:b,tag:bA,props:{style:cK},children:[{type:a,value:"\n👀 This was written in December 2020 and taken from notes I’ve been sharing around via email.\n"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"With me as the only full-time person on the project with knowledge of the\ninfrastructure, and also as a believer of “"},{type:b,tag:j,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FLearn\u002FGetting_started_with_the_web\u002FThe_web_and_web_standards#Dont_break_the_web",rel:[l,m,n],target:o},children:[{type:a,value:"don’t break the\nweb"}]},{type:a,value:"”, I wanted to keep everything online."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"When "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwebplatform.github.io\u002Fblog\u002F2013\u002F08\u002Fhi-my-name-s-renoir-ill-be-your-devops-for-the-web-platform\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"I inherited the project"}]},{type:a,value:", I "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwebplatform.github.io\u002Fdocs\u002FWPD\u002FInfrastructure\u002Fanalysis\u002F2013-Migrating_to_a_new_cloud_provider\u002F",rel:[l,m,n],target:o,title:"2013 Infrastructure project: Migrating to a new provider"},children:[{type:a,value:"went through migrating\n"},{type:b,tag:r,props:{},children:[{type:a,value:"from one cloud provider to another"}]}]},{type:a,value:" the full\ninfrastructure, "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwebplatform.github.io\u002Fdocs\u002FWPD\u002FInfrastructure\u002Fanalysis\u002F2013-Usage_and_future_state\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"it has been running from about 20 Linux\nVMs"}]},{type:a,value:", worked on a few projects such as an attempt at having\nSingle-SignOn, and better compatibility tables."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Since the project was being closed, most of what I’ve worked lost their use. The\ninfrastructure was also going to become a burden."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"While planning my last weeks, I’ve agreed with the W3C systems team\n\""},{type:b,tag:j,props:{href:cL,rel:[l,m,n],target:o},children:[{type:a,value:"w3t-systeam"}]},{type:a,value:"\" to convert as much as possible as a static site."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The following are notes about the software I’ve written to migrate a WordPress\nblog and multiple MediaWiki namespaces into a Git repository."}]},{type:a,value:c},{type:b,tag:W,props:{id:cB},children:[{type:b,tag:j,props:{href:"#priorities",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:cC}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The priorities were to keep the documentation pages up, preserve the\ncontribution history and attributions, also keep the blog contents, and have\neverything to be served as static HTML hosted on GitHub pages."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"I wanted to have this done before "},{type:b,tag:an,props:{to:cy},children:[{type:a,value:"I leave the W3C"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Since the "},{type:b,tag:j,props:{href:cL,rel:[l,m,n],target:o},children:[{type:a,value:"SysTeam"}]},{type:a,value:" would keep control of the "},{type:b,tag:h,props:{},children:[{type:a,value:bB}]},{type:a,value:"\ndomain, they’ve decided to support some redirect from the original domain to\n"},{type:b,tag:j,props:{href:cM,rel:[l,m,n],target:o,title:cN},children:[{type:a,value:a$}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Once everything was migrated, we’ve added a note;"}]},{type:a,value:c},{type:b,tag:aX,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The WebPlatform project, supported by various stewards between 2012 and 2015,\nhas been discontinued"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:"sup",props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Source: "},{type:b,tag:j,props:{href:cM,rel:[l,m,n],target:o,title:cN},children:[{type:a,value:a$}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:W,props:{id:cD},children:[{type:b,tag:j,props:{href:"#outcome",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:cE}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The conversion work took the "},{type:b,tag:r,props:{},children:[{type:a,value:"two last months"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"All links to pages showing the "},{type:b,tag:r,props:{},children:[{type:a,value:bC}]},{type:a,value:" logo from this article is the\nresult of what I’m describing here, as the migration and all servers were shut\ndown and decommissioned in 2016."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The source of the site was generated from\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fgenerator-docs",rel:[l,m,n],target:o},children:[{type:a,value:"webplatform\u002Fgenerator-docs"}]},{type:a,value:", and we’ve created\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fwebplatform.github.io\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"webplatform\u002Fwebplatform.github.io"}]},{type:a,value:"\nto host the site on GitHub pages. Eventualy, the W3C SysTeam set the repository\nas read-only."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"There were other things that we’ve initially planned, but couldn’t (see\n"},{type:b,tag:an,props:{to:"\u002Fblog\u002F2015\u002F07\u002Fmigrating-webplatform-org-mediawiki-into-git-history-and-into-markdown-files#requirements-we-couldnt-meet"},children:[{type:a,value:bz}]},{type:a,value:"):"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here is what I could migrate"}]},{type:a,value:c},{type:b,tag:v,props:{style:"font-size:small",className:["table-parent","table-auto"]},children:[{type:a,value:c},{type:a,value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:b,tag:"table",props:{},children:[{type:b,tag:"thead",props:{},children:[{type:b,tag:aJ,props:{},children:[{type:b,tag:au,props:{},children:[{type:a,value:"From"}]},{type:b,tag:au,props:{},children:[{type:a,value:"To"}]},{type:b,tag:au,props:{},children:[{type:a,value:"Repository"}]},{type:b,tag:au,props:{},children:[{type:a,value:"Comment"}]},{type:b,tag:au,props:{},children:[{type:a,value:"Commits"}]},{type:b,tag:au,props:{},children:[{type:a,value:"Documents"}]},{type:b,tag:au,props:{},children:[{type:a,value:"Deleted"}]}]}]},{type:b,tag:"tbody",props:{},children:[{type:b,tag:aJ,props:{},children:[{type:b,tag:J,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"docs.webplatform.org\u002Fwiki\u002F*"}]}]},{type:b,tag:J,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"webplatform.github.io\u002Fdocs\u002F*"}]}]},{type:b,tag:J,props:{},children:[{type:b,tag:j,props:{href:cO,rel:[l,m,n],target:o,title:cP},children:[{type:a,value:"webplatform\u002Fdocs"}]}]},{type:b,tag:J,props:{},children:[{type:a,value:"The main docs pages"}]},{type:b,tag:J,props:{},children:[{type:a,value:"37,000"}]},{type:b,tag:J,props:{},children:[{type:a,value:"4,675"}]},{type:b,tag:J,props:{},children:[{type:a,value:"418"}]}]},{type:b,tag:aJ,props:{},children:[{type:b,tag:J,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"docs.webplatform.org\u002Fwiki\u002FMeta:*"}]}]},{type:b,tag:J,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"webplatform.github.io\u002Fdocs\u002FMeta\u002F*"}]}]},{type:b,tag:J,props:{},children:[{type:b,tag:j,props:{href:cQ,rel:[l,m,n],target:o,title:cR},children:[{type:a,value:"webplatform\u002Fdocs-meta"}]}]},{type:b,tag:J,props:{},children:[{type:a,value:"Archived content that needed to be moved during initial mass imports."}]},{type:b,tag:J,props:{},children:[{type:a,value:"300"}]},{type:b,tag:J,props:{},children:[{type:a,value:"58"}]},{type:b,tag:J,props:{},children:[{type:a,value:"170"}]}]},{type:b,tag:aJ,props:{},children:[{type:b,tag:J,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"docs.webplatform.org\u002Fwiki\u002FWPD:*"}]}]},{type:b,tag:J,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"webplatform.github.io\u002Fdocs\u002FWPD\u002F*"}]}]},{type:b,tag:J,props:{},children:[{type:b,tag:j,props:{href:bD,rel:[l,m,n],target:o,title:bE},children:[{type:a,value:cS}]}]},{type:b,tag:J,props:{},children:[{type:a,value:"Community and notes section. Example "},{type:b,tag:j,props:{href:"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20160722084044\u002Fhttps:\u002F\u002Fdocs.webplatform.org\u002Fwiki\u002FWPD:Infrastructure",rel:[l,m,n],target:o},children:[{type:a,value:"\u002Fwiki\u002FWPD:Infrastructure"}]},{type:a,value:" into "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwebplatform.github.io\u002Fdocs\u002FWPD\u002FInfrastructure\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"\u002Fdocs\u002FWPD\u002FInfrastructure"}]},{type:a,value:" ("},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fdocs-wpd\u002Fblob\u002Fmanual-edits\u002FInfrastructure\u002Findex.md",rel:[l,m,n],target:o},children:[{type:a,value:"source"}]},{type:a,value:af}]},{type:b,tag:J,props:{},children:[{type:a,value:"5,700"}]},{type:b,tag:J,props:{},children:[{type:a,value:"358"}]},{type:b,tag:J,props:{},children:[{type:a,value:"323"}]}]},{type:b,tag:aJ,props:{},children:[{type:b,tag:J,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"blog.webplatform.org"}]}]},{type:b,tag:J,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"webplatform.github.io\u002Fblog\u002F*"}]}]},{type:b,tag:J,props:{},children:[{type:b,tag:j,props:{href:cT,rel:[l,m,n],target:o},children:[{type:a,value:"webplatform\u002Fblog"}]}]},{type:b,tag:J,props:{},children:[{type:a,value:"The blog content"}]},{type:b,tag:J,props:{},children:[{type:a,value:"2"}]},{type:b,tag:J,props:{},children:[{type:a,value:"53"}]},{type:b,tag:J,props:{},children:[{type:a,value:"N\u002FA"}]}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:W,props:{id:bu},children:[{type:b,tag:j,props:{href:"#migration",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:cF}]},{type:a,value:c},{type:b,tag:bA,props:{style:cK},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"👀 During this migration project, I was hoping to find a way to take any web\npage, from any CMS, and get a full copy (including images) of it into Markdown.\nThere was none. In 2017, I’ve created\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Frenoirb\u002Farchivator",rel:[l,m,n],target:o},children:[{type:b,tag:r,props:{},children:[{type:a,value:cU}]}]},{type:a,value:cV},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Farchivator",rel:[l,m,n],target:o},children:[{type:a,value:"npm"}]},{type:a,value:") to help with such work.\nInstead of using the last step described here, anyone could use "},{type:b,tag:r,props:{},children:[{type:a,value:cU}]},{type:a,value:" to\nretrieve a copy of their web pages."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"While building the solution, a few requirements emerged, they’re listed in\n"},{type:b,tag:an,props:{to:"\u002Fblog\u002F2015\u002F07\u002Fmigrating-webplatform-org-mediawiki-into-git-history-and-into-markdown-files#requirements"},children:[{type:a,value:by}]}]},{type:a,value:c},{type:b,tag:av,props:{id:bx},children:[{type:b,tag:j,props:{href:"#blog",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:cG}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"For migrating the "},{type:b,tag:j,props:{href:cT,rel:[l,m,n],target:o},children:[{type:a,value:bx}]},{type:a,value:", it was made manually, I’ve just\nconverted the HTML into Markdown using Pandoc."}]},{type:a,value:c},{type:b,tag:av,props:{id:cH},children:[{type:b,tag:j,props:{href:"#mediawiki",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:aI}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"For migrating MediaWiki, the proces was a bit more complex."}]},{type:a,value:c},{type:b,tag:bA,props:{title:"Want to migrate your own MediaWiki?"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"🤲🏼 If you’re looking for an HowTo to migrate your own MediaWiki installation,\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fmediawiki-conversion#use",rel:[l,m,n],target:o},children:[{type:a,value:"the procedure is written in ➡️ "},{type:b,tag:E,props:{},children:[{type:a,value:bF}]},{type:a,value:"’s README"}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"To migrate, we needed an history of each pages, from creation to the last edit."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"With MediaWiki, we have "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.mediawiki.org\u002Fwiki\u002FManual:DumpBackup.php",rel:[l,m,n],target:o,title:"dumpBackup.php file creates an XML dump for export or backup. XML dumps contain the content of the wiki"},children:[{type:b,tag:E,props:{},children:[{type:a,value:"Manual:DumpBackup.php"}]}]},{type:a,value:", that creates\nan XML file (\""},{type:b,tag:r,props:{},children:[{type:a,value:cW}]},{type:a,value:"\") of all history of all pages. One per\n"},{type:b,tag:j,props:{href:cX,rel:[l,m,n],target:o},children:[{type:a,value:"namespace"}]},{type:a,value:", for WebPlatform Docs’ wikis, we had:\n"},{type:b,tag:j,props:{href:cQ,rel:[l,m,n],target:o,title:cR},children:[{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fwiki\u002FMeta:*"}]}]},{type:a,value:aB},{type:b,tag:j,props:{href:bD,rel:[l,m,n],target:o,title:bE},children:[{type:b,tag:h,props:{},children:[{type:a,value:cY}]}]},{type:a,value:",\n"},{type:b,tag:j,props:{href:cO,rel:[l,m,n],target:o,title:cP},children:[{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fwiki\u002F*"}]}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"A big part of processing and converting history is about the data model so we\ncould read from one format and use the data model as data-source for conversion."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"For this, I’ve created "},{type:b,tag:j,props:{href:cZ,rel:[l,m,n],target:o,title:c_},children:[{type:a,value:c$}]},{type:a,value:", an\nabstract library specialized for data manipulation to help \""},{type:b,tag:r,props:{},children:[{type:a,value:"Transform CMS\ncontent from a format into another"}]},{type:a,value:" [format]\". It’s written in PHP, and might\nstill work even though it hasn’t been touched since 2015."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:j,props:{href:cZ,rel:[l,m,n],target:o,title:c_},children:[{type:a,value:c$}]},{type:a,value:" takes care of manipulating\ndata for:"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Date of contribution and author information"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Content management systems like "},{type:b,tag:r,props:{},children:[{type:a,value:aI}]},{type:a,value:" has a way to tell the user and\ndate of an edition."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Take each edit contents as they were"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Do not change any of the contents for each edits, even though they are in a\nformat understood by the original engine, here being "},{type:b,tag:r,props:{},children:[{type:a,value:aI}]},{type:a,value:O}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"To convert each page history edit into "},{type:b,tag:E,props:{},children:[{type:a,value:"Git commits"}]},{type:a,value:", I’ve created\n"},{type:b,tag:j,props:{href:bG,rel:[l,m,n],target:o,title:bH},children:[{type:a,value:bF}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This is the utility that takes care of making the conversion "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fmediawiki-conversion\u002Fblob\u002Fmaster\u002Fsrc\u002FWebPlatform\u002FImporter\u002FCommands\u002FRunCommand.php#L48",rel:[l,m,n],target:o,title:"Comments describing mediawiki-conversion"},children:[{type:a,value:"see comments made\nhere"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:"Handle deleted pages"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"For each edit create a git revisions commit until the final file delete. At\nthe end of that step, the Git repository should have an history, but no\naparent files. At this step, we can also use the entries and make a redirect\nmap."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:"Handle pages that weren’t deleted in history"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Do the same as above. At this step, we should have a repository with text\nfiles where each file has exactly the same content as the source history. So\nwe can add them on top of the deleted pages following the same process as\nabove. We can also use those as a list of current pages we’ll want to be\nconverted into Markdown."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:"Convert content"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"For all pages "},{type:b,tag:r,props:{},children:[{type:a,value:"that weren’t deleted in history"}]},{type:a,value:". Query "},{type:b,tag:r,props:{},children:[{type:a,value:aI}]},{type:a,value:" API to\nretrieve the full HTML, including "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.mediawiki.org\u002Fwiki\u002FTransclusion",rel:[l,m,n],target:o},children:[{type:a,value:"Transclusions"}]},{type:a,value:" pass it to\nPandoc, so we get it converted into Markdown. Commit the rewritten file\ncontents with Markdown."}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"By design "},{type:b,tag:j,props:{href:bG,rel:[l,m,n],target:o,title:bH},children:[{type:a,value:bF}]},{type:a,value:" allows to\nre-run the 3rd step so we could always get all edits until we\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.mediawiki.org\u002Fwiki\u002FManual:Lock_the_database",rel:[l,m,n],target:o},children:[{type:b,tag:r,props:{},children:[{type:a,value:"Lock the database"}]},{type:a,value:" (i.e. cut-off)"}]},{type:a,value:"\nso we could keep the production site active until a cut-off date."}]},{type:a,value:c},{type:a,value:c},{type:b,tag:W,props:{id:cI},children:[{type:b,tag:j,props:{href:"#requirements",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:by}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Along with what's described in the\n"},{type:b,tag:an,props:{to:"\u002Fblog\u002F2015\u002F07\u002Fmigrating-webplatform-org-mediawiki-into-git-history-and-into-markdown-files#migration-steps"},children:[{type:a,value:"Migration steps"}]},{type:a,value:",\nwe wanted also to ensure we properly support the following."}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Keep author attributions but have them anonymized"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"We didn’t want to leak all contributor’s accounts email addresses to be\npublished without their consent. So, I’ve setup a "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fdocs\u002Fblob\u002Fmanual-edits\u002F.mailmap",rel:[l,m,n],target:o},children:[{type:b,tag:h,props:{},children:[{type:a,value:".mailmap"}]},{type:a,value:" so that\ncontributors could add a PR to advertize publicly on GitHub"}]},{type:a,value:O}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Keep code examples in Markdown so we can colourize them"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Golden standard pages should look the same"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The \"Golden Standard\" pages were ones we were regularly referring to see how\nthey would look and see if things are broken."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Also, since we were removing infrastructure, we should see features that were\nenabled at the time of "},{type:b,tag:r,props:{},children:[{type:a,value:"Web.Archive.org"}]},{type:a,value:" snapshot, but would be omitted in\nthe "},{type:b,tag:r,props:{},children:[{type:a,value:"Static version"}]},{type:a,value:" (i.e. "},{type:b,tag:h,props:{},children:[{type:a,value:a$}]},{type:a,value:af}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:"Compatibility data"}]},{type:a,value:" was removed"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:"Contents"}]},{type:a,value:" on the right should be removed"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:"Overview table"}]},{type:a,value:" should look different"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"On "},{type:b,tag:r,props:{},children:[{type:a,value:"static version"}]},{type:a,value:" code blocks should be more colorized differently (it's\nusing a different process)"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Examples:"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fcss\u002Fproperties\u002Fborder-radius"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fcss\u002Fproperties\u002Fdisplay"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fjavascript\u002Ffunctions","web-archive-date":"20140626071828"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fjavascript\u002FArray\u002Ffilter"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fjavascript\u002FDate"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002FBeginners\u002Fhtml","web-archive-date":da},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Ftutorials\u002Fcanvas_notearsgame","web-archive-date":da},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Ftutorials\u002Fsvg_clipping_and_masking","web-archive-date":"20150905205843"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:aK}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"MediaWiki is pretty relax about what it allows in its URLs."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Since we’re migrating into a filesystem, we wanted to have only valid\nfilesystem file names and decided to normalize all paths into ASCII\ncharacters."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"For example, the "},{type:b,tag:j,props:{href:cX,rel:[l,m,n],target:o},children:[{type:a,value:"Namespaces"}]},{type:a,value:" (e.g. "},{type:b,tag:h,props:{},children:[{type:a,value:cY}]},{type:a,value:") adds a\ncolumn character, that would be URLEncoded into "},{type:b,tag:h,props:{},children:[{type:a,value:"%3A"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"There were many other discrepancies like:"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Case insensitivity — Because some URLs in pages were not in the same casing"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Supporting spaces — Sometimes with underscore \""},{type:b,tag:h,props:{},children:[{type:a,value:"_"}]},{type:a,value:"\", other times with "},{type:b,tag:h,props:{},children:[{type:a,value:"%20"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Normalize\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FURL\u002Fpathname",rel:[l,m,n],target:o},children:[{type:a,value:"URL Path"}]},{type:a,value:cV},{type:b,tag:j,props:{href:"https:\u002F\u002Furl.spec.whatwg.org\u002F#concept-url-path",rel:[l,m,n],target:o},children:[{type:a,value:"spec"}]},{type:a,value:") (e.g. anything that\nwould be URLEncoded such as "},{type:b,tag:h,props:{},children:[{type:a,value:"()!@:"}]},{type:a,value:af}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:aK}]},{type:a,value:": A page in another language should\nbe migrated"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002FMain_Page\u002Fja","web-archive-date":"20160613060459"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002FMain_Page\u002Fko"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:aK}]},{type:a,value:": A Page with "},{type:b,tag:h,props:{},children:[{type:a,value:"()"}]},{type:a,value:" in URL should be\nnormalized"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fcss\u002Ffunctions\u002Ftranslate()"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fsvg\u002Fproperties\u002FanimVal_(SVGAnimatedPreserveAspectRatio)"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fsvg\u002Fproperties\u002Fcx_(SVGRadialGradientElement)"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:aK}]},{type:a,value:": Pages within WPD namespace should\nbe migrated"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002FWPD:Infrastructure\u002FMonitoring\u002FMonit"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002FWPD:Infrastructure\u002Fanalysis\u002F2013-Migrating_to_a_new_cloud_provider"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The image comes from "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002FWPD\u002Fassets\u002F"}]},{type:a,value:" which means the image is hosted in the\n"},{type:b,tag:j,props:{href:bD,rel:[l,m,n],target:o,title:bE},children:[{type:a,value:cS}]},{type:a,value:" in the assets\u002F folder."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:aK}]},{type:a,value:": Pages in Meta namespace should be\nmigrated"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002FMeta:HTML\u002FElements\u002Fstyle"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002FMeta:web_platform_wednesday"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002FMeta:Editors_Guide"},children:[{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:av,props:{id:cJ},children:[{type:b,tag:j,props:{href:"#requirements-we-couldnt-meet",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:bz}]},{type:a,value:c},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Ensure ALL assets uploads are displayed properly"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Before, we would use GlusterFS to store images for MediaWiki. There has been\nwork made to store on "},{type:b,tag:h,props:{},children:[{type:a,value:bI}]},{type:a,value:", all the pages uses the link,\nbut the SysTeam decided not to keep the redirects."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Now that the site is archived, I’m unsure this can be fixed."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"If you want to see them, add this bookmarklet to your bookmarks bar\n"},{type:b,tag:j,props:{style:"text-decoration:none;display:inline-block;padding: 1px 6px;color: #fff;background: #32a0eb;-webkit-border-radius: 4px;-moz-border-radius: 4px;border-radius: 4px;",href:"javascript:(function()%7B%5B%5D.forEach.call(document.querySelectorAll('img')%2Cfunction(img)%7Bif%20('src'%20in%20img)%20%7Bsrc%20%3D%20img.src%3Bsrc%20%3D%20src.replace('static.webplatform.org'%2C%20'webplatform.github.io%2Fdocs-assets')%3Bimg.src%3Dsrc%3B%7D%7D)%7D)()"},children:[{type:a,value:"WebPlatform.github.io\nShow images"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The project "},{type:b,tag:j,props:{href:db,rel:[l,m,n],target:o},children:[{type:a,value:db}]},{type:a,value:" was meant to be used as\nan origin for "},{type:b,tag:h,props:{},children:[{type:a,value:bI}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:"Should we want to fix the issue"}]},{type:a,value:", we could setup an HTTP redirect from\n"},{type:b,tag:h,props:{},children:[{type:a,value:bI}]},{type:a,value:" to "},{type:b,tag:h,props:{},children:[{type:a,value:"webplatform.github.io\u002Fdocs-assets\u002F"}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The following (should be) the same file;"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:dc,rel:[l,m,n],target:o},children:[{type:a,value:dc}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:dd,rel:[l,m,n],target:o},children:[{type:a,value:dd}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:de,rel:[l,m,n],target:o},children:[{type:a,value:de}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Make sure page links "},{type:b,tag:r,props:{},children:[{type:a,value:"with different casing"}]},{type:a,value:" are redirected properly"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"For example the page for \""},{type:b,tag:h,props:{},children:[{type:a,value:"Internet_and_Web"}]},{type:a,value:"\" is sometimes linked with\ndifferent casing, e.g. at \""},{type:b,tag:h,props:{},children:[{type:a,value:"Internet_and_Web\u002FThe_History_of_the_Web"}]},{type:a,value:"\" or\n\""},{type:b,tag:h,props:{},children:[{type:a,value:"internet_and_web\u002FThe_History_of_the_Web"}]},{type:a,value:"\", it is migrated once;\n"},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fconcepts\u002FInternet_and_Web\u002FThe_History_of_the_Web"},children:[]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Some page has links to with different casing \""},{type:b,tag:h,props:{},children:[{type:a,value:"internet_and_web"}]},{type:a,value:"\", we can see\nfrom\n"},{type:b,tag:X,props:{slug:"docs.webplatform.org\u002Fwiki\u002Fconcepts"},children:[]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"MediaWiki would redirect, but on GitHub pages, nothing has been put in place\nfor those. If we wanted to support, we could have used the same entries used\nto create "},{type:b,tag:j,props:{href:df,rel:[l,m,n],target:o},children:[{type:a,value:"NGINX rewrite rules"}]},{type:a,value:", and add empty HTML pages\nlike GitHub pages would. In the case of WebPlatform project, it's been\ndecided to leave as-is."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Enforce all redirects from "},{type:b,tag:h,props:{},children:[{type:a,value:"*.webplatform.org"}]},{type:a,value:" to properly redirect to\n"},{type:b,tag:h,props:{},children:[{type:a,value:a$}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This migration process supported creating "},{type:b,tag:j,props:{href:df,rel:[l,m,n],target:o},children:[{type:a,value:"NGINX rewrite\nrules"}]},{type:a,value:", I’m unsure if they’ve been used."}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:"hr",props:{},children:[]},{type:a,value:c},{type:b,tag:W,props:{id:aZ},children:[{type:b,tag:j,props:{href:dg,ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:a_}]},{type:a,value:c},{type:b,tag:v,props:{style:bJ,className:[bK,bL]},children:[{type:a,value:c},{type:b,tag:T,props:{figcaption:g,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F07\u002Fmediawiki-history-to-git-conversion.png"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:j,props:{href:bG,rel:[l,m,n],target:o,title:bH},children:[{type:a,value:"WebPlatform\u002Fmediawiki-conversion"}]},{type:a,value:" is made to run in 3\nsteps, here we see it running at the 3rd step. Where we would take the latest\nversion, get the HTML version from the MediaWiki API, and pass to Pandoc to get\nMarkdown."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:T,props:{figcaption:g,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F07\u002Fmediawiki-history-to-git-output.png"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Making sure during development that the conversion was effectively the same"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:T,props:{figcaption:g,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F07\u002Fdocs-page-history-github.png"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"We can see directly on GitHub.com the converted page's Git history"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:T,props:{figcaption:g,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F07\u002Fdocs-page-markdown.png"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"We can see directly on GitHub.com the converted Markdown contents."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:T,props:{figcaption:g,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F07\u002Fdocs-page-view-syntaxhighlight.png"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The final output should support code blocks with"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:T,props:{figcaption:g,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F07\u002Fmediawiki-history-to-git-log.png",alt:"MediaWiki history converted into Git Commits"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The end result is that for each "},{type:b,tag:r,props:{},children:[{type:a,value:cW}]},{type:a,value:" can be converted into text\nfiles where each edits are made as Git commits keeping author and date of edit."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:T,props:{figcaption:g,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F07\u002Fdocs-page-history-onsite.png"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:"Not implemented"}]},{type:a,value:" Screenshot of an experiment to display the page's Git\nhistory calling GitHub API. There is no trace of this to my recollection, and It\nwas effectively the first time I used Vue.js."}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},dir:"\u002Fblog\u002F2015\u002F07",path:"\u002Fblog\u002F2015\u002F07\u002Fmigrating-webplatform-org-mediawiki-into-git-history-and-into-markdown-files",extension:am,slug:"migrating-webplatform-org-mediawiki-into-git-history-and-into-markdown-files",createdAt:aY,updatedAt:aY,category:ai,prettyfiedTemporalDate:{prettified:"Thursday, July 30, 2015",temporalDate:"2015-07-30"}},{title:"Run a NodeJS process through forever from within a Docker container",locale:ak,created:"2015-05-12T00:00:00.000Z",updated:ap,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F05\u002Frun-nodejs-process-forever-within-docker-container\u002F",status:al,revising:R,migrateLinks:R,categories:[ai],tags:[aW,ar,cA,at,aq,ad],coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-spec-rangefinder.png",alt:"Screen capture of the RangeFinder API using Publican",text:"Specification Document for RangeFinder API\n"},excerpt:"I’ve recently been through the steps to make a NodeJS web app to run from inside a Docker container. The objective of this project was to simplify the deployment of a web app that had many moving parts by making it a re-deployable service that is self-contained.",preamble:{disable:R,text:g},toc:[{id:dh,depth:S,text:"Run publican inside Docker"},{id:aC,depth:ao,text:aD},{id:di,depth:ao,text:dj},{id:aZ,depth:ao,text:a_}],body:{type:ae,children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"One of the components that I worked on "},{type:b,tag:an,props:{to:dk},children:[{type:a,value:"during my time on the WebPlatform\nproject"}]},{type:a,value:aB},{type:b,tag:j,props:{href:bM,rel:[l,m,n],target:o},children:[{type:a,value:bN}]},{type:a,value:", that I had to manage has many moving parts. The\nend product of that component is basically static HTML documents that ends up on\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fspecs.webplatform.org\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"specs.webplatform.org"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Since we need to have many packages installed in very specific version, and\nautomating the installation wouldn't bring any more benefit than being\nself-contained, I thought it would be best to go through the steps of converting\nit into a Docker container."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The following is a procedure I wrote to teach "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.w3.org\u002Fstaff\u002Falumni\u002F#robin-berjon",rel:[l,m,n],target:o},children:[{type:a,value:"my colleague"}]},{type:a,value:aB},{type:b,tag:j,props:{href:"https:\u002F\u002Fberjon.com\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"Robin\nBerjon"}]},{type:a,value:", how to run his system called "},{type:b,tag:j,props:{href:bM,rel:[l,m,n],target:o},children:[{type:a,value:bN}]},{type:a,value:" from within a Docker\ncontainer. Publican is basically a GitHub hook listener that generates specs\nwritten to be parsed by "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fw3c\u002Frespec",rel:[l,m,n],target:o},children:[{type:a,value:"ReSpec"}]},{type:a,value:bO},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Ftabatkins\u002Fbikeshed",rel:[l,m,n],target:o},children:[{type:a,value:"Bikeshed"}]}]},{type:a,value:c},{type:b,tag:W,props:{id:dh},children:[{type:b,tag:j,props:{href:"#run-publican-inside-docker",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:"Run "},{type:b,tag:r,props:{},children:[{type:a,value:"publican"}]},{type:a,value:" inside Docker"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"What this'll do is basically build a VM that'll run a Docker container. The\ncontainer will write in files outside of it."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"You'll quickly notice that the paths will look the same, its confusing, sorry\nabout that. Fortunately for us, the paths in the procedure are the ones that\nwill be mounted through Docker Volume (the "},{type:b,tag:h,props:{},children:[{type:a,value:aL}]},{type:a,value:" option when you call "},{type:b,tag:h,props:{},children:[{type:a,value:ar}]},{type:a,value:")\nand will, in the end, be the same files."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Once you have a Docker container running on a VM, it'll replicate how a\nproduction VM will run the tasks. Since we know where the container will write\nfiles, we'll have our frontend servers to forward requests to publican, and\nserve files it generated."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Doing all this removes the need to do any rsync. NGINX within the VM that'll run\nDocker will take care of serving static files, and frontend server will expose\nit to the public."}]},{type:a,value:c},{type:b,tag:av,props:{id:aC},children:[{type:b,tag:j,props:{href:bP,ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:aD}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Have "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.vagrantup.com\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"Vagrant"}]},{type:a,value:bQ},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.virtualbox.org\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"VirtualBox"}]},{type:a,value:" installed"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Follow what's in "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Frenoirb\u002Fsalt-basesystem",rel:[l,m,n],target:o},children:[{type:a,value:"renoirb\u002Fsalt-basesystem README.md"}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Make sure you follow "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Frenoirb\u002Fsalt-basesystem#vagrant-sandbox-utilities",rel:[l,m,n],target:o},children:[{type:a,value:"Vagrant Sandbox utilities"}]},{type:a,value:" part"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:dl},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:dm}]},{type:a,value:dn},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bR}]},{type:a,value:" salt-call state.highstate\n "},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bR}]},{type:a,value:" salt-call state.sls vagrantsandbox.docker\n "},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bS}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Reboot the VM by doing "},{type:b,tag:h,props:{},children:[{type:a,value:"vagrant reload"}]}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:" vagrant reload\n"}]}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:"No need"}]},{type:a,value:" to follow what's in "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fpublican\u002Fblob\u002Ftask-based-docker\u002FDOCKER.md",rel:[l,m,n],target:o},children:[{type:a,value:"webplatform\u002Fpublican DOCKER.md file"}]},{type:a,value:".\nThose are notes to show how to build a container. For this time, we'll "},{type:b,tag:j,props:{href:"https:\u002F\u002Fregistry.hub.docker.com\u002Fu\u002Fwebspecs\u002Fpublican\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"use a\ncontainer I already built and pushed on "},{type:b,tag:E,props:{},children:[{type:a,value:"Docker hub"}]}]},{type:a,value:"!"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Setup what's required to run the container"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:dl},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:dm}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Prepare the folders;"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bR}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bT}]},{type:a,value:dn},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:do0}]},{type:a,value:" webapps\n "},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:"id"}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"You should see"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,"language-text"]},children:[{type:b,tag:h,props:{},children:[{type:a,value:" uid=990(webapps) gid=990(webapps) groups=990(webapps),33(www-data),998(docker)\n"}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Prepare the folders"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:g},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:aM}]},{type:a,value:" \u002Fsrv\u002Fwebapps "},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bU}]},{type:a,value:" publican\u002Fdata "},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:aM}]},{type:a,value:" publican\n"}]}]}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"If all went well so far; you should be able to do "},{type:b,tag:h,props:{},children:[{type:a,value:"docker ps"}]},{type:a,value:" as the\n"},{type:b,tag:h,props:{},children:[{type:a,value:"webapps"}]},{type:a,value:" user. Otherwise reboot and\u002For run "},{type:b,tag:h,props:{},children:[{type:a,value:"salt-call"}]},{type:a,value:" with both\n"},{type:b,tag:h,props:{},children:[{type:a,value:"state.highstate"}]},{type:a,value:g},{type:b,tag:h,props:{},children:[{type:a,value:"state.sls vagrantsandbox.docker"}]},{type:a,value:" states. There should be\nnothing left to do."}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ar}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:"ps"}]},{type:a,value:"\n\nCONTAINER ID IMAGE COMMAND CREATED\n"},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:".."}]},{type:a,value:".\n"}]}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Pull the publican Docker image I built (it'll take about 10 minutes)"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ar}]},{type:a,value:" pull webspecs\u002Fpublican:wip\n"}]}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Copy the other files in this Gist in your local coputer where you cloned the\n"},{type:b,tag:E,props:{},children:[{type:a,value:"salt-basesystem"}]},{type:a,value:" repository. From that folder you can move them inside the\nVagrant VM where you need."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Copy publican config"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:cr}]},{type:a,value:" \u002Fvagrant\u002Fconfig.json data\u002F\n"}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:dp,props:{},children:[{type:a,value:"Download Bikeshed stuff that i didn't figure out yet what's important to\nkeep, extract it in "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fsrv\u002Fwebapps\u002Fpublican\u002Fspec-data\u002F"}]}]},{type:a,value:O}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:"rb-notice-box",props:{className:["my-5"],variant:"info"},children:[{type:a,value:c},{type:b,tag:E,props:{slot:"header"},children:[{type:a,value:"Archive mentioned no longer exists"}]},{type:a,value:"\nThe archive used in the initial procedure no longer exists, it was a series of W3C specification Git repository working copies that Publican was expecting.\n"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"You can open up another terminal session and connect to the Vagrant VM\n"},{type:b,tag:h,props:{},children:[{type:a,value:"vagrant ssh"}]},{type:a,value:" (e.g. if you don't use "},{type:b,tag:h,props:{},children:[{type:a,value:"tmux"}]},{type:a,value:bO},{type:b,tag:h,props:{},children:[{type:a,value:"screen"}]},{type:a,value:af}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bU}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aE}]},{type:a,value:" spec-data\u002Freadonly\u002F\n"},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bU}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aE}]},{type:a,value:" data\u002F"},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:"gits,logs,publish,queue,temp"},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Run the container"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ar}]},{type:a,value:bV},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bW}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bX}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aL}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:ba}]},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bb}]},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:af}]}]},{type:a,value:dq}]},{type:a,value:dr},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:bc},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aL}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:ba}]},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bb}]},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:af}]}]},{type:a,value:ds}]},{type:a,value:dt},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:bc},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aE}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:bY}]},{type:a,value:du}]}]}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"If you see the following, you're in the Docker container!!"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"webapps@2f33f5c6e183:~$\n"}]}]}]},{type:a,value:c},{type:b,tag:T,props:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-init.png",alt:"A terminal window with a few commands and a build process status and green lines, no errors",figcaption:g},children:[{type:a,value:"\n  Launching the container\n"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Initiate the empty shell we just created (it'll create stuff in the "},{type:b,tag:h,props:{},children:[{type:a,value:"data\u002F"}]},{type:a,value:"\nfolder "},{type:b,tag:r,props:{},children:[{type:a,value:dv}]},{type:a,value:" of the container)"}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"publican.js init\n"}]}]}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:dw},{type:b,tag:r,props:{},children:[{type:a,value:"Launching the container"}]},{type:a,value:dx}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Once done, exit the container. Notice that by doing this, you lose the state\nof the VM and anything that has been written in the container. But, since we\nuse volumes (notice the "},{type:b,tag:h,props:{},children:[{type:a,value:"-v \u002Fhost\u002Fpath:\u002Fcontainer\u002Fpath"}]},{type:a,value:"), we actually wrote\n"},{type:b,tag:r,props:{},children:[{type:a,value:dv}]},{type:a,value:" of the container."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"We can "},{type:b,tag:E,props:{},children:[{type:a,value:"exit the container"}]}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:a,value:g},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bS}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"At this stage, we had publican and bikeshed to generate files (we may call\nthis a \"cache warmup\" of softs). Now, let's prepare the Vagrant VM to serve\nthe static content. Notice that the next commands are there only for the\npurpose of a local workspace, in production this step will also be managed\nautomatically."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Let's get back as the "},{type:b,tag:E,props:{},children:[{type:a,value:ae}]},{type:a,value:" user, and create a quick web server;"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bS}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bZ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:"-yqq"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aF}]},{type:a,value:"\nnginx "},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bd}]},{type:a,value:" \u002Fvagrant\u002Fdefault.conf \u002Fetc\u002Fnginx\u002Fsites-available\u002Fdefault\n"},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:"service"}]},{type:a,value:" restart nginx\n"}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Let's return back to "},{type:b,tag:E,props:{},children:[{type:a,value:"as the webapps user and launch the runner"}]}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:do0}]},{type:a,value:" webapps "},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:aM}]},{type:a,value:" \u002Fsrv\u002Fwebapps\u002Fpublican\u002F\n"}]}]}]},{type:a,value:c},{type:b,tag:T,props:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-run-hook.png",alt:"A terminal window with a build process status and green lines, no errors",figcaption:g},children:[{type:a,value:"\nStarting a build process\n"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:dy}]},{type:a,value:"; this will also be managed automatically in\nproduction."}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,"language-shell"]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ar}]},{type:a,value:bV},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bW}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bX}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aL}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:ba}]},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bb}]},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:af}]}]},{type:a,value:dq}]},{type:a,value:dr},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:dz},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aL}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:ba}]},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bb}]},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:af}]}]},{type:a,value:ds}]},{type:a,value:dt},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:dz},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aE}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:bY}]},{type:a,value:du}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:dw},{type:b,tag:r,props:{},children:[{type:a,value:dy}]},{type:a,value:dx}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"get your Vagrant VM IP address"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:"ifconfig"}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Should start by "},{type:b,tag:h,props:{},children:[{type:a,value:"172..."}]},{type:a,value:bO},{type:b,tag:h,props:{},children:[{type:a,value:"192..."}]},{type:a,value:"; visit a browser to that address"}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:av,props:{id:di},children:[{type:b,tag:j,props:{href:"#gists",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:dj}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here are the files mentioned in this post"}]},{type:a,value:c},{type:a,value:c},{type:b,tag:b_,props:{id:"configjson"},children:[{type:b,tag:j,props:{href:"#configjson",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:"config.json"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:j,props:{href:bM,rel:[l,m,n],target:o},children:[{type:a,value:bN}]},{type:a,value:" expects this file as "},{type:b,tag:h,props:{},children:[{type:a,value:"data\u002Fconfig.json"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,"language-json"]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"bikeshed\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"\u002Fopt\u002Fbikeshed\u002Fbikeshed.py\""}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"rsyncPath\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"\u002Fsrv\u002Fwebapps\u002Fpublican\u002F\""}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"python\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"python2\""}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"logFile\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"logs\u002Fall.log\""}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"email\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"to\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:dA}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"from\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:dA}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"host\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"localhost\""}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"level\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"error\""}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"handleExceptions\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,b$]},children:[{type:a,value:F}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"purgeAllURL\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"https:\u002F\u002Fapi.fastly.com\u002Fservice\u002Ffooo\u002Fpurge_all\""}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:aj}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,ag]},children:[{type:a,value:"\"purgeAllKey\""}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ac}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"baar\""}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:b_,props:{id:"defaultconf"},children:[{type:b,tag:j,props:{href:"#defaultconf",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:"default.conf"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"A minimal NGINX web server digging for static content that Publican generates."}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,ca]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# file: \u002Fetc\u002Fnginx\u002Fsites-enabled\u002Fdefault"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aN}]}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:be}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:dB}]},{type:a,value:" default_server"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:ae}]},{type:a,value:" \u002Fsrv\u002Fwebapps\u002Fpublican\u002Fdata\u002Fpublish"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"index"}]},{type:a,value:" index.html index.htm"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bf}]},{type:a,value:" localhost"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:ab},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:dC}]},{type:a,value:dD}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"try_files"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:dE}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:dE}]},{type:a,value:"\u002F =404"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:"h5",props:{id:"dockerfile"},children:[{type:b,tag:j,props:{href:"#dockerfile",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:"Dockerfile"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here is the project's Dockerfile I created. I think it should be smaller, but\nPublican works with the following script."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Each step in a Dockerfile creates a \"commit\", make sure you have as few of them\nas possible, and also make sure that you clean after yourself. Remember that a\nDocker container is re-deployable and smallest the size of the container, the\nbetter!"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Notice a few details;"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"ENV DEBIAN_FRONTEND=noninteractive"}]},{type:a,value:" helps with dialogs"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"USER webapps"}]},{type:a,value:" tells \"where\" the rest of the script will make commands as a\ndifferent user than root. Make sure what's required by root to be done before!"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"COPY ..."}]},{type:a,value:" this is basically how you import content inside the container (i.e.\nmake the container heavier)"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,"language-dockerfile"]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:dF}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Publican Docker runner"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:dF}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# See also:"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"#   * https:\u002F\u002Fgithub.com\u002Fnodesource\u002Fdocker-node\u002Fblob\u002Fmaster\u002Fubuntu\u002Ftrusty\u002Fnode\u002F0.10.36\u002FDockerfile"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"FROM"}]},{type:a,value:" nodesource\u002Ftrusty:0.10.36"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"MAINTAINER"}]},{type:a,value:" Renoir Boulanger \u003Crenoir@w3.org\u003E"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aG}]},{type:a,value:" DEBIAN_FRONTEND=noninteractive"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Dependencies: Bikeshed, PhantomJS, Bikshed’s lxml"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:cb}]},{type:a,value:" apt-get update && apt-get -y upgrade && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    apt-get install -yqq git python2.7 python-dev python-pip libxslt1-dev libxml2-dev zlib1g-dev && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    apt-get install -yqq libfontconfig1 libfreetype6 curl && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    apt-get autoremove -yqq --purge && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    pip install --upgrade lxml"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Copy everything we have locally into the container"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# REMINDER: Make sure you run `make clone-bikeshed`, we prefer to keep a copy locally outside"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# of the data volume. Otherwise it would make problems saying that bikeshed clone is not in the"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# same filesystem."}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"COPY"}]},{type:a,value:" . \u002Fsrv\u002Fwebapps\u002Fpublican\u002F"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Make sure we have a \"non root\" user and"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# delete any local workbench data\u002F directory"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:cb}]},{type:a,value:" \u002Fusr\u002Fsbin\u002Fgroupadd --system --gid 990 webapps && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    \u002Fusr\u002Fsbin\u002Fuseradd --system --gid 990 --uid 990 -G sudo --home-dir \u002Fsrv\u002Fwebapps --shell \u002Fbin\u002Fbash webapps && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    sed -i "},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'\u002F^%sudo\u002Fd'"}]},{type:a,value:" \u002Fetc\u002Fsudoers && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    echo "},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'%sudo ALL=NOPASSWD: ALL'"}]},{type:a,value:" \u003E\u003E \u002Fetc\u002Fsudoers && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    mv \u002Fsrv\u002Fwebapps\u002Fpublican\u002Fbikeshed \u002Fopt && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    rm -rf data && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    mkdir -p data\u002Ftemp && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    rm -rf Dockerfile Makefile .git .gitignore DOCKER.md && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    chown -R webapps:webapps \u002Fsrv\u002Fwebapps\u002Fpublican && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    chown -R webapps:webapps \u002Fopt\u002Fbikeshed"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Switch from root to webapps system user"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# It **HAS to be** the SAME uid\u002Fgid as the owner on the host from which we’ll use as volume"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"USER"}]},{type:a,value:" webapps"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Where the session will start from"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"WORKDIR"}]},{type:a,value:" \u002Fsrv\u002Fwebapps\u002Fpublican"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Environment variables"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aG}]},{type:a,value:" PATH \u002Fsrv\u002Fwebapps\u002Fpublican\u002Fnode_modules\u002F.bin:\u002Fsrv\u002Fwebapps\u002Fpublican\u002Fbin:\u002Fsrv\u002Fwebapps\u002Fpublican\u002F.local\u002Fbin:"},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:"$PATH"}]}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aG}]},{type:a,value:" HOME \u002Fsrv\u002Fwebapps\u002Fpublican"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aG}]},{type:a,value:" TMPDIR \u002Fsrv\u002Fwebapps\u002Fpublican\u002Fdata\u002Ftemp"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aG}]},{type:a,value:" NODE_ENV production"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aG}]},{type:a,value:" GIT_DISCOVERY_ACROSS_FILESYSTEM true"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Run what `make deps` would do"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:cb}]},{type:a,value:" pip install --upgrade --user --editable \u002Fopt\u002Fbikeshed && "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:q}]},{type:a,value:"\n    mkdir -p node_modules && npm install"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Declare which port we expect to expose"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"EXPOSE"}]},{type:a,value:" 7002"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Allow cli entry for debug, but make sure docker-compose.yml uses \"command: bin\u002Frun.sh\""}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,$]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"ENTRYPOINT"}]},{type:a,value:" ["},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"\u002Fbin\u002Fbash\""}]},{type:a,value:"]"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Note leftover: Ideally, it should exclusively run"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"#ENTRYPOINT [\"\u002Fbin\u002Fbash\", \"\u002Fsrv\u002Fwebapps\u002Fpublican\u002Fbin\u002Frun.sh\"]"}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Note leftover: What it ends up doing"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"#CMD [\"node_modules\u002Fforever\u002Fbin\u002Fforever\", \"--fifo\", \"logs\", \"0\"]"}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:b_,props:{id:"forever-start-script"},children:[{type:b,tag:j,props:{href:"#forever-start-script",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:"Forever start script"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"If you notice in the Docker run command, I call a file "},{type:b,tag:h,props:{},children:[{type:a,value:"bin\u002Frun.sh"}]},{type:a,value:", here it is."}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ar}]},{type:a,value:bV},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bW}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:bc},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bX}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:bc},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aE}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:bY}]},{type:a,value:":7002 "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n       webspecs\u002Fpublican:latest "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n       bin\u002Frun.sh\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Publican runs its process using "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fforeverjs\u002Fforever",rel:[l,m,n],target:o},children:[{type:a,value:"Forever"}]},{type:a,value:". The objective of forever is to\nkeep a process to run at all times."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"While this isn't ideal for NodeJS services, in the present use-case of a Docker\ncontainer who has the only purpose to run a process; Forever apt for the job!"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,A]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,"shebang","important"]},children:[{type:a,value:"#!\u002Fbin\u002Fbash"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bg}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aH,p]},children:[{type:a,value:"RUNDIR"}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"\u002Fsrv\u002Fwebapps\u002Fpublican\""}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:aM}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:dG}]},{type:a,value:"\nnode_modules\u002Fforever\u002Fbin\u002Fforever start "},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:dG}]},{type:a,value:"\u002Fbin\u002Fserver.js\nnode_modules\u002Fforever\u002Fbin\u002Fforever "},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:"--fifo"}]},{type:a,value:" logs "},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:dH}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"That’s it, it’s all I had."}]},{type:a,value:c},{type:b,tag:av,props:{id:aZ},children:[{type:b,tag:j,props:{href:dg,ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:a_}]},{type:a,value:c},{type:a,value:c},{type:b,tag:v,props:{style:bJ,className:[bK,bL,dI,dJ,dK]},children:[{type:a,value:c},{type:b,tag:T,props:{className:[bh],src:dL,alt:"A W3C Specification preview where we can see on the left the specification, and on the right the source highlighting changes in the source",figcaption:g},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"W3C Publican prototype build process helping with specification change tracking during review process"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:T,props:{className:[bh],src:dM,figcaption:g},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:dN}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{style:bJ,className:[bK,bL,dI,dJ,dK]},children:[{type:a,value:c},{type:b,tag:T,props:{className:[bh],src:dL,alt:"...",figcaption:g},children:[{type:a,value:"\n...\n"}]},{type:a,value:c},{type:b,tag:T,props:{className:[bh],src:dM,figcaption:g},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:dN}]},{type:a,value:c}]},{type:a,value:c}]}]},dir:cc,path:"\u002Fblog\u002F2015\u002F05\u002Frun-nodejs-process-forever-within-docker-container",extension:am,slug:"run-nodejs-process-forever-within-docker-container",createdAt:aO,updatedAt:"2024-10-24T19:43:51.727Z",category:ai,prettyfiedTemporalDate:{prettified:"Tuesday, May 12, 2015",temporalDate:"2015-05-12"}},{title:"Make Discourse “long polling” work behind Fastly or Varnish",locale:ak,created:"2015-05-03T00:00:00.000Z",updated:ap,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F05\u002Fmake-discourse-long-polling-work-behind-fastly\u002F",status:al,revising:R,caption:M,caracteresBizzares:M,gallery:M,migrateCode:R,migrateImages:R,migrateLinks:R,categories:[ai],tags:[aW,at,ad,dO],keywords:[bt,dP,aw,"Long Polling behind Varnish",dQ],excerpt:"In the Discourse forums, if you’ve seen something saying that you have to provide a different origin to make long polling work, maybe you didn’t understand what you have to do. Here are the details of why and how to do it correctly.",coverImage:{src:bv,text:bw},preamble:{text:dR},toc:[{id:dS,depth:S,text:dT}],body:{type:ae,children:[{type:b,tag:f,props:{},children:[{type:a,value:"While working on deploying Discourse, "},{type:b,tag:j,props:{href:"https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Ffull-site-cdn-acceleration-for-discourse\u002F21467\u002F4",rel:[l,m,n],target:o},children:[{type:a,value:"I've came across a statement that took\ntime for me to understand"}]},{type:a,value:". Discourse has a subsystem that's similar to\nWebSocket and Server Sent events which takes care to automatically update the\npage asynchronously. Note that this post "},{type:b,tag:j,props:{href:"https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Ffull-site-cdn-acceleration-for-discourse\u002F21467",rel:[l,m,n],target:o},children:[{type:a,value:"is canonical version of my answer"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The confusing part was;"}]},{type:a,value:c},{type:b,tag:aX,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:j,props:{href:dU,rel:[l,m,n],target:o},children:[{type:a,value:dV}]},{type:a,value:" To server \"long polling\" requests from a different domain, set the\nSite Setting long polling base url to the origin server. For example, if your\nCDN is pulling from \""},{type:b,tag:h,props:{},children:[{type:a,value:"http:\u002F\u002Fexample.org"}]},{type:a,value:"\" be sure to plug in\n"},{type:b,tag:h,props:{},children:[{type:a,value:dW}]},{type:a,value:" into the site setting. If you don't your site will be\nbroken."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This post is about clarifying why and how to work around this particular\nproblem."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The confusing part is that if \""},{type:b,tag:h,props:{},children:[{type:a,value:dW}]},{type:a,value:"\". If you are behind Fastly,\nyou have to use a CNAME entry and then you have to have a sub domain name and\nnot the top level."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:"Background:"}]},{type:a,value:" In DNS, a top level domain name (i.e. \"example.org\") can "},{type:b,tag:r,props:{},children:[{type:a,value:"only"}]},{type:a,value:"\nhave "},{type:b,tag:h,props:{},children:[{type:a,value:bi}]},{type:a,value:" records. Since Fastly requires we use a "},{type:b,tag:h,props:{},children:[{type:a,value:bj}]},{type:a,value:" entry, we have no\nchoice but to use a sub domain name."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Let's say that we will then use \""},{type:b,tag:h,props:{},children:[{type:a,value:"http:\u002F\u002Fdiscourse.example.org\u002F"}]},{type:a,value:"\" to serve our\nDiscourse forum so we can use Fastly."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Now there's this thing called \"long polling\" which is basically an "},{type:b,tag:h,props:{},children:[{type:a,value:"OPTION"}]},{type:a,value:" HTTP\nrequest with a long time before returning anything. If we use the Fastly or\nVarnish address, as Discourse would by default, Varnish will time out and \"long\npolling\" won't work."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:"More background:"}]},{type:a,value:" Varnish has this option to bypass in known contexts through\n"},{type:b,tag:h,props:{},children:[{type:a,value:"vcl_pipe"}]},{type:a,value:" which is roughly a raw TCP socket. But Fastly doesn't offer it\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fcommunity.fastly.com\u002Ft\u002Fvcl-pipe-heads-up\u002F163",rel:[l,m,n],target:o},children:[{type:a,value:"because of the "},{type:b,tag:r,props:{},children:[{type:a,value:"size"}]},{type:a,value:" of their setup"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:W,props:{id:dS},children:[{type:b,tag:j,props:{href:"#proposed-setup",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:dT}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Let's enable long polling and expose our site under Fastly. We'll need two\nnames, one pointing to Fastly's and the other to the IP addresses we give within\nthe service dashboard."}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:"discourse.example.org"}]},{type:a,value:" that's our desired Discourse site domain name"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:dX}]},{type:a,value:" (pick any name) that we'll configure in\nDiscourse to access directly to our public facing frontend web server"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"In my case, I generally have many web apps running that are only accessible from\nmy internal network. I refer to them as \"upstream\"; the same term NGINX uses in\ntheir config. Since this number of web apps you would host on a site can\nfluctuate, you might still want the number public IP address to remain stable.\nThat's why I setup a NGINX server in front that proxies to internal web app\nserver. I refer to them as \"frontends\"."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Let's say you have two public facing frontends running NGINX."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Those would be the ones you setup in Fastly like this."}]},{type:a,value:c},{type:b,tag:T,props:{style:ax,src:dY,figcaption:g},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:dZ}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here we see two "},{type:b,tag:r,props:{},children:[{type:a,value:"Backends"}]},{type:a,value:" in Fastly pannel at "},{type:b,tag:h,props:{},children:[{type:a,value:d_}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Notice that in this example i'm using "},{type:b,tag:h,props:{},children:[{type:a,value:bk}]},{type:a,value:" port because my backends are\nconfigured to communicate between Fastly and my frontends through TLS. But you\ndon't need to."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Quoting again @sam;"}]},{type:a,value:c},{type:b,tag:aX,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:j,props:{href:dU,rel:[l,m,n],target:o},children:[{type:a,value:dV}]},{type:a,value:" To server \"long polling\" requests from a different domain, set the\nSite Setting long polling base url to the origin server."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Really means here is that we would have to put one of those IP addresses in\nDiscourse settings."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"What I'd recommend is to create a list of "},{type:b,tag:h,props:{},children:[{type:a,value:bi}]},{type:a,value:" entries for all your frontends."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"In the end we need three things:"}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"What's the public name that Fastly will serve"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Which IPs are the frontends"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Which hostname we want to use for long polling and we'll add it to our\nVirtualHost"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The zone file would look like this;"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,d$]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"# The public facing URL\ndiscourse.example.org.  "},{type:b,tag:d,props:{className:[e,aP,t]},children:[{type:a,value:aQ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aR,t]},children:[{type:a,value:bj}]},{type:a,value:" global.prod.fastly.net.\n\n# The list of IP addresses you’d give to Fastly as origins\u002Fbackends\nfrontends.example.org.  "},{type:b,tag:d,props:{className:[e,aP,t]},children:[{type:a,value:aQ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aR,t]},children:[{type:a,value:bi}]},{type:a,value:" 8.8.8.113\nfrontends.example.org.  "},{type:b,tag:d,props:{className:[e,aP,t]},children:[{type:a,value:aQ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aR,t]},children:[{type:a,value:bi}]},{type:a,value:" 8.8.8.115\n\n# The long polling URL entry\ndiscoursepolling.example.org.  "},{type:b,tag:d,props:{className:[e,aP,t]},children:[{type:a,value:aQ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aR,t]},children:[{type:a,value:bj}]},{type:a,value:" frontends.example.org.\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"That way you can setup the \"long polling base url\" correctly without setting a\nsingle point of failure."}]},{type:a,value:c},{type:b,tag:T,props:{style:ax,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fdiscourse-polling-ui.png",figcaption:"In Discourse admin, adjust long polling base url setting"},children:[{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Then, we can go in Discourse admin zone and adjust the \"long polling base url\"\nto our other domain name."}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,ca]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# \u002Fetc\u002Fnginx\u002Fsites-enabled\u002F10-discourse"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Let’s redirect to SSL, in case somebody tries to access the direct IP with"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# host header."}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aN}]}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:be}]},{type:a,value:bl},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:dB}]}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bf}]},{type:a,value:ea}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bm}]},{type:a,value:"     common_params"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"return"}]},{type:a,value:bl},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:"301"}]},{type:a,value:" https:\u002F\u002F"},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:"$server_name"}]},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:"$request_uri"}]}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aN}]}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:be}]},{type:a,value:bl},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:bk}]},{type:a,value:eb}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bf}]},{type:a,value:ea}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Rest of NGINX server block"}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Also, I would make a condition if we are in discoursepolling but not"}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# under using anything specific to polling."}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# #TODO; find paths specific to polling"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"To see if it works; look at your web browser developer tool \"Network inspector\"\nfor "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fpoll"}]},{type:a,value:" calls on "},{type:b,tag:h,props:{},children:[{type:a,value:dX}]},{type:a,value:", and see if you have\n"},{type:b,tag:h,props:{},children:[{type:a,value:"200 OK"}]},{type:a,value:" status code."}]},{type:a,value:c},{type:b,tag:T,props:{style:ax,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fdiscourse-polling.png",figcaption:"Use your web browser developer tools and inspect network traffic to see if requests made to discoursepolling worked"},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Note that this screenshot is showing "},{type:b,tag:h,props:{},children:[{type:a,value:bB}]},{type:a,value:" but that's beside the\npoint i'm trying to illustrate."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Hope this helped."}]}]},dir:cc,path:"\u002Fblog\u002F2015\u002F05\u002Fmake-discourse-long-polling-work-behind-fastly",extension:am,slug:"make-discourse-long-polling-work-behind-fastly",createdAt:aO,updatedAt:aO,category:ai,prettyfiedTemporalDate:{prettified:"Sunday, May 3, 2015",temporalDate:"2015-05-03"}},{title:"Converting a dynamic site into static HTML documents",locale:ak,created:"2015-05-20T00:00:00.000Z",updated:ap,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F05\u002Fconverting-dynamic-site-static-copy\u002F",status:al,revising:R,caption:M,caracteresBizzares:M,gallery:M,migrateCode:R,migrateImages:M,migrateLinks:M,categories:[cd],tags:[cz,aq,ad,cd],keywords:["curl",ay,"static site","convert from cms"],coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fwebat25-org-screen-capture.png",alt:"Web 25th anniversary web site screenshot",text:"In March 2014, the W3C and the Web Foundation celebrated the World Wide Web 24th anniversary.\nAs a W3C Team Member, I was asked to help the systems team and host the event’s web site.\nAfter the event, I was asked to make the web site to become static HTML documents so the systems team wouldn’t have to maintain the CMS it was using.\n"},excerpt:"The following are the commands I ran on the last successful attempt to replicate the site I was working on. If you want to make a static version of your site, you might find those helpful.",preamble:{disable:R,text:g},toc:[{id:aC,depth:S,text:aD},{id:ec,depth:S,text:ed},{id:ee,depth:S,text:ef},{id:eg,depth:S,text:eh}],body:{type:ae,children:[{type:b,tag:f,props:{},children:[{type:a,value:"Its been two times now that I've been asked to make a website that was running\non a CMS and make it static."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This is an useful practice if you want to keep the site content for posterity\nwithout having to maintain the underlying CMS. It makes it easier to migrate\nsites since the sites that you know you won't add content to anymore becomes\nsimply a bunch of HTML files in a folder."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"My end goal was to make an EXACT copy of what the site is like when generated by\nthe CMS, BUT now stored as simple HTML files. When I say EXACT, I mean it, even\nas to keep documents at their original location from the new static files. It\nmeans that each HTML document had to keep their same value BUT that a file will\nexist and the web server will find it. For example, if a link points to "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Ffoo"}]},{type:a,value:",\nthe link in the page remain as-is, even though its now a static file at\n"},{type:b,tag:h,props:{},children:[{type:a,value:ei}]},{type:a,value:", but the web server will serve "},{type:b,tag:h,props:{},children:[{type:a,value:ei}]},{type:a,value:" anyway."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here are a few steps I made to achieve just that. Notice that your mileage may\nvary, I've done those steps and they worked for me."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"I've done this procedure a few times with WordPress blogs along with\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.w3.org\u002Fwebat25\u002F",rel:[l,m,n],target:o},children:[{type:b,tag:E,props:{},children:[{type:a,value:"webat25.org"}]},{type:a,value:" that is now hosted as "},{type:b,tag:E,props:{},children:[{type:a,value:"w3.org\u002Fwebat25\u002F"}]}]},{type:a,value:" website that was\nrunning on ExpressionEngine."}]},{type:a,value:c},{type:b,tag:W,props:{id:aC},children:[{type:b,tag:j,props:{href:bP,ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:aD}]},{type:a,value:c},{type:b,tag:W,props:{id:ec},children:[{type:b,tag:j,props:{href:"#1-browse-and-get-all-pages-you-think-could-be-lost-in-scraping",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:ed}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"We want a simple file with one web page per line with its full address. This\nwill help the crawler to not forget pages."}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Use a web browser developer tool Network inspector, keep it open with\n\"preserve log\"."}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Once you browsed the site a bit, from the network inspector tool, list all\ndocuments and then export using the \"Save as HAR\" feature."}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Extract urls from har file using "},{type:b,tag:h,props:{},children:[{type:a,value:"underscore-cli"}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"npm install underscore-cli cat site.har | underscore select '.entries .request\n.url' \u003E workfile.txt"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Remove first and last lines (its a JSON array and we want one document per\nline)"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Remove the trailing remove hostname from each line (i.e. start by \u002Fpath), in\nvim you can do "},{type:b,tag:h,props:{},children:[{type:a,value:"%s\u002Fhttp:\\\u002F\\\u002Fwww\\.example.org\u002F\u002Fg"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Remove "},{type:b,tag:h,props:{},children:[{type:a,value:Y}]},{type:a,value:bQ},{type:b,tag:h,props:{},children:[{type:a,value:"\","}]},{type:a,value:" from each lines, in vim you can do "},{type:b,tag:h,props:{},children:[{type:a,value:"%s\u002F\",$\u002F\u002Fg"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"At the last line, make sure the "},{type:b,tag:h,props:{},children:[{type:a,value:Y}]},{type:a,value:" is removed too because the last regex\nmissed it"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Remove duplicate lines, in vim you can do "},{type:b,tag:h,props:{},children:[{type:a,value:":sort u"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Save this file as "},{type:b,tag:h,props:{},children:[{type:a,value:"list.txt"}]},{type:a,value:" for the next step."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:W,props:{id:ee},children:[{type:b,tag:j,props:{href:"#2-lets-scrape-everything",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:ef}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"We'll do two scrapes. First one is to get all assets it can get, then we'll go\nagain with different options."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The following are the commands I ran on the last successful attempt to replicate\nthe site I was working on. This is not a statement that this method is the most\nefficient technique. Please feel free to improve the document as you see fit."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"First a quick TL;DR of "},{type:b,tag:h,props:{},children:[{type:a,value:ay}]},{type:a,value:" options"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"-m"}]},{type:a,value:bn},{type:b,tag:h,props:{},children:[{type:a,value:ce}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:cf}]},{type:a,value:bn},{type:b,tag:h,props:{},children:[{type:a,value:"--convert-links"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:ej}]},{type:a,value:bn},{type:b,tag:h,props:{},children:[{type:a,value:"--backup-converted"}]},{type:a,value:" which creates .orig files"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:aE}]},{type:a,value:bn},{type:b,tag:h,props:{},children:[{type:a,value:"--page-requisites"}]},{type:a,value:" makes a page to get ALL requirements"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:ek}]},{type:a,value:" ensures we dont download the same file twice and end up with duplicates\n(e.g. file.html AND file.1.html)"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"--cut-dirs"}]},{type:a,value:" would prevent creating directories and mix things around, do not\nuse."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Notice that we're sending headers as if we were a web browser. Its up to you."}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bg}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aH,p]},children:[{type:a,value:"UA"}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'Mozilla\u002F5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F40.0.2214.94 Safari\u002F537.36'"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bg}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aH,p]},children:[{type:a,value:"ACCEPTL"}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'Accept-Language: fr-FR,fr;q=0.8,fr-CA;q=0.6,en-US;q=0.4,en;q=0.2'"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:bg}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aH,p]},children:[{type:a,value:"ACCEPTT"}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'Accept: text\u002Fhtml,application\u002Fxhtml+xml,application\u002Fxml;q=0.9,image\u002Fwebp,*\u002F*;q=0.8'"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ay}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:cg}]},{type:a,value:el},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:ek}]},{type:a,value:" --random-wait "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:as},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:ce}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:as},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aS}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aH,p]},children:[{type:a,value:em}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:a,value:en},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n     --no-cache "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:as},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:cf}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:eo}]},{type:a,value:" --page-requisites "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:ep},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:eq}]},{type:a,value:Y}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:as},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:ch}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:er}]},{type:a,value:Y}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:es}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Then, another pass"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ay}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:cg}]},{type:a,value:el},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:ce}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:as},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aS}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aH,p]},children:[{type:a,value:em}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:a,value:en},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:as},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:cf}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:ej}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:eo}]},{type:a,value:" --no-cache --no-parent "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:ep},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:eq}]},{type:a,value:Y}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:as},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:ch}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:"$ACCEPTL"}]},{type:a,value:Y}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:as},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:ch}]},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:ah}]},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:Y},{type:b,tag:d,props:{className:[e,p]},children:[{type:a,value:er}]},{type:a,value:Y}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:es}]}]}]},{type:a,value:c},{type:b,tag:W,props:{id:eg},children:[{type:b,tag:j,props:{href:"#3-do-some-cleanup-on-the-fetched-files",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:eh}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here are a few commands I ran to clean the files a bit"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Remove empty lines in every .orig files. They're the ones we'll use in the end\nafter all"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bo}]},{type:a,value:bp},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:"-regextype"}]},{type:a,value:" posix-egrep "},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:"-regex"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'.*\\.orig$'"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:et}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bq}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:cg}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'s\u002F\\r\u002F\u002F'"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Rename the .orig file into html"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:br}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'*orig'"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:az}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bq}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aS}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"p;s\u002Forig\u002Fhtml\u002F\""}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:az}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ci}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:cj}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bd}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bo}]},{type:a,value:bp},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:br}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'*\\.html\\.html'"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:az}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bq}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aS}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"p;s\u002F\\.html\u002F\u002F\""}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:az}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ci}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:cj}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bd}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Many folders might have only an index.html file in it. Let's just make them a\nfile without directory"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bo}]},{type:a,value:bp},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:br}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'index.html'"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:az}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bq}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:aS}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"p;s\u002F\\\u002Findex\\.html\u002F.html\u002F\""}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:az}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ci}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:cj}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bd}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Remove files that has a "},{type:b,tag:h,props:{},children:[{type:a,value:".1"}]},{type:a,value:" (or any number in them), they are most likely\nduplicates anyway"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bo}]},{type:a,value:bp},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:br}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"'*\\.1\\.*'"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:et}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:"rm"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:"-rf"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:c}]}]}]},{type:a,value:c}]},{type:a,value:c}]}]},dir:cc,path:"\u002Fblog\u002F2015\u002F05\u002Fconverting-dynamic-site-static-copy",extension:am,slug:"converting-dynamic-site-static-copy",createdAt:aO,updatedAt:aO,category:cd,prettyfiedTemporalDate:{prettified:"Wednesday, May 20, 2015",temporalDate:"2015-05-20"}},{title:"Setting up Discourse with Fastly as a CDN provider and TLS",locale:ak,created:"2015-04-29T00:00:00.000Z",updated:ap,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F04\u002Fsetting-discourse-fastly-cdn-provider-ssl\u002F",status:al,revising:R,caption:M,caracteresBizzares:M,gallery:M,migrateCode:R,migrateImages:R,migrateLinks:M,categories:[ai],tags:[at,dO,ad,aW,"caching","varnish"],keywords:[bt,dP,aw,eu,"NGINX",dQ],preamble:{text:dR},coverImage:{src:bv,text:bw},excerpt:"Here’s how I setup a Discourse web application so that I can scale it by adding more Docker instances while keeping a low number of exposed web servers",description:"Allow horizontal scaling by separating internal app servers from exposed frontend web servers",title_alternate:ev,toc:[{id:ew,depth:S,text:ex},{id:aC,depth:S,text:aD}],body:{type:ae,children:[{type:b,tag:f,props:{},children:[{type:a,value:"The following is a copy of what I published in a question on\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fenable-a-cdn-for-your-discourse\u002F14857\u002F26?u=renoirb",rel:[l,m,n],target:o},children:[{type:b,tag:r,props:{},children:[{type:a,value:"meta.discourse.org"}]},{type:a,value:" about \""},{type:b,tag:E,props:{},children:[{type:a,value:ev}]},{type:a,value:Y}]},{type:a,value:" while\nworking on "},{type:b,tag:r,props:{},children:[{type:a,value:"discuss.webplatform.org"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:W,props:{id:ew},children:[{type:b,tag:j,props:{href:"#setup-detail",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:ex}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Our setup uses "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.fastly.com\u002F",rel:[l,m,n],target:o},children:[{type:a,value:aw}]},{type:a,value:", and leverage "},{type:b,tag:j,props:{href:ey,rel:[l,m,n],target:o},children:[{type:a,value:"their SSL feature"}]},{type:a,value:". Note that in\norder for you to use SSL too, you'll have to contact them to have it onto your\naccount."}]},{type:a,value:c},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:"SEE ALSO"}]},{type:a,value:" this "},{type:b,tag:an,props:{to:ez},children:[{type:a,value:"post about "},{type:b,tag:r,props:{},children:[{type:a,value:eA}]}]},{type:a,value:". This step is "},{type:b,tag:E,props:{},children:[{type:a,value:"required"}]},{type:a,value:" and is a logical next step to this\nprocedure."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"In summary;"}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:eB},{type:b,tag:r,props:{},children:[{type:a,value:"users"}]},{type:a,value:bQ},{type:b,tag:r,props:{},children:[{type:a,value:aw}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:eB},{type:b,tag:r,props:{},children:[{type:a,value:aw}]},{type:a,value:" and \""},{type:b,tag:r,props:{},children:[{type:a,value:ck}]},{type:a,value:"\" servers. (That's the IP we put into\nFastly hosts configuration, and are also refered to as \"origins\" or \"backends\"\nin CDN-speak)"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Docker Discourse instance (\""},{type:b,tag:r,props:{},children:[{type:a,value:bs}]},{type:a,value:"\") which listens only on private network\nand port (e.g. "},{type:b,tag:r,props:{},children:[{type:a,value:"10.10.10.3:8000"}]},{type:a,value:af}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"More than two publicly exposed web servers (\""},{type:b,tag:r,props:{},children:[{type:a,value:ck}]},{type:a,value:"\"), with SSL, that we\nuse as \""},{type:b,tag:r,props:{},children:[{type:a,value:"backends"}]},{type:a,value:"\" in "},{type:b,tag:r,props:{},children:[{type:a,value:aw}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:r,props:{},children:[{type:a,value:ck}]},{type:a,value:" server running NGINX with an "},{type:b,tag:j,props:{href:"https:\u002F\u002Fnginx.org\u002Fen\u002Fdocs\u002Fhttp\u002Fngx_http_upstream_module.html",rel:[l,m,n],target:o},children:[{type:b,tag:r,props:{},children:[{type:a,value:bs}]},{type:a,value:" block"}]},{type:a,value:" proxying\ninternal "},{type:b,tag:r,props:{},children:[{type:a,value:bs}]},{type:a,value:" web servers that the Discourse Docker provides."}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"We use NGINX's "},{type:b,tag:h,props:{},children:[{type:a,value:eC}]},{type:a,value:" HTTP header in the frontend to make sure we\nminimize connections"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Using this method, if we need to scale, we only need add more internal\n"},{type:b,tag:r,props:{},children:[{type:a,value:"Discourse Docker instances"}]},{type:a,value:", we can add more NGINX upstream entries."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Note that I recommend to use direct private IP addresses instead of internal\nnames. It removes complexity and the need to rewrite "},{type:b,tag:h,props:{},children:[{type:a,value:"Hosts:"}]},{type:a,value:" HTTP headers."}]},{type:a,value:c},{type:b,tag:W,props:{id:aC},children:[{type:b,tag:j,props:{href:bP,ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:aD}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Everything is the same as basic Fastly configuration, refer to "},{type:b,tag:j,props:{href:"https:\u002F\u002Fdocs.fastly.com\u002Fguides\u002Fgetting-started\u002Fsign-up-and-create-your-first-service",rel:[l,m,n],target:o},children:[{type:a,value:"setup your\ndomain"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here are the differences;"}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Setup your domain name with the CNAME Fastly will provide you ("},{type:b,tag:j,props:{href:ey,rel:[l,m,n],target:o},children:[{type:a,value:"you will have\nto contact them for your account though"}]},{type:a,value:"), ours is like that ;"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,d$]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"discuss.webplatform.org. "},{type:b,tag:d,props:{className:[e,aP,t]},children:[{type:a,value:aQ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aR,t]},children:[{type:a,value:bj}]},{type:a,value:" webplatform.map.fastly.net.\n"}]}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"In Fastly pannel at "},{type:b,tag:h,props:{},children:[{type:a,value:d_}]},{type:a,value:", we tell which publicly available\n"},{type:b,tag:r,props:{},children:[{type:a,value:eD}]},{type:a,value:" IPs"}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Notice we use port "},{type:b,tag:h,props:{},children:[{type:a,value:bk}]},{type:a,value:aB},{type:b,tag:j,props:{href:"https:\u002F\u002Fdocs.fastly.com\u002Fguides\u002Fssl\u002Fcan-i-use-ssl-to-communicate-to-my-backend-servers",rel:[l,m,n],target:o},children:[{type:a,value:"so SSL is between "},{type:b,tag:r,props:{},children:[{type:a,value:aw}]},{type:a,value:" and our "},{type:b,tag:r,props:{},children:[{type:a,value:eD}]}]},{type:a,value:".\nAlso, you "},{type:b,tag:E,props:{},children:[{type:a,value:"can"}]},{type:a,value:" setup "},{type:b,tag:r,props:{},children:[{type:a,value:"Shielding"}]},{type:a,value:" (which is how you activate the CDN behavior\nwithin Fastly) by enabling it on only one. I typically set it on the one I call\n\"first\"."}]},{type:a,value:c},{type:b,tag:T,props:{style:ax,src:dY,figcaption:dZ},children:[{type:a,value:c}]},{type:a,value:c},{type:b,tag:Z,props:{start:ao},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"In Fastly pannel "},{type:b,tag:h,props:{},children:[{type:a,value:"Configure -\u003E Settings -\u003E Request Settings"}]},{type:a,value:"; we make sure we\nforward "},{type:b,tag:h,props:{},children:[{type:a,value:"X-Forwarded-For"}]},{type:a,value:" header. You "},{type:b,tag:E,props:{},children:[{type:a,value:"DONT"}]},{type:a,value:" need this; you can remove it."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:T,props:{style:ax,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F04\u002Fdiscuss-fastly-XFF.png",figcaption:"Fastly service configuration, at Settings tab"},children:[{type:a,value:c}]},{type:a,value:c},{type:b,tag:Z,props:{start:eE},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Frontend NGINX server has a block similar to this."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"In our case, we use "},{type:b,tag:j,props:{href:"https:\u002F\u002Fsaltstack.com\u002Fcommunity\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"Salt Stack"}]},{type:a,value:" as the configuration management system, it\nbasically generates the Virtual Hosts for us as using "},{type:b,tag:j,props:{href:"https:\u002F\u002Fdocs.saltstack.com\u002Fen\u002Flatest\u002Ftopics\u002Freactor\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"Salt reactor"}]},{type:a,value:" system.\nEvery time a Docker instance would become available, the configuration will be\nrewritten using this template."}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"{{ upstream_port }}"}]},{type:a,value:" would be at "},{type:b,tag:h,props:{},children:[{type:a,value:"8000"}]},{type:a,value:" in this example"}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"{{ upstreams }}"}]},{type:a,value:" would be an array of current internal Docker instances, e.g.\n"},{type:b,tag:h,props:{},children:[{type:a,value:"['10.10.10.3','10.10.10.4']"}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"{{ tld }}"}]},{type:a,value:" would be "},{type:b,tag:r,props:{},children:[{type:a,value:bB}]},{type:a,value:" in production, but can be anything else\nwe need in other deployment, it gives great flexibility."}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Notice the use of "},{type:b,tag:h,props:{},children:[{type:a,value:"discoursepolling"}]},{type:a,value:" alongside the "},{type:b,tag:h,props:{},children:[{type:a,value:cs}]},{type:a,value:" subdomain name.\nRefer to "},{type:b,tag:an,props:{to:ez},children:[{type:a,value:"this post about "},{type:b,tag:r,props:{},children:[{type:a,value:eA}]}]},{type:a,value:" to understand its purpose"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,ca]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bs}]},{type:a,value:" upstream_discourse"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:"%- for b in upstreams %"},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aN}]}]},{type:a,value:"    "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:" b "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:ac},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:" upstream_port "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:"%- endfor %"},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:eC}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:"16"}]}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:_},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:aN}]}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:be}]},{type:a,value:bl},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:bk}]},{type:a,value:eb}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bf}]},{type:a,value:" discoursepolling."}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:eF},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"discourse."}]}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:eF},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:cl},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:ae}]},{type:a,value:"    \u002Fvar\u002Fwww\u002Fhtml"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bm}]},{type:a,value:" common_params"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bm}]},{type:a,value:" ssl_params"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:cl},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"ssl"}]},{type:a,value:"                 "},{type:b,tag:d,props:{className:[e,b$]},children:[{type:a,value:eG}]}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"ssl_certificate"}]},{type:a,value:"     \u002Fetc\u002Fssl\u002F2015\u002Fdiscuss.pem"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"ssl_certificate_key"}]},{type:a,value:" \u002Fetc\u002Fssl\u002F2015\u002F201503.key"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:cl},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Use internal Docker runner instance exposed port"}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:dC}]},{type:a,value:dD}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:P}]},{type:a,value:aA},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"proxy_pass"}]},{type:a,value:"             http:\u002F\u002Fupstream_discourse"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:aA},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:bm}]},{type:a,value:"                proxy_params"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:aA},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"proxy_intercept_errors"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,b$]},children:[{type:a,value:eG}]}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:"\n\n        "},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# Backend keepalive"}]},{type:a,value:aA},{type:b,tag:d,props:{className:[e,C]},children:[{type:a,value:"# ref: http:\u002F\u002Fnginx.org\u002Fen\u002Fdocs\u002Fhttp\u002Fngx_http_upstream_module.html#keepalive"}]},{type:a,value:aA},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"proxy_http_version"}]},{type:a,value:" 1.1"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:aA},{type:b,tag:d,props:{className:[e,D]},children:[{type:b,tag:d,props:{className:[e,t]},children:[{type:a,value:"proxy_set_header"}]},{type:a,value:" Connection "},{type:b,tag:d,props:{className:[e,B]},children:[{type:a,value:"\"\""}]}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:K}]},{type:a,value:N},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:Q}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Note that I removed the "},{type:b,tag:h,props:{},children:[{type:a,value:"include proxy_params;"}]},{type:a,value:" line. If you have lines similar\nto "},{type:b,tag:h,props:{},children:[{type:a,value:"proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;"}]},{type:a,value:", you don't\nneed them (!)"}]}]},dir:cm,path:"\u002Fblog\u002F2015\u002F04\u002Fsetting-discourse-fastly-cdn-provider-ssl",extension:am,slug:"setting-discourse-fastly-cdn-provider-ssl",createdAt:aU,updatedAt:aU,category:ai,prettyfiedTemporalDate:{prettified:"Wednesday, April 29, 2015",temporalDate:"2015-04-29"}},{title:"Upgrade to Python 2.7.9 on Ubuntu 14.04 LTS and make your own .deb package for deployment",locale:ak,created:"2015-04-05T00:00:00.000Z",updated:ap,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F04\u002Fupgrade-python-2-7-9-ubuntu-14-04-lts-making-deb-package\u002F",status:al,revising:R,caption:M,caracteresBizzares:M,gallery:M,migrateCode:R,migrateImages:M,migrateLinks:M,categories:[ai],tags:[ad,aq,at,"best-practices"],keywords:["Python","ubuntu"],excerpt:"Need to run your web app with Python 2.7.9, but server environment uses Ubuntu Long Term Support? Don’t replace Python, leverage VirtualEnv instead!",toc:[{id:eH,depth:S,text:eI},{id:aq,depth:S,text:eJ},{id:eK,depth:S,text:eL},{id:eM,depth:ao,text:eN},{id:eO,depth:S,text:eP}],body:{type:ae,children:[{type:b,tag:f,props:{},children:[{type:a,value:"I had this post hanging in my drafts on how I attempted to install a valid\nPython 2.7.9 runtime environment on Ubuntu 14.04 and make my own .deb package\nfor easy re-deployment."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:cq}]},{type:a,value:" This procedure isn't complete as I had to shift focus elsewhere. I\nmight rework this article to adjust what's missing."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"While I understand that Ubuntu 14.04 "},{type:b,tag:j,props:{href:"https:\u002F\u002Faskubuntu.com\u002Fquestions\u002F559036\u002Fwhen-will-the-python-2-7-9-upgrades-be-available-from-apt-get-for-14-04lts#answer-560159",rel:[l,m,n],target:o},children:[{type:a,value:"will"}]},{type:a,value:g},{type:b,tag:j,props:{href:"https:\u002F\u002Fserverfault.com\u002Fquestions\u002F669859\u002Fhow-can-i-upgrade-python-to-2-7-9-on-ubuntu-14-4",rel:[l,m,n],target:o},children:[{type:a,value:"remain"}]},{type:a,value:" using "},{type:b,tag:r,props:{},children:[{type:a,value:"Python 2.7.6"}]},{type:a,value:"\ninternally, applications we run can be configured to use another python\nenvironment. Its what virtualenv is all about after all, isn't it."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This post attempts to install, and make an installable "},{type:b,tag:r,props:{},children:[{type:a,value:".deb"}]},{type:a,value:" package of\n"},{type:b,tag:E,props:{},children:[{type:a,value:"Python 2.7.9"}]},{type:a,value:" and is meant to be used by web applications without touching\nthe system's python runtime."}]},{type:a,value:c},{type:b,tag:W,props:{id:eH},children:[{type:b,tag:j,props:{href:"#why-not-replacing-internal-python-version",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:eI}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The reason is simple. If you replace internal Python version, other softwares\nwithin the OS will have broken dependencies."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"I realized this while I wanted to upgrade the version and breaking an hard\ndependency I have on Salt Stack. Since many components within a given Ubuntu\nversion relies on Python, it could break anything else. This is why I stopped\nworking on the idea of replacing internally, but instead to configure VirtualEnv\nto use another version instead."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"If you see procedures that shows you to replace telling you to use\n"},{type:b,tag:h,props:{},children:[{type:a,value:"update-alternatives"}]},{type:a,value:" to replace python, don't do it! Go instead learn how to\nrun your own Python version in VirtualEnv."}]},{type:a,value:c},{type:b,tag:W,props:{id:aq},children:[{type:b,tag:j,props:{href:"#procedure",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:eJ}]},{type:a,value:c},{type:b,tag:Z,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Install build dependencies"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Those were the ones I ran last before a successful build on "},{type:b,tag:E,props:{},children:[{type:a,value:"Ubuntu 14.04\nLTS"}]},{type:a,value:", if you aren't using the same distribution, you might get a different\nlist."}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bZ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aF}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:eQ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        autotools-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        blt-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:aA},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:"bzip2"}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        dpkg-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        g++-multilib "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        gcc-multilib "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:eR},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:eR},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:eS},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:eS},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:eT},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:eT},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libffi-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libffi6 "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libffi6-dbg "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libgdbm-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libgpm2 "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libncursesw5-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libreadline-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libsqlite3-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:eU},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:eU},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        libtinfo-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        mime-support "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        net-tools "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        netbase "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        python-crypto "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        python-mox3 "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        python-pil "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        python-ply "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        quilt "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        tk-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        zlib1g-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        zlib1g-dev\n"}]}]}]},{type:a,value:c},{type:b,tag:Z,props:{start:S},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Get Python sources and compile"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ay}]},{type:a,value:" https:\u002F\u002Fwww.python.org\u002Fftp\u002Fpython\u002F2.7.9\u002FPython-2.7.9.tgz\n"},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:"tar"}]},{type:a,value:" xfz Python-2.7.9.tgz\n"},{type:b,tag:d,props:{className:[e,U,V]},children:[{type:a,value:aM}]},{type:a,value:" Python-2.7.9\u002F\n.\u002Fconfigure "},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:"--prefix"}]},{type:a,value:" \u002Fusr\u002Flocal\u002Flib\u002Fpython2.7.9 --enable-ipv6\n"},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:eV}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:eV}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aF}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:Z,props:{start:ao},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Test if the version works"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fusr\u002Flocal\u002Flib\u002Fpython2.7.9\u002Fbin\u002Fpython "},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:"-V"}]},{type:a,value:"\n\nPython "},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:"2.7"}]},{type:a,value:".9\n"}]}]}]},{type:a,value:c},{type:b,tag:Z,props:{start:eE},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:a,value:"Then prepare package through FPM"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:bZ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aF}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:eQ}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        ruby-dev "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:q}]},{type:a,value:"\n        gcc\n\ngem "},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aF}]},{type:a,value:" fpm\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Its basically about creating a .deb based on your new runtime setup. You can do\nthat by using "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fjordansissel\u002Ffpm",rel:[l,m,n],target:o},children:[{type:a,value:"fpm"}]},{type:a,value:" (\"Fabulous Package Manager\"), I am "},{type:b,tag:j,props:{href:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F02\u002Finstall-php5-memcached-pecl-extension-support-igbinary\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"using this technique\nin a post I published recently about installing a PHP library"}]},{type:a,value:O}]},{type:a,value:c},{type:b,tag:W,props:{id:eK},children:[{type:b,tag:j,props:{href:"#incomplete-scratchpad",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:eL}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"But that's as far as my notes goes for now. Sorry about that."}]},{type:a,value:c},{type:b,tag:av,props:{id:eM},children:[{type:b,tag:j,props:{href:"#setuptools",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:eN}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"As per recommended in "},{type:b,tag:j,props:{href:"https:\u002F\u002Fpypi.python.org\u002Fpypi\u002Fsetuptools#unix-wget",rel:[l,m,n],target:o},children:[{type:a,value:"Setuptools instructions"}]},{type:a,value:", we can run "},{type:b,tag:h,props:{},children:[{type:a,value:"easy_install"}]},{type:a,value:"\nthrough a "},{type:b,tag:h,props:{},children:[{type:a,value:ay}]},{type:a,value:", like so;"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:ay}]},{type:a,value:" https:\u002F\u002Fbootstrap.pypa.io\u002Fez_setup.py "},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:"-O"}]},{type:a,value:" - "},{type:b,tag:d,props:{className:[e,z]},children:[{type:a,value:az}]},{type:a,value:" \u002Fusr\u002Flocal\u002Flib\u002Fpython2.7.9\u002Fbin\u002Fpython\n\n  \u002Fusr\u002Flocal\u002Flib\u002Fpython2.7.9\u002Fbin\u002Feasy_install pip\n  \u002Fusr\u002Flocal\u002Flib\u002Fpython2.7.9\u002Fbin\u002Fpip "},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:aF}]},{type:a,value:" virtualenv\n\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Then, create symbolic links"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:eW}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bT}]},{type:a,value:" \u002Fusr\u002Flocal\u002Flib\u002Fpython2.7.9\u002Fbin\u002Feasy_install \u002Fusr\u002Fbin\u002Feasy_install\n"},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:eW}]},{type:a,value:g},{type:b,tag:d,props:{className:[e,s,p]},children:[{type:a,value:bT}]},{type:a,value:" \u002Fusr\u002Flocal\u002Flib\u002Fpython2.7.9\u002Fbin\u002Fpip \u002Fusr\u002Fbin\u002Fpip\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"You can try if it worked"}]},{type:a,value:c},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[A,y]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"pip list\n\n  pip "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:cn}]},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:"6.0"}]},{type:a,value:".8"},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:af}]},{type:a,value:"\n  setuptools "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:cn}]},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:"14.3"}]},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:af}]},{type:a,value:"\n  virtualenv "},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:cn}]},{type:b,tag:d,props:{className:[e,aa]},children:[{type:a,value:"12.0"}]},{type:a,value:".7"},{type:b,tag:d,props:{className:[e,i]},children:[{type:a,value:af}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:W,props:{id:eO},children:[{type:b,tag:j,props:{href:"#resources",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:eP}]},{type:a,value:c},{type:b,tag:L,props:{},children:[{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:eX,rel:[l,m,n],target:o},children:[{type:a,value:eX}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:eY,rel:[l,m,n],target:o},children:[{type:a,value:eY}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:eZ,rel:[l,m,n],target:o},children:[{type:a,value:eZ}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:e_,rel:[l,m,n],target:o},children:[{type:a,value:e_}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:e$,rel:[l,m,n],target:o},children:[{type:a,value:e$}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:fa,rel:[l,m,n],target:o},children:[{type:a,value:fa}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:fb,rel:[l,m,n],target:o},children:[{type:a,value:fb}]}]},{type:a,value:c},{type:b,tag:k,props:{},children:[{type:b,tag:j,props:{href:"http:\u002F\u002Fwww.stylesen.org\u002Fpython%5C_27%5C_debian%5C_squeeze%5C_60",rel:[l,m,n],target:o},children:[{type:a,value:"http:\u002F\u002Fwww.stylesen.org\u002Fpython\\_27\\_debian\\_squeeze\\_60"}]}]},{type:a,value:c}]}]},dir:cm,path:"\u002Fblog\u002F2015\u002F04\u002Fupgrade-python-2-7-9-ubuntu-14-04-lts-making-deb-package",extension:am,slug:"upgrade-python-2-7-9-ubuntu-14-04-lts-making-deb-package",createdAt:aU,updatedAt:aU,category:ai,prettyfiedTemporalDate:{prettified:"Sunday, April 5, 2015",temporalDate:"2015-04-05"}},{title:"How to run your own OAuth Identity provider service",locale:ak,created:"2015-04-13T00:00:00.000Z",updated:ap,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F04\u002Frun-oauth-identity-provider-service\u002F",status:al,revising:M,categories:[aV],tags:[ad,cx],keywords:["IdP","OAuth","Authorization",eu],coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F03\u002FOauth_logo.png",text:"[OAuth logo][oauth], see also [its current **Specification** document][oauth-spec]\n[oauth-spec]: https:\u002F\u002Foauth.net\u002F2\u002F\n[oauth]: https:\u002F\u002Foauth.net\u002F\n"},preamble:{text:"All infrastructure related to WebPlatform Docs is shut down since 2016.\nMentions about SSO and OAuth is still (2020) accessible from the archived [`webplatform.github.io\u002Fdocs\u002FWPD\u002FProjects\u002FSSO` wiki pages][wpd-projects-sso].\n[wpd-projects-sso]: https:\u002F\u002Fwebplatform.github.io\u002Fdocs\u002FWPD\u002FProjects\u002FSSO\u002F\n",figcaption:g},excerpt:"Tutorials and explanation on how to be your own OAuth Identity Provider are very scarce and I’ve come to achieve this, this is an attempt to outline the basics.",toc:[{id:fc,depth:S,text:fd},{id:fe,depth:S,text:ff},{id:fg,depth:S,text:fh}],body:{type:ae,children:[{type:b,tag:f,props:{},children:[{type:a,value:"Generally, we connect our application against a provider so it can share details\nabout a user. Most of the documentation you'll find online explains how to use\ntheir service, but very few outlines concisely how it is if you want to be your\nown provider and share state across applications you also manage."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Documentation would generally allow your third party app to let users use their\ninformation from another site such as "},{type:b,tag:j,props:{href:"https:\u002F\u002Fdevelopers.facebook.com\u002Fdocs\u002Ffacebook-login\u002Fv2.3",rel:[l,m,n],target:o},children:[{type:a,value:"Facebook"}]},{type:a,value:aB},{type:b,tag:j,props:{href:"https:\u002F\u002Fdeveloper.github.com\u002Fv3\u002Foauth_authorizations\u002F#create-a-new-authorization",rel:[l,m,n],target:o},children:[{type:a,value:"GitHub"}]},{type:a,value:aB},{type:b,tag:j,props:{href:"https:\u002F\u002Fdev.twitter.com\u002Foauth",rel:[l,m,n],target:o},children:[{type:a,value:"Twitter"}]},{type:a,value:",\netc."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"But what if you wanted to share information across your web applications in a\nsimilar way?"}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This post is a quick summary of how things works so you can get acquainted with\nthe basics."}]},{type:a,value:c},{type:b,tag:W,props:{id:fc},children:[{type:b,tag:j,props:{href:"#whitelist",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:fd}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Big sites aren't generally one big code repository but a set of separate\ncomponents. A way to make each component to share your account details is most\npossibly by making a difference between their own infrastructure and third\nparties."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"If your app were to use an external resource such as Google, the process would\nend up making Google users to be asked if they really want to share their\ninformation with you. This is why they would get a dialog similar to this."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"While its OK to ask confirmation from a user if he wants to share his details\nwith an external site, in the case of two components from the same site can\nshare this information transparently."}]},{type:a,value:c},{type:b,tag:T,props:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F02\u002Foauth_tutorial_authorization_sample.png",alt:"OAuth confirmation modal with Google logo. Asking: My project is requesting permission to: Manage your calendars, manage your documents.",figcaption:g},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Looking at this OAuth dialog, I can't help but feel a bit uneasy. Sure, it looks clean and official, but I'm noticing how many apps are asking for more access than they seem to need. What bugs me is we can't pick and choose - it's all or nothing. I've got this nagging feeling that companies might use this to grab as much data as they can about us, building detailed profiles along the way. With how quickly this is catching on, it's starting to feel like a ticking time bomb for our personal info. Maybe I'm overthinking it, but something about this just doesn't sit right with me."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"If you are your own Identity Provider, you can configure your relying parties as\n\"whitelisted\" so that your accounts system don't display such dialog."}]},{type:a,value:c},{type:b,tag:W,props:{id:fe},children:[{type:b,tag:j,props:{href:"#becoming-your-own-identity-provider",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:ff}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"In the case of "},{type:b,tag:an,props:{to:dk},children:[{type:a,value:fi}]},{type:a,value:" we wanted to become our own Identity\nprovider and found that we could deploy our own fork of "},{type:b,tag:r,props:{},children:[{type:a,value:"Firefox Accounts"}]},{type:a,value:"\n(\"FxA\") would allow us to do so."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The way its designed is that we have an OAuth protected \"profile\" endpoint that\nholds user details (email, full name, etc) as a \"source of truth\". Each relying\nparty (your own wiki, discussion forum, etc) gathers information from and ensure\nit has the same information locally."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"In order to do so, we have to make a module\u002Fplugin for each web application so\nwe it can query and bootstrap users locally based on the accounts system. We\ncall those \"relying parties\"."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Once we have relying party adapter in place, a web app will have the ability to\ncheck by itself with the\n"},{type:b,tag:r,props:{},children:[{type:a,value:"accounts server"}]},{type:a,value:g},{type:a,value:"\nto see if there's a session for\nthe current browsing session. If it has, it'll give either an already generated\nOAuth Bearer token, or generate one for the one for the service in question —\nthe \"SSO\" behavior."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"With the OAuth Bearer token in hand, a relying party (i.e. the\n"},{type:b,tag:dp,props:{},children:[{type:b,tag:E,props:{},children:[{type:a,value:fi}]},{type:a,value:" annotation service"}]},{type:a,value:") can go read details from the\n\"profile\" endpoint and then check locally if it already has a user available."}]},{type:a,value:c},{type:b,tag:T,props:{style:ax,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F04\u002F2014-12-16-notes-server-SSO.png",alt:"WebPlatform Notes A Specification annotation tool",figcaption:"The WebPlatform Notes specification annotation tool."},children:[{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"It was one of the last parts added to the "},{type:b,tag:E,props:{},children:[{type:a,value:bC}]},{type:a,value:" project and was\ndesigned to support adding annotations to specifications and to "},{type:b,tag:r,props:{},children:[{type:a,value:"leverage a\nSingle-Sign-On"}]},{type:a,value:" between other parts of the site."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Unfortunately the project never released the feature to the public before\nclosing."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"But "},{type:b,tag:j,props:{href:"https:\u002F\u002Fyoutu.be\u002FKKeh9C4SMnw",rel:[l,m,n],target:o},children:[{type:a,value:"I’ve made a YouTube video of its integration while I was building\nit"}]},{type:a,value:". The "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwebplatform.github.io\u002Fdocs\u002FWPD\u002FProjects\u002FSSO\u002F",rel:[l,m,n],target:o},children:[{type:a,value:"notes about it are available in the archived\nwiki"}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"If the relying party doesn't have a user, it'll create one."}]},{type:a,value:c},{type:b,tag:T,props:{style:ax,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F04\u002F2014-12-16-notes-server-SSO-13.33.38.png",alt:"Terminal session issuing HTTP call using cURL",figcaption:"With appropriate HTTP headers for current OAuth bearer token, requesting data to a profile server and giving current user’s data."},children:[{type:a,value:c}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Each relying party is responsible to sync its local user and session state based\non what the accounts service gives."}]},{type:a,value:c},{type:b,tag:W,props:{id:fg},children:[{type:b,tag:j,props:{href:"#seeing-in-action",ariaHidden:F,tabIndex:G},children:[{type:b,tag:d,props:{className:[H,I]},children:[]}]},{type:a,value:fh}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Here is a recording I made showing how it looked like;"}]},{type:a,value:c},{type:b,tag:"iframe",props:{width:fj,height:fj,src:"https:\u002F\u002Fwww.youtube.com\u002Fembed\u002FKKeh9C4SMnw",frameBorder:dH,allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:R},children:[]}]},dir:cm,path:"\u002Fblog\u002F2015\u002F04\u002Frun-oauth-identity-provider-service",extension:am,slug:"run-oauth-identity-provider-service",createdAt:"2024-10-24T19:43:51.724Z",updatedAt:aU,category:aV,prettyfiedTemporalDate:{prettified:"Monday, April 13, 2015",temporalDate:"2015-04-13"}}],taxonomyKey:ad,taxonomy:{key:ad,human:{key:ad,text:bC,description:"Work done as a full time W3C employee and other related work as volunteer\ncontributor helping on documenting the Open Web Platform.\n"}}}],fetch:[],mutations:void 0}}("text","element","\n","span","token","p"," ","code","punctuation","a","li","nofollow","noopener","noreferrer","_blank","variable","\\","em","parameter","keyword","function","div","nuxt-content-highlight","pre","line-numbers","operator","language-bash","string","comment","directive","strong","true",-1,"icon","icon-link","td",";","ul",false,"\n    ",".","{","}",true,2,"app-image","builtin","class-name","h2","app-link-compare-item","\"","ol","\n\n","instruction","number","\n  ",":","webplatform","root",")","property","=","projects",",","en-CA","publish",".md","nuxt-link",3,"2023-02-18T00:00:00.000Z","procedure","docker","\n     ","operations","th","h3","Fastly","float:unset;","wget","|","\n        ",", ","steps","Steps","-p","install","ENV","assign-left","MediaWiki","tr","Support MediaWiki special URL patterns","-v","cd","server","2024-10-24T19:43:51.726Z","class","IN","type","-e","find","2024-10-24T19:43:51.725Z","experiments","linux","blockquote","2024-10-24T19:43:51.728Z","screenshots","Screenshots","webplatform.github.io","$(","pwd","\n       ","mv","listen","server_name","export","w-1\u002F3","A","CNAME","443","      ","include"," is the same as ","-type"," f ","sed","-name","upstream","Discourse","migration","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F11\u002Fdiscourse_migration_list_gravatar_images.png","Side by side comparison while working on migrating Discourse\nwith WICG\n","blog","Requirements","Requirements we couldn’t meet","app-alert-box","webplatform.org","WebPlatform","https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fdocs-wpd","What was under \u002Fwiki\u002FWPD:...","webplatform\u002Fmediawiki-conversion","https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fmediawiki-conversion","Export MediaWiki wiki pages and history into a git repository","static.webplatform.org","overflow:hidden;clear:both;","thumbnails","gallery","https:\u002F\u002Fgithub.com\u002Fwebspecs\u002Fpublican","Publican"," or ","#steps"," and ","sudo","exit","-s","mkdir"," run ","-it","--rm","7002","apt-get","h4","boolean","language-nginx","RUN","\u002Fblog\u002F2015\u002F05","techniques","--mirror","-k","-i","--header","xargs","-n2","frontend","\n\n    ","\u002Fblog\u002F2015\u002F04","(","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmove-your-discourse-instance-to-a-different-server\u002F15721","Move your Discourse instance to a different server","IMPORTANT","cp","discourse","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fchange-the-domain-name-or-rename-my-discourse\u002F16098","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmultisite-configuration-with-docker\u002F14084\u002F32","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fmultisite-configuration-with-docker\u002F14084\u002F8","2024-10-24T19:43:51.729Z","security","\u002Fblog\u002F2015\u002F07\u002Fleaving-w3c\u002F","archiving","open-source","priorities","Priorities","outcome","Outcome","Migration","Blog","mediawiki","requirements","requirements-we-couldnt-meet","display:flex","https:\u002F\u002Fwww.w3.org\u002FPeople\u002Ffunctions\u002Fsysteam","https:\u002F\u002Fwebplatform.github.io\u002F","WebPlatform Docs Home Page","https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fdocs","What was under \u002Fwiki\u002F...","https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fdocs-meta","What was under \u002Fwiki\u002FMeta:...","webplatform\u002Fdocs-wpd","https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fblog","Archivator","\n(","MediaWiki XML dump","https:\u002F\u002Fwww.mediawiki.org\u002Fwiki\u002FHelp:Namespaces","\u002Fwiki\u002FWPD:*","https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fcontent-converter","Transform CMS content from a format into another","webplatform\u002Fcontent-converter","20150513130014","http:\u002F\u002Fwebplatform.github.io\u002Fdocs-assets\u002F","https:\u002F\u002Fstatic.webplatform.org\u002Ff\u002Ff1\u002Fhtmlstructure1.jpg","https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fdocs-assets\u002Fblob\u002Fgh-pages\u002Ff\u002Ff1\u002Fhtmlstructure1.jpg","https:\u002F\u002Fwebplatform.github.io\u002Fdocs-assets\u002Ff\u002Ff1\u002Fhtmlstructure1.jpg","https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fgenerator-docs\u002Fblob\u002Fmaster\u002Fconfig\u002Fnginx\u002Fmaps\u002Fmain.map","#screenshots","run-publican-inside-docker","gists","Gists","\u002Fblog\u002Ftag\u002Fwebplatform-docs"," vagrant ","ssh","\n ","su","del","\u002Fdata\"",":\u002Fsrv\u002Fwebapps\u002Fpublican\u002Fdata ","\u002Fspec-data\"",":\u002Fopt\u002Fbikeshed\u002Fbikeshed\u002Fspec-data ",":7002 webspecs\u002Fpublican:wip\n","outside","It should look like the screenshot with caption \"","\".","Starting a build process","\n           ","\"jdoe@example.org\"","80","location"," \u002F","$uri","#","$RUNDIR","0","flex","flex-row","flex-wrap","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-preview.png","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fpublican-deleted-spec-regeneration-question.png","Annotated screenshot, when changing a file a hook is called and regenerates the specification","cloud-computing","Docker","Varnish","It is possible the code shown here no longer works.\nMaybe the code shown here uses parts of Discourse that no longer exists.\n","proposed-setup","Proposed setup","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Ffull-site-cdn-acceleration-for-discourse\u002F21467\u002F1","@sam","http:\u002F\u002Fexample.org\u002F","discoursepolling.example.org","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F04\u002Fdiscuss-fastly-origins.png","Fastly service configuration, at Hosts tab","Configure -\u003E Hosts","language-dns-zone-file"," discoursepolling.example.org discourse.example.org"," ssl","1-browse-and-get-all-pages-you-think-could-be-lost-in-scraping","1. Browse and get all pages you think could be lost in scraping","2-lets-scrape-everything","2. Let's scrape everything","3-do-some-cleanup-on-the-fetched-files","3. Do some cleanup on the fetched files","\u002Ffoo.html","-K","-nc"," list.txt ","robots","off ","-E","\n     --user-agent","$UA","$ACCEPTT","\n     http:\u002F\u002Fwww.example.org\u002F\n","-exec","TLS","Enable a CDN for your Discourse","setup-detail","Setup detail","https:\u002F\u002Fdocs.fastly.com\u002Fguides\u002Fssl\u002Fwhich-ssl-options-are-available","\u002Fblog\u002F2015\u002F05\u002Fmake-discourse-long-polling-work-behind-fastly\u002F","Make Discourse \"long polling\" work behind\nFastly","SSL between ","keepalive","frontends",4," tld ","on","why-not-replacing-internal-python-version","Why not replacing internal Python version?","Procedure","incomplete-scratchpad","Incomplete scratchpad","setuptools","Setuptools","resources","Resources","-y","\n        libbluetooth-dev ","\n        libbz2-dev ","\n        libexpat1-dev ","\n        libssl-dev ","make","ln","http:\u002F\u002Fdavebehnke.com\u002Fpython-pyenv-ubuntu.html","https:\u002F\u002Fgithub.com\u002Fyyuu\u002Fpyenv","https:\u002F\u002Fwww.python.org\u002Fdownloads\u002Frelease\u002Fpython-279\u002F","http:\u002F\u002Faboutsimon.com\u002F2012\u002F04\u002F16\u002Fbuilding-a-python-deb-in-a-bootstrapped-ubuntu-chroot-with-fpm\u002F","http:\u002F\u002Fserverfault.com\u002Fquestions\u002F669859\u002Fhow-can-i-upgrade-python-to-2-7-9-on-ubuntu-14-4","http:\u002F\u002Faskubuntu.com\u002Fquestions\u002F101591\u002Fhow-do-i-install-python-2-7-2-on-ubuntu","https:\u002F\u002Fwiki.debian.org\u002FDebootstrap","whitelist","Whitelist","becoming-your-own-identity-provider","Becoming your own Identity provider","seeing-in-action","Seeing in action","WebPlatform.org",560)));