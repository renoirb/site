__NUXT_JSONP__("/blog/tag/cloud-computing", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,do0,dp,dq,dr,ds,dt,du,dv,dw,dx,dy,dz,dA,dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM,dN,dO,dP,dQ,dR,dS,dT,dU,dV,dW,dX,dY,dZ,d_,d$,ea,eb,ec,ed,ee,ef,eg,eh,ei,ej,ek,el,em,en,eo,ep,eq,er,es,et,eu,ev,ew,ex,ey,ez,eA,eB,eC,eD,eE,eF,eG,eH,eI,eJ,eK,eL,eM,eN,eO,eP,eQ,eR,eS,eT,eU,eV,eW,eX,eY,eZ,e_,e$,fa,fb,fc,fd,fe,ff,fg,fh,fi,fj,fk,fl,fm,fn,fo,fp,fq,fr,fs,ft,fu,fv,fw,fx,fy,fz,fA,fB,fC,fD,fE){return {data:[{},{},{contents:[{title:"Make Discourse “long polling” work behind Fastly or Varnish",locale:ar,created:"2015-05-03T00:00:00.000Z",updated:aN,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F05\u002Fmake-discourse-long-polling-work-behind-fastly\u002F",status:aj,revising:W,caption:C,caracteresBizzares:C,gallery:C,migrateCode:W,migrateImages:W,migrateLinks:W,categories:[ag],tags:[as,aO,cb,ac],keywords:[cc,cd,ax,"Long Polling behind Varnish",ce],excerpt:"In the Discourse forums, if you’ve seen something saying that you have to provide a different origin to make long polling work, maybe you didn’t understand what you have to do. Here are the details of why and how to do it correctly.",coverImage:{src:cf,text:cg},preamble:{text:ch},toc:[{id:ci,depth:S,text:cj}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"While working on deploying Discourse, "},{type:b,tag:j,props:{href:"https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Ffull-site-cdn-acceleration-for-discourse\u002F21467\u002F4",rel:[o,p,q],target:r},children:[{type:a,value:"I've came across a statement that took\ntime for me to understand"}]},{type:a,value:". Discourse has a subsystem that's similar to\nWebSocket and Server Sent events which takes care to automatically update the\npage asynchronously. Note that this post "},{type:b,tag:j,props:{href:"https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Ffull-site-cdn-acceleration-for-discourse\u002F21467",rel:[o,p,q],target:r},children:[{type:a,value:"is canonical version of my answer"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The confusing part was;"}]},{type:a,value:e},{type:b,tag:aP,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ck,rel:[o,p,q],target:r},children:[{type:a,value:cl}]},{type:a,value:" To server \"long polling\" requests from a different domain, set the\nSite Setting long polling base url to the origin server. For example, if your\nCDN is pulling from \""},{type:b,tag:h,props:{},children:[{type:a,value:"http:\u002F\u002Fexample.org"}]},{type:a,value:"\" be sure to plug in\n"},{type:b,tag:h,props:{},children:[{type:a,value:cm}]},{type:a,value:" into the site setting. If you don't your site will be\nbroken."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"This post is about clarifying why and how to work around this particular\nproblem."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The confusing part is that if \""},{type:b,tag:h,props:{},children:[{type:a,value:cm}]},{type:a,value:"\". If you are behind Fastly,\nyou have to use a CNAME entry and then you have to have a sub domain name and\nnot the top level."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:J,props:{},children:[{type:a,value:"Background:"}]},{type:a,value:" In DNS, a top level domain name (i.e. \"example.org\") can "},{type:b,tag:v,props:{},children:[{type:a,value:"only"}]},{type:a,value:"\nhave "},{type:b,tag:h,props:{},children:[{type:a,value:a$}]},{type:a,value:" records. Since Fastly requires we use a "},{type:b,tag:h,props:{},children:[{type:a,value:ba}]},{type:a,value:" entry, we have no\nchoice but to use a sub domain name."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Let's say that we will then use \""},{type:b,tag:h,props:{},children:[{type:a,value:"http:\u002F\u002Fdiscourse.example.org\u002F"}]},{type:a,value:"\" to serve our\nDiscourse forum so we can use Fastly."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Now there's this thing called \"long polling\" which is basically an "},{type:b,tag:h,props:{},children:[{type:a,value:"OPTION"}]},{type:a,value:" HTTP\nrequest with a long time before returning anything. If we use the Fastly or\nVarnish address, as Discourse would by default, Varnish will time out and \"long\npolling\" won't work."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:J,props:{},children:[{type:a,value:"More background:"}]},{type:a,value:" Varnish has this option to bypass in known contexts through\n"},{type:b,tag:h,props:{},children:[{type:a,value:"vcl_pipe"}]},{type:a,value:" which is roughly a raw TCP socket. But Fastly doesn't offer it\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fcommunity.fastly.com\u002Ft\u002Fvcl-pipe-heads-up\u002F163",rel:[o,p,q],target:r},children:[{type:a,value:"because of the "},{type:b,tag:v,props:{},children:[{type:a,value:"size"}]},{type:a,value:" of their setup"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:Y,props:{id:ci},children:[{type:b,tag:j,props:{href:"#proposed-setup",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:cj}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Let's enable long polling and expose our site under Fastly. We'll need two\nnames, one pointing to Fastly's and the other to the IP addresses we give within\nthe service dashboard."}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:J,props:{},children:[{type:a,value:"discourse.example.org"}]},{type:a,value:" that's our desired Discourse site domain name"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:J,props:{},children:[{type:a,value:cn}]},{type:a,value:" (pick any name) that we'll configure in\nDiscourse to access directly to our public facing frontend web server"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In my case, I generally have many web apps running that are only accessible from\nmy internal network. I refer to them as \"upstream\"; the same term NGINX uses in\ntheir config. Since this number of web apps you would host on a site can\nfluctuate, you might still want the number public IP address to remain stable.\nThat's why I setup a NGINX server in front that proxies to internal web app\nserver. I refer to them as \"frontends\"."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Let's say you have two public facing frontends running NGINX."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Those would be the ones you setup in Fastly like this."}]},{type:a,value:e},{type:b,tag:am,props:{style:at,src:co,figcaption:l},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:cp}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Here we see two "},{type:b,tag:v,props:{},children:[{type:a,value:"Backends"}]},{type:a,value:" in Fastly pannel at "},{type:b,tag:h,props:{},children:[{type:a,value:cq}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Notice that in this example i'm using "},{type:b,tag:h,props:{},children:[{type:a,value:bb}]},{type:a,value:" port because my backends are\nconfigured to communicate between Fastly and my frontends through TLS. But you\ndon't need to."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Quoting again @sam;"}]},{type:a,value:e},{type:b,tag:aP,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:ck,rel:[o,p,q],target:r},children:[{type:a,value:cl}]},{type:a,value:" To server \"long polling\" requests from a different domain, set the\nSite Setting long polling base url to the origin server."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Really means here is that we would have to put one of those IP addresses in\nDiscourse settings."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"What I'd recommend is to create a list of "},{type:b,tag:h,props:{},children:[{type:a,value:a$}]},{type:a,value:" entries for all your frontends."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In the end we need three things:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"What's the public name that Fastly will serve"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Which IPs are the frontends"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Which hostname we want to use for long polling and we'll add it to our\nVirtualHost"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The zone file would look like this;"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,cr]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"# The public facing URL\ndiscourse.example.org.  "},{type:b,tag:c,props:{className:[d,aQ,B]},children:[{type:a,value:aR}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,aS,B]},children:[{type:a,value:ba}]},{type:a,value:" global.prod.fastly.net.\n\n# The list of IP addresses you’d give to Fastly as origins\u002Fbackends\nfrontends.example.org.  "},{type:b,tag:c,props:{className:[d,aQ,B]},children:[{type:a,value:aR}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,aS,B]},children:[{type:a,value:a$}]},{type:a,value:" 8.8.8.113\nfrontends.example.org.  "},{type:b,tag:c,props:{className:[d,aQ,B]},children:[{type:a,value:aR}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,aS,B]},children:[{type:a,value:a$}]},{type:a,value:" 8.8.8.115\n\n# The long polling URL entry\ndiscoursepolling.example.org.  "},{type:b,tag:c,props:{className:[d,aQ,B]},children:[{type:a,value:aR}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,aS,B]},children:[{type:a,value:ba}]},{type:a,value:" frontends.example.org.\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"That way you can setup the \"long polling base url\" correctly without setting a\nsingle point of failure."}]},{type:a,value:e},{type:b,tag:am,props:{style:at,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fdiscourse-polling-ui.png",figcaption:"In Discourse admin, adjust long polling base url setting"},children:[{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Then, we can go in Discourse admin zone and adjust the \"long polling base url\"\nto our other domain name."}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,cs]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# \u002Fetc\u002Fnginx\u002Fsites-enabled\u002F10-discourse"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Let’s redirect to SSL, in case somebody tries to access the direct IP with"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# host header."}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bc}]}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bv}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"80"}]}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bw}]},{type:a,value:ct}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:be}]},{type:a,value:"     common_params"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"return"}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"301"}]},{type:a,value:" https:\u002F\u002F"},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"$server_name"}]},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:"$request_uri"}]}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bc}]}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bv}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bb}]},{type:a,value:cu}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bw}]},{type:a,value:ct}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Rest of NGINX server block"}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Also, I would make a condition if we are in discoursepolling but not"}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# under using anything specific to polling."}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# #TODO; find paths specific to polling"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"To see if it works; look at your web browser developer tool \"Network inspector\"\nfor "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fpoll"}]},{type:a,value:" calls on "},{type:b,tag:h,props:{},children:[{type:a,value:cn}]},{type:a,value:", and see if you have\n"},{type:b,tag:h,props:{},children:[{type:a,value:"200 OK"}]},{type:a,value:" status code."}]},{type:a,value:e},{type:b,tag:am,props:{style:at,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fdiscourse-polling.png",figcaption:"Use your web browser developer tools and inspect network traffic to see if requests made to discoursepolling worked"},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Note that this screenshot is showing "},{type:b,tag:h,props:{},children:[{type:a,value:cv}]},{type:a,value:" but that's beside the\npoint i'm trying to illustrate."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Hope this helped."}]}]},dir:cw,path:"\u002Fblog\u002F2015\u002F05\u002Fmake-discourse-long-polling-work-behind-fastly",extension:ak,slug:"make-discourse-long-polling-work-behind-fastly",createdAt:bx,updatedAt:bx,category:ag,prettyfiedTemporalDate:{prettified:"Sunday, May 3, 2015",temporalDate:"2015-05-03"}},{title:"Add OpenStack instance meta-data info in your salt grains",locale:ar,created:"2015-05-22T00:00:00.000Z",updated:"2023-11-17T00:00:00.000Z",canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F05\u002Fadd-openstack-instance-meta-data-info-salt-grains\u002F",status:aj,revising:C,migrateLinks:W,migrateImages:C,gallery:C,caption:C,categories:[bf],tags:[as,aO,ay,ac,"open-source"],keywords:["Ansible","Infrastructure as Code"],preamble:{text:"It is possible the code shown here no longer works.\nThis was written at the time before VMWare aquired SaltStack and maybe\ncode shown uses parts of Salt Stack that no longer exists.\n"},coverImage:{src:cx,alt:"A terminal window showing Open Stack nova client output",text:"Open Stack NOVA client is leveraging an internal HTTP API to display data we can\nconsume from the CLI.\nThe present article shows how to add data from OpenStack into Salt Stack.\n"},excerpt:"Ever wanted to target salt states based on data only the underlying OpenStack cluster knows. Here’s how I did it.",toc:[{id:cy,depth:S,text:cz},{id:cA,depth:S,text:cB},{id:cC,depth:S,text:cD},{id:aA,depth:S,text:cE}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"During a work session on my salt-states for WebPlatform.org I wanted to shape be\nable to query the OpenStack cluster meta-data so that I can adjust more\nefficiently my salt configuration."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"What are grains? Grains are structured data that describes what a minion has\nsuch as which version of GNU\u002FLinux its running, what are the network adapters,\netc."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The following is a Python script that adds data in Salt Stack' internal database\ncalled grains."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"I have to confess that I didn't write the script but adapted it to work within\nan OpenStack cluster. More precisely on DreamHost's DreamCompute cluster. The\noriginal script came from "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fsaltstack\u002Fsalt-contrib",rel:[o,p,q],target:r},children:[{type:a,value:"saltstack\u002Fsalt-contrib"}]},{type:a,value:" and the original file was\n"},{type:b,tag:j,props:{href:cF,rel:[o,p,q],target:r},children:[{type:a,value:"ec2_info.py"}]},{type:a,value:" to read data from EC2."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The "},{type:b,tag:j,props:{href:cF,rel:[o,p,q],target:r},children:[{type:a,value:"original script"}]},{type:a,value:" wasn't getting any data in the cluster. Most likely due\nto API changes and that EC2 API exposes dynamic meta-data that the\nDreamCompute\u002FOpenStack cluster don't."}]},{type:a,value:e},{type:b,tag:"rb-notice-box",props:{variant:"info",className:["my-5"]},children:[{type:a,value:e},{type:b,tag:J,props:{slot:"header"},children:[{type:a,value:"Script source"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The article’s source script is available on GitHub as a Python script we can\ninsert into SaltStack as a grain"}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fsalt-states\u002Fblob\u002Fmaster\u002F_grains\u002Fdreamcompute.py",rel:[o,p,q],target:r},children:[{type:a,value:"github.com\u002Fwebplatform\u002Fsalt-states"}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In the end, I edited the file to make it work on DreamCompute and also truncated\nsome data that the grains subsystem already has."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"My original objective was to get a list of "},{type:b,tag:h,props:{},children:[{type:a,value:cG}]},{type:a,value:" the VM was\nassigned. Unfortunately the API doesn't give that information yet. Hopefully\nI'll find a way to get that information some day."}]},{type:a,value:e},{type:b,tag:Y,props:{id:cy},children:[{type:b,tag:j,props:{href:"#get-openstack-instance-detail-using-salt",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:cz}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Locally"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"salt-call grains.get dreamcompute:uuid\n"}]}]}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,al]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"local"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n    10a4f390"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:cH},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:cI},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:cJ}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Or for another machine"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"salt app1 grains.get dreamcompute:uuid\n"}]}]}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,al]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:cK}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n    510f5f24"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"217b"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"4fd2"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"f00000000000\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"What size did we create a particular VM?"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"salt app1 grains.get dreamcompute:instance_type\n"}]}]}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,al]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:cK}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n    lightspeed\n"}]}]}]},{type:a,value:e},{type:b,tag:Y,props:{id:cA},children:[{type:b,tag:j,props:{href:"#what-data-you-can-get",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:cB}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Here is a sample of the grain data that will be added to every salt minion you\nmanage."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"You might notice that some data will be repeated such as the 'hostname', but the\nrest can be very useful if you want to use the data within your configuration\nmanag"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,al]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"dreamcompute"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:cL}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        iad"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bz}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"block_device_mapping"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"ami"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:cM},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"ebs0"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n            \u002Fdev\u002Fvdb\n        "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"ebs1"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:cM},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n            \u002Fdev\u002Fvda\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"hostname"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        salt.novalocal\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"instance_action"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        none\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"instance_id"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        i"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"00000000"}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"instance_type"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        lightspeed\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"launch_index"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:cN}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"local_ipv4"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        10.10.10.11\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:cO}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        salt\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"network_config"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"content_path"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n            \u002Fcontent\u002F0000\n        "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:cO}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n            network_config\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"placement"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:cL}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n            iad"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bz}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"public_ipv4"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        203.0.113.11\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"public_keys"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"someuser"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n            ssh"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"rsa "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:cP}]},{type:a,value:"an rsa public key"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:cP}]},{type:a,value:" someuser"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"comment@example.org\n    "},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"ramdisk_id"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:cQ},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"reservation_id"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        r"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"33333333"}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:cG}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:cQ},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"uuid"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\n        10a4f390"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:cH},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:cI},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:cJ}]}]}]},{type:a,value:e},{type:b,tag:Y,props:{id:cC},children:[{type:b,tag:j,props:{href:"#what-does-the-script-do",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:cD}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The script basically scrapes OpenStack meta-data service and serializes into\nsaltstack grains system the data it gets."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:cR,rel:[o,p,q],target:r},children:[{type:a,value:"OpenStack's meta-data service"}]},{type:a,value:" is similar to what you'd get from AWS, but\ndoesn't expose exactly the same data. This is why I had to adapt the original\nscript."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"To get data from an instance you simply (really!) need to make an HTTP call to\nan "},{type:b,tag:j,props:{href:cR,rel:[o,p,q],target:r},children:[{type:a,value:"internal IP address that OpenStack nova"}]},{type:a,value:" answers. (that’s what the IPv4\naddress starting by "},{type:b,tag:h,props:{},children:[{type:a,value:"169."}]},{type:a,value:" is)"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"For example, from an AWS\u002FOpenStack VM, you can know the instance hostname by\ndoing"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bA}]},{type:a,value:" http:\u002F\u002F169.254.169.254\u002Flatest\u002Fmeta-data\u002Fhostname\n\nsalt.novalocal\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"To know what the script calls, "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fsalt-states\u002Fcommit\u002F821ca803#diff-6eea2056af3e939361a559b84665c1d97fc9e062f7b7f79910567fc688881056R33",rel:[o,p,q],target:r},children:[{type:a,value:"you can add a line at "},{type:b,tag:h,props:{},children:[{type:a,value:"_call_aws(url)"}]},{type:a,value:"\nmethod"}]},{type:a,value:bg},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fsalt-states\u002Fcommit\u002F821ca803#diff-6eea2056af3e939361a559b84665c1d97fc9e062f7b7f79910567fc688881056R32-R34",rel:[o,p,q],target:r},children:[{type:a,value:"lines 32-34"}]},{type:a,value:"), like so;"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,"language-diff"]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"diff --git a\u002F_grains\u002Fdreamcompute.py b\u002F_grains\u002Fdreamcompute.py\nindex 682235d..c3af659 100644\n"},{type:b,tag:c,props:{className:[d,cS]},children:[{type:a,value:"--- a\u002F_grains\u002Fdreamcompute.py"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,cS]},children:[{type:a,value:"+++ b\u002F_grains\u002Fdreamcompute.py"}]},{type:a,value:"\n@@ -25,6 +25,7 @@ def _call_aws(url):\n\n"},{type:b,tag:c,props:{className:[d,aB]},children:[{type:b,tag:c,props:{className:[d,aT,aB]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,aU]},children:[{type:a,value:"    \"\"\"\n"}]},{type:b,tag:c,props:{className:[d,aT,aB]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,aU]},children:[{type:a,value:"    conn = httplib.HTTPConnection(\"169.254.169.254\", 80, timeout=1)\n"}]}]},{type:b,tag:c,props:{className:[d,"inserted-sign",cT]},children:[{type:b,tag:c,props:{className:[d,aT,cT]},children:[{type:a,value:"+"}]},{type:b,tag:c,props:{className:[d,aU]},children:[{type:a,value:"    LOG.info('API call to ' + url )\n"}]}]},{type:b,tag:c,props:{className:[d,aB]},children:[{type:b,tag:c,props:{className:[d,aT,aB]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,aU]},children:[{type:a,value:"    conn.request('GET', url)\n"}]},{type:b,tag:c,props:{className:[d,aT,aB]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,aU]},children:[{type:a,value:"    return conn.getresponse()\n"}]}]}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"When you "},{type:b,tag:h,props:{},children:[{type:a,value:"saltutil.sync_all"}]},{type:a,value:" (i.e. refresh grains and other data), the log will\ntell you which endpoints it queried."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In my case they were:"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,"language-shellsession"]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,"output"]},children:[{type:a,value:"[INFO    ] API call to \u002Fopenstack\u002F2012-08-10\u002Fmeta_data.json\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002F\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002F\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002Fami\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002Febs0\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002Febs1\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002Froot\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fhostname\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Finstance-action\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Finstance-id\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Finstance-type\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Flocal-ipv4\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fplacement\u002F\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fplacement\u002Favailability-zone\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fpublic-ipv4\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Framdisk-id\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Freservation-id\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fsecurity-groups\n[INFO    ] API call to \u002Fopenstack\u002F2012-08-10\u002Fmeta_data.json\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002F\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002F\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002Fami\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002Febs0\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002Febs1\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fblock-device-mapping\u002Froot\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fhostname\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Finstance-action\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Finstance-id\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Finstance-type\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Flocal-ipv4\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fplacement\u002F\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fplacement\u002Favailability-zone\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fpublic-ipv4\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Framdisk-id\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Freservation-id\n[INFO    ] API call to \u002Flatest\u002Fmeta-data\u002Fsecurity-groups\n"}]}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Its quite heavy."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Hopefully the script respects HTTP headers and don't bypass "},{type:b,tag:h,props:{},children:[{type:a,value:"304 Not Modified"}]},{type:a,value:"\nresponses. Otherwise it'll add load to nova. Maybe I should check that\n(note-to-self)."}]},{type:a,value:e},{type:b,tag:Y,props:{id:aA},children:[{type:b,tag:j,props:{href:"#install",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:cE}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"You can add this feature by adding a file in your salt states repository in the\n"},{type:b,tag:h,props:{},children:[{type:a,value:"_grains\u002F"}]},{type:a,value:" folder. The file can have any name ending by "},{type:b,tag:h,props:{},children:[{type:a,value:".py"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"You can grab the grain python code "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgist.github.com\u002FWebPlatformDocs\u002F6b26b67321fe15870aa0",rel:[o,p,q],target:r,title:"Gist where you can add openstack meta-data in your grains"},children:[{type:a,value:"in this gist"}]},{type:a,value:$}]},{type:a,value:e},{type:a,value:e},{type:a,value:e}]},dir:cw,path:"\u002Fblog\u002F2015\u002F05\u002Fadd-openstack-instance-meta-data-info-salt-grains",extension:ak,slug:"add-openstack-instance-meta-data-info-salt-grains",createdAt:bB,updatedAt:bx,category:bf,prettyfiedTemporalDate:{prettified:"Friday, May 22, 2015",temporalDate:"2015-05-22"}},{title:"Setting up Discourse with Fastly as a CDN provider and TLS",locale:ar,created:"2015-04-29T00:00:00.000Z",updated:aN,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F04\u002Fsetting-discourse-fastly-cdn-provider-ssl\u002F",status:aj,revising:W,caption:C,caracteresBizzares:C,gallery:C,migrateCode:W,migrateImages:W,migrateLinks:C,categories:[ag],tags:[aO,ac,cb,as,"caching","varnish"],keywords:[cc,cd,ax,"TLS","NGINX",ce],preamble:{text:ch},coverImage:{src:cf,text:cg},excerpt:"Here’s how I setup a Discourse web application so that I can scale it by adding more Docker instances while keeping a low number of exposed web servers",description:"Allow horizontal scaling by separating internal app servers from exposed frontend web servers",title_alternate:cU,toc:[{id:cV,depth:S,text:cW},{id:cX,depth:S,text:cY}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"The following is a copy of what I published in a question on\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Fenable-a-cdn-for-your-discourse\u002F14857\u002F26?u=renoirb",rel:[o,p,q],target:r},children:[{type:b,tag:v,props:{},children:[{type:a,value:"meta.discourse.org"}]},{type:a,value:" about \""},{type:b,tag:J,props:{},children:[{type:a,value:cU}]},{type:a,value:cZ}]},{type:a,value:" while\nworking on "},{type:b,tag:v,props:{},children:[{type:a,value:"discuss.webplatform.org"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:Y,props:{id:cV},children:[{type:b,tag:j,props:{href:"#setup-detail",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:cW}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Our setup uses "},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.fastly.com\u002F",rel:[o,p,q],target:r},children:[{type:a,value:ax}]},{type:a,value:", and leverage "},{type:b,tag:j,props:{href:c_,rel:[o,p,q],target:r},children:[{type:a,value:"their SSL feature"}]},{type:a,value:". Note that in\norder for you to use SSL too, you'll have to contact them to have it onto your\naccount."}]},{type:a,value:e},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:J,props:{},children:[{type:a,value:"SEE ALSO"}]},{type:a,value:" this "},{type:b,tag:aV,props:{to:c$},children:[{type:a,value:"post about "},{type:b,tag:v,props:{},children:[{type:a,value:da}]}]},{type:a,value:". This step is "},{type:b,tag:J,props:{},children:[{type:a,value:"required"}]},{type:a,value:" and is a logical next step to this\nprocedure."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In summary;"}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:db},{type:b,tag:v,props:{},children:[{type:a,value:"users"}]},{type:a,value:bh},{type:b,tag:v,props:{},children:[{type:a,value:ax}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:db},{type:b,tag:v,props:{},children:[{type:a,value:ax}]},{type:a,value:" and \""},{type:b,tag:v,props:{},children:[{type:a,value:bC}]},{type:a,value:"\" servers. (That's the IP we put into\nFastly hosts configuration, and are also refered to as \"origins\" or \"backends\"\nin CDN-speak)"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Docker Discourse instance (\""},{type:b,tag:v,props:{},children:[{type:a,value:bi}]},{type:a,value:"\") which listens only on private network\nand port (e.g. "},{type:b,tag:v,props:{},children:[{type:a,value:"10.10.10.3:8000"}]},{type:a,value:aq}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"More than two publicly exposed web servers (\""},{type:b,tag:v,props:{},children:[{type:a,value:bC}]},{type:a,value:"\"), with SSL, that we\nuse as \""},{type:b,tag:v,props:{},children:[{type:a,value:"backends"}]},{type:a,value:"\" in "},{type:b,tag:v,props:{},children:[{type:a,value:ax}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:bC}]},{type:a,value:" server running NGINX with an "},{type:b,tag:j,props:{href:"https:\u002F\u002Fnginx.org\u002Fen\u002Fdocs\u002Fhttp\u002Fngx_http_upstream_module.html",rel:[o,p,q],target:r},children:[{type:b,tag:v,props:{},children:[{type:a,value:bi}]},{type:a,value:" block"}]},{type:a,value:" proxying\ninternal "},{type:b,tag:v,props:{},children:[{type:a,value:bi}]},{type:a,value:" web servers that the Discourse Docker provides."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"We use NGINX's "},{type:b,tag:h,props:{},children:[{type:a,value:dc}]},{type:a,value:" HTTP header in the frontend to make sure we\nminimize connections"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Using this method, if we need to scale, we only need add more internal\n"},{type:b,tag:v,props:{},children:[{type:a,value:"Discourse Docker instances"}]},{type:a,value:", we can add more NGINX upstream entries."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Note that I recommend to use direct private IP addresses instead of internal\nnames. It removes complexity and the need to rewrite "},{type:b,tag:h,props:{},children:[{type:a,value:"Hosts:"}]},{type:a,value:" HTTP headers."}]},{type:a,value:e},{type:b,tag:Y,props:{id:cX},children:[{type:b,tag:j,props:{href:"#steps",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:cY}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Everything is the same as basic Fastly configuration, refer to "},{type:b,tag:j,props:{href:"https:\u002F\u002Fdocs.fastly.com\u002Fguides\u002Fgetting-started\u002Fsign-up-and-create-your-first-service",rel:[o,p,q],target:r},children:[{type:a,value:"setup your\ndomain"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Here are the differences;"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Setup your domain name with the CNAME Fastly will provide you ("},{type:b,tag:j,props:{href:c_,rel:[o,p,q],target:r},children:[{type:a,value:"you will have\nto contact them for your account though"}]},{type:a,value:"), ours is like that ;"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,cr]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"discuss.webplatform.org. "},{type:b,tag:c,props:{className:[d,aQ,B]},children:[{type:a,value:aR}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,aS,B]},children:[{type:a,value:ba}]},{type:a,value:" webplatform.map.fastly.net.\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In Fastly pannel at "},{type:b,tag:h,props:{},children:[{type:a,value:cq}]},{type:a,value:", we tell which publicly available\n"},{type:b,tag:v,props:{},children:[{type:a,value:dd}]},{type:a,value:" IPs"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Notice we use port "},{type:b,tag:h,props:{},children:[{type:a,value:bb}]},{type:a,value:aC},{type:b,tag:j,props:{href:"https:\u002F\u002Fdocs.fastly.com\u002Fguides\u002Fssl\u002Fcan-i-use-ssl-to-communicate-to-my-backend-servers",rel:[o,p,q],target:r},children:[{type:a,value:"so SSL is between "},{type:b,tag:v,props:{},children:[{type:a,value:ax}]},{type:a,value:" and our "},{type:b,tag:v,props:{},children:[{type:a,value:dd}]}]},{type:a,value:".\nAlso, you "},{type:b,tag:J,props:{},children:[{type:a,value:"can"}]},{type:a,value:" setup "},{type:b,tag:v,props:{},children:[{type:a,value:"Shielding"}]},{type:a,value:" (which is how you activate the CDN behavior\nwithin Fastly) by enabling it on only one. I typically set it on the one I call\n\"first\"."}]},{type:a,value:e},{type:b,tag:am,props:{style:at,src:co,figcaption:cp},children:[{type:a,value:e}]},{type:a,value:e},{type:b,tag:K,props:{start:_},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"In Fastly pannel "},{type:b,tag:h,props:{},children:[{type:a,value:"Configure -\u003E Settings -\u003E Request Settings"}]},{type:a,value:"; we make sure we\nforward "},{type:b,tag:h,props:{},children:[{type:a,value:"X-Forwarded-For"}]},{type:a,value:" header. You "},{type:b,tag:J,props:{},children:[{type:a,value:"DONT"}]},{type:a,value:" need this; you can remove it."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:am,props:{style:at,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F04\u002Fdiscuss-fastly-XFF.png",figcaption:"Fastly service configuration, at Settings tab"},children:[{type:a,value:e}]},{type:a,value:e},{type:b,tag:K,props:{start:bD},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Frontend NGINX server has a block similar to this."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In our case, we use "},{type:b,tag:j,props:{href:"https:\u002F\u002Fsaltstack.com\u002Fcommunity\u002F",rel:[o,p,q],target:r},children:[{type:a,value:bj}]},{type:a,value:" as the configuration management system, it\nbasically generates the Virtual Hosts for us as using "},{type:b,tag:j,props:{href:"https:\u002F\u002Fdocs.saltstack.com\u002Fen\u002Flatest\u002Ftopics\u002Freactor\u002F",rel:[o,p,q],target:r},children:[{type:a,value:"Salt reactor"}]},{type:a,value:" system.\nEvery time a Docker instance would become available, the configuration will be\nrewritten using this template."}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"{{ upstream_port }}"}]},{type:a,value:" would be at "},{type:b,tag:h,props:{},children:[{type:a,value:"8000"}]},{type:a,value:" in this example"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"{{ upstreams }}"}]},{type:a,value:" would be an array of current internal Docker instances, e.g.\n"},{type:b,tag:h,props:{},children:[{type:a,value:"['10.10.10.3','10.10.10.4']"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"{{ tld }}"}]},{type:a,value:" would be "},{type:b,tag:v,props:{},children:[{type:a,value:cv}]},{type:a,value:" in production, but can be anything else\nwe need in other deployment, it gives great flexibility."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Notice the use of "},{type:b,tag:h,props:{},children:[{type:a,value:"discoursepolling"}]},{type:a,value:" alongside the "},{type:b,tag:h,props:{},children:[{type:a,value:"discourse"}]},{type:a,value:" subdomain name.\nRefer to "},{type:b,tag:aV,props:{to:c$},children:[{type:a,value:"this post about "},{type:b,tag:v,props:{},children:[{type:a,value:da}]}]},{type:a,value:" to understand its purpose"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,cs]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bi}]},{type:a,value:" upstream_discourse"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:"%- for b in upstreams %"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bc}]}]},{type:a,value:"    "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:" b "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:n},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:" upstream_port "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:"%- endfor %"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:dc}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"16"}]}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:bE},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bc}]}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bv}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bb}]},{type:a,value:cu}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:bw}]},{type:a,value:" discoursepolling."}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:de},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"discourse."}]}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:de},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:ae}]},{type:a,value:"    \u002Fvar\u002Fwww\u002Fhtml"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:be}]},{type:a,value:" common_params"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:be}]},{type:a,value:" ssl_params"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"ssl"}]},{type:a,value:"                 "},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:df}]}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"ssl_certificate"}]},{type:a,value:"     \u002Fetc\u002Fssl\u002F2015\u002Fdiscuss.pem"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"ssl_certificate_key"}]},{type:a,value:" \u002Fetc\u002Fssl\u002F2015\u002F201503.key"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:bF},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Use internal Docker runner instance exposed port"}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"location"}]},{type:a,value:" \u002F"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"proxy_pass"}]},{type:a,value:"             http:\u002F\u002Fupstream_discourse"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:be}]},{type:a,value:"                proxy_params"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"proxy_intercept_errors"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:df}]}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:"\n\n        "},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Backend keepalive"}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# ref: http:\u002F\u002Fnginx.org\u002Fen\u002Fdocs\u002Fhttp\u002Fngx_http_upstream_module.html#keepalive"}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"proxy_http_version"}]},{type:a,value:" 1.1"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,L]},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"proxy_set_header"}]},{type:a,value:" Connection "},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:dg}]}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Note that I removed the "},{type:b,tag:h,props:{},children:[{type:a,value:"include proxy_params;"}]},{type:a,value:" line. If you have lines similar\nto "},{type:b,tag:h,props:{},children:[{type:a,value:"proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;"}]},{type:a,value:", you don't\nneed them (!)"}]}]},dir:"\u002Fblog\u002F2015\u002F04",path:"\u002Fblog\u002F2015\u002F04\u002Fsetting-discourse-fastly-cdn-provider-ssl",extension:ak,slug:"setting-discourse-fastly-cdn-provider-ssl",createdAt:bB,updatedAt:bB,category:ag,prettyfiedTemporalDate:{prettified:"Wednesday, April 29, 2015",temporalDate:"2015-04-29"}},{title:"A few useful GNU\u002FLinux truth tests while creating salt states",locale:ar,created:"2015-03-10T00:00:00.000Z",updated:aN,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F03\u002Fuseful-gnulinux-truth-tests\u002F",status:aj,revising:W,caption:C,caracteresBizzares:C,gallery:C,migrateCode:W,migrateImages:C,migrateLinks:C,categories:[bf],tags:[as,ay,ac,"procedures"],keywords:[dh,"usermod"],description:di,excerpt:di,toc:[{id:dj,depth:S,text:dk},{id:dl,depth:S,text:"Change ownership on a folder only if its not what we expect"}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"Nothing amazing here, just that in some situations I want to run commands in\nsalt stack only in some situations that should be enforced."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Those tests are written within Salt stack states and YAML, but the test are\nplain GNU\u002FLinux "},{type:b,tag:h,props:{},children:[{type:a,value:"tests"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:Y,props:{id:dj},children:[{type:b,tag:j,props:{ariaHidden:G,href:"#add-group-additional-membership-to-user",tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:dk}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[al,x]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:dm}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:bG}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:dn}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'grep \"^amavis\" \u002Fetc\u002Fgroup | grep -q -e clamav'"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"A similar alternate could also be"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[al,x]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:dm}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:bG}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:dn}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"e '^amavis."},{type:b,tag:c,props:{className:[d,az]},children:[{type:a,value:"*clamav$'"}]},{type:a,value:" \u002Fetc\u002Fgroup\n"}]}]}]},{type:a,value:e},{type:b,tag:Y,props:{id:dl},children:[{type:b,tag:j,props:{ariaHidden:G,href:"#change-ownership-on-a-folder-only-if-its-not-what-we-expect",tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:"Change ownership on a folder "},{type:b,tag:J,props:{},children:[{type:a,value:"only if"}]},{type:a,value:" its not what we expect"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[al,x]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:"% for es_folder in "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aD}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'\u002Fusr\u002Fshare\u002Felasticsearch\u002Fdata'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:au}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'\u002Fvar\u002Flib\u002Felasticsearch'"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aF}]},{type:a,value:" %"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:"\nchown "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"R app"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:do0},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"app"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"user "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:" es_folder "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:bG}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"onlyif"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"test `stat -c %G {{ es_folder }}` != app-user\""}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:"% endfor %"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:e}]}]}]}]},dir:dp,path:"\u002Fblog\u002F2015\u002F03\u002Fuseful-gnulinux-truth-tests",extension:ak,slug:"useful-gnulinux-truth-tests",createdAt:bm,updatedAt:bm,category:bf,prettyfiedTemporalDate:{prettified:"Tuesday, March 10, 2015",temporalDate:"2015-03-10"}},{title:"Creating a new Ubuntu Salt master from the terminal using Cloud-Init",locale:ar,created:"2015-03-09T00:00:00.000Z",updated:aN,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F03\u002Fcreating-new-ubuntu-salt-master-terminal-using-cloud-init\u002F",status:aj,revising:W,caption:C,caracteresBizzares:C,gallery:C,migrateCode:W,migrateImages:C,migrateLinks:C,categories:[ag],tags:[aO,as,ay,ac],keywords:[dh,"OpenStack","Cloud Init"],excerpt:"Cloud-Init is made in a way that it handles distribution specific package installation details automatically. With it, you can create a new salt master in a few commands.",coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F03\u002Fopenstack-cloudinit-screenshot.jpg",text:"[Open Stack Cloud-Init](https:\u002F\u002Fcloudinit.readthedocs.io\u002Fen\u002Flatest\u002F) documentation.\n"},description:"Creating new Salt master in a few commands with Cloud-Init",toc:[{id:dq,depth:S,text:dr}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"If you run on Virtual Machines on a provider that runs OpenStack you can also\nleverage a component that’s made to automatically install softwares at creation\ntime. With this, you can any new node in your cluster, including the salt-master\nin a few terminal commands."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Before starting out, you need to make sure your cloud provider runs Open Stack\nand has "},{type:b,tag:j,props:{href:bn,rel:[o,p,q],target:r,title:bo},children:[{type:a,value:aG}]},{type:a,value:" enabled. To check it out, look in the \"Launch instance\"\ndialog to create a new VM a tab titled \"Post-Creation\", it might just simply\nwork."}]},{type:a,value:e},{type:b,tag:am,props:{style:at,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F03\u002Fopenstack-cloudinit-launchinstance-dialog.png",alt:bp},children:[{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:bn,rel:[o,p,q],target:r,title:bo},children:[{type:a,value:aG}]},{type:a,value:" is basically reading a manifest that declares what’s the\nspecifics of the new VM and is part of the conversion from the initial image\nOpenStack into the specific instance you will be using. You can follow those\n"},{type:b,tag:j,props:{href:bq,rel:[o,p,q],target:r,title:ds},children:[{type:a,value:"two"}]},{type:a,value:l},{type:b,tag:j,props:{href:bq,rel:[o,p,q],target:r,title:bH},children:[{type:a,value:"articles"}]},{type:a,value:" that describes well how "},{type:b,tag:v,props:{},children:[{type:a,value:aG}]},{type:a,value:" works."}]},{type:a,value:e},{type:b,tag:aP,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:bn,rel:[o,p,q],target:r,title:bo},children:[{type:a,value:aG}]},{type:a,value:" is made in a way that it handles distribution specific\npackage installation details automatically."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The following is specific to an "},{type:b,tag:v,props:{},children:[{type:a,value:"Ubuntu server"}]},{type:a,value:" VM, but you might need to adjust\nthe package names to match your current server distribution as those tools are\ngetting more and more popular in the industry."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Before testing out on a new VM, you could also check from an existing instance\nand ask through an HTTP request what was the current instance’ post-creation\nscript using cURL."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Note that the IP address you see below is a virtual interface provided by\nOpenStack but can be navigated through HTTP, try it out like this;"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[N,x]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bA}]},{type:a,value:" http:\u002F\u002F169.254.169.254\u002Fopenstack\u002F\n\n  "},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"2012"}]},{type:a,value:"-08-10\n  "},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:dt}]},{type:a,value:"-04-04\n  "},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:dt}]},{type:a,value:"-10-17\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"If you see a similar output, you can ask what was the post-creation\nconfiguration (\"userdata\") it used at creation time. You can dig the tree,\nhere’s how you can find it in an OpenStack (CURRENT VERSION NICKNAME) cluster."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"For instance, my a salt master would have the following configuration;"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[N,x]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bA}]},{type:a,value:" http:\u002F\u002F169.254.169.254\u002Fopenstack\u002F2013-10-17\u002Fuser_data\n\n  "},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:du}]},{type:a,value:"\n  manage_etc_hosts: "},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:br}]},{type:a,value:"\n  manage-resolv-conf: "},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:br}]},{type:a,value:"\n  locale: en_US.UTF-8\n  timezone: America\u002FNew_York\n  package_upgrade: "},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:G}]},{type:a,value:"\n  package_update: "},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:G}]},{type:a,value:"\n  package_reboot_if_required: "},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:G}]},{type:a,value:"\n\n  ssh_import_id: "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aD}]},{type:a,value:"saltstack"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aF}]},{type:a,value:"\n  apt_sources:\n    - source: "},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"ppa:saltstack\u002Fsalt\""}]},{type:a,value:"\n\n  packages:\n    - salt-minion\n    - salt-common\n    - salt-master\n    - python-software-properties\n    - software-properties-common\n    - python-novaclient\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"To boot an instance from the terminal, you can use the \"nova\" command like this;"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[N,x]},children:[{type:b,tag:h,props:{},children:[{type:a,value:dv},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bI}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n     --user-data \u002Fsrv\u002Fcloudconfig.yml "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bK}]},{type:a,value:" keyname "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bL}]},{type:a,value:" subsonic "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:dw},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n     salt\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"This assumes that you have the following available in your OpenStack dashboard:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"An SSH public key called \"keyname\" in your tenant"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"A flavor called \"subsonic\" that has a predefined configuration of vCPU, vRAM,\netc."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"A security group called \"default\", you could use more than one by separating\nthem by comas; e.g. default,foo,bar"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"A text file in "},{type:b,tag:h,props:{},children:[{type:a,value:dx}]},{type:a,value:" in YAML format that holds your\n"},{type:b,tag:j,props:{href:bn,rel:[o,p,q],target:r,title:bo},children:[{type:a,value:aG}]},{type:a,value:" (a.k.a. \"userdata\") configuration."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"You have your nova configuration available (look in your cloud provider\ndashboard \"Download OpenStack RC File\" link in \"Access & Security\" and \"API\naccess\") and available in your server’s "},{type:b,tag:h,props:{},children:[{type:a,value:dy}]},{type:a,value:" profile folder."}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"You have \""},{type:b,tag:h,props:{},children:[{type:a,value:bM}]},{type:a,value:"\" (or its equivalent) installed"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"To test it out yourself, you could use the block I gave earlier and create a\nfile in "},{type:b,tag:h,props:{},children:[{type:a,value:dx}]},{type:a,value:" and give the the "},{type:b,tag:v,props:{},children:[{type:a,value:bs}]},{type:a,value:" command a try."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In this case, you might want to call the new VM \"salt\" as the default Salt stack\nconfiguration will try to communicate to it to make it its salt master. In this\ncase, it’ll be itself."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The creation of the salt master could also contain a few git repositories to be\ncloned at the salt master creation time making your salt master as easily\nreplaceable as any other components in your \"cloud\"."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"A set of sample scripts I use to create a new salt master off of a few\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgist.github.com\u002FWebPlatformDocs\u002F01c09df78f05612c281f",rel:[o,p,q],target:r},children:[{type:a,value:"git repositories can be found in the following Gist"}]}]},{type:a,value:e},{type:b,tag:Y,props:{id:dq},children:[{type:b,tag:j,props:{href:"#read-more",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:dr}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The following articles was found to be describing in more detail what I\nintroduced in this article."}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:bq,rel:[o,p,q],target:r,title:ds},children:[{type:a,value:"Easily automate The provisioning of your DigitalOcean Droplets"}]},{type:a,value:". Don’t be\nfooled by the name, the article is actually describing "},{type:b,tag:v,props:{},children:[{type:a,value:aG}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:bq,rel:[o,p,q],target:r,title:bH},children:[{type:a,value:bH}]}]},{type:a,value:e}]}]},dir:dp,path:"\u002Fblog\u002F2015\u002F03\u002Fcreating-new-ubuntu-salt-master-terminal-using-cloud-init",extension:ak,slug:"creating-new-ubuntu-salt-master-terminal-using-cloud-init",createdAt:bm,updatedAt:bm,category:ag,prettyfiedTemporalDate:{prettified:"Monday, March 9, 2015",temporalDate:"2015-03-09"}},{title:"Install PHP5 Memcached PECL extension and have it support igbinary",locale:ar,created:"2015-02-18T00:00:00.000Z",updated:aN,canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F02\u002Finstall-php5-memcached-pecl-extension-support-igbinary\u002F",status:aj,revising:C,migrateLinks:W,migrateImages:C,gallery:C,caption:C,categories:[ag],tags:[as,ac,bN],keywords:["Memcached","PECL","Ubuntu","dpkg","PHP5","php-fpm"],coverImage:{src:"~\u002Fassets\u002Fimages\u002Flogos\u002Fphp-igbinary.png",text:"[Igbinary][igbinary-github] is a drop in replacement for the standard *PHP serializer*.\nInstead of the time and space consuming textual representation used by PHP’s serialize, *igbinary* stores PHP data structures in a compact binary form.\n[igbinary-github]: https:\u002F\u002Fgithub.com\u002Figbinary\u002Figbinary\n"},excerpt:"Main part of my job is to make sure that its easy to reinstall a VM. Sometimes you need to build a package from source. How do you distribute it? Here’s one way",toc:[{id:dz,depth:S,text:dA},{id:dB,depth:S,text:dC},{id:dD,depth:S,text:dE},{id:dF,depth:S,text:dG}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"I was trying to figure out why my PHP setup would never have both "},{type:b,tag:h,props:{},children:[{type:a,value:dH}]},{type:a,value:" to\nbe used to serialize sessions in Memcached using current Memcached PECL\nextension."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After some research I found a procedure in an answer on StackOverflow."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"But it didn't solve my main requirement: "},{type:b,tag:J,props:{},children:[{type:a,value:"Since I do automated deployment, I\nMUST be able to move packages around"}]},{type:a,value:". Since all my VMs are using the same\ndistribution and that I already have my own "},{type:b,tag:v,props:{},children:[{type:a,value:dI}]},{type:a,value:" repo, I could just add "},{type:b,tag:v,props:{},children:[{type:a,value:"one\nmore"}]},{type:a,value:" deb file."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"My objective was then now to package it for deployment. To do this, I discovered\n"},{type:b,tag:j,props:{href:dJ,rel:[o,p,q],target:r},children:[{type:a,value:"Jordan Sissel's project called "},{type:b,tag:J,props:{},children:[{type:a,value:dK}]}]},{type:a,value:" which stands for \""},{type:b,tag:v,props:{},children:[{type:a,value:"Freaking Package\nManager"}]},{type:a,value:"\" (sic)"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"My target deployment runs on Ubuntu 14.04 LTS and I want it to replace upstream\n"},{type:b,tag:h,props:{},children:[{type:a,value:"php5-memcached"}]},{type:a,value:" package as a simple "},{type:b,tag:v,props:{},children:[{type:a,value:dL}]},{type:a,value:" file."}]},{type:a,value:e},{type:b,tag:Y,props:{id:dz},children:[{type:b,tag:j,props:{href:"#build-from-pecl-source",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:dA}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:dM}]},{type:a,value:" The following was run on an Ubuntu 14.04 VM with "},{type:b,tag:j,props:{href:dN,rel:[o,p,q],target:r},children:[{type:a,value:"@rynop's procedure"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Setting the machine up to make a package."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bt}]},{type:a,value:dO},{type:b,tag:c,props:{className:[d,aW,aX]},children:[{type:a,value:bO}]},{type:a,value:dO},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bP}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aA}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:aY}]},{type:a,value:" php5-dev pkg-config php-pear\n"}]}]}]},{type:a,value:e},{type:b,tag:K,props:{start:S},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Follow steps from the procedure. Those were taken from the "},{type:b,tag:v,props:{},children:[{type:b,tag:j,props:{href:dN,rel:[o,p,q],target:r},children:[{type:a,value:"Original procedure"}]}]},{type:a,value:", just before issuing "},{type:b,tag:h,props:{},children:[{type:a,value:".\u002Fconfigure"}]},{type:a,value:$}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,"assign-left",z]},children:[{type:a,value:"pecl_memcached_ver"}]},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"\"2.2.0\""}]},{type:a,value:"\npecl download memcached-"},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bQ}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"tar"}]},{type:a,value:" xzvf memcached-"},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bQ}]},{type:a,value:".tgz\n"},{type:b,tag:c,props:{className:[d,aW,aX]},children:[{type:a,value:bO}]},{type:a,value:" memcached-"},{type:b,tag:c,props:{className:[d,z]},children:[{type:a,value:bQ}]},{type:a,value:"\u002F\nphpize\n"}]}]}]},{type:a,value:e},{type:b,tag:K,props:{start:_},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"I realized that under Ubuntu 14.04 we also needed to "},{type:b,tag:v,props:{},children:[{type:a,value:"disable Memcached SASL"}]},{type:a,value:"\nso I had to do it differently"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:".\u002Fconfigure "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n    --enable-memcached-igbinary "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n    --disable-memcached-sasl\n"}]}]}]},{type:a,value:e},{type:b,tag:Y,props:{id:dB},children:[{type:b,tag:j,props:{href:"#make-a-deb-package",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:dC}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Install "},{type:b,tag:j,props:{href:dJ,rel:[o,p,q],target:r},children:[{type:a,value:"jordansissel\u002Ffpm"}]},{type:a,value:". Ideally this should be done on a machine or VM\nimage you're OK building things on and you can re-use."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bP}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aA}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:aY}]},{type:a,value:" ruby-dev gcc\n\n"},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Install fpm gem globally."}]},{type:a,value:"\ngem "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aA}]},{type:a,value:" fpm\n"}]}]}]},{type:a,value:e},{type:b,tag:K,props:{start:S},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Check the package contents you want to replace and let's replicate for our\nown purposes."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:dP},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"--list"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:dQ}]},{type:a,value:" php5-memcached\n"},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"find"}]},{type:a,value:" \u002Fvar\u002Fcache\u002Fapt "},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-type"}]},{type:a,value:" f "},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-name"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'*php5-memcached*'"}]},{type:a,value:"\ndpkg "},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-c"}]},{type:a,value:" \u002Fvar\u002Fcache\u002Fapt\u002Farchives\u002Fphp5-memcached_2.1.0-6build1_amd64.deb\n"}]}]}]},{type:a,value:e},{type:b,tag:K,props:{start:_},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"I figured out in the output that I only needed a few folders,\n"},{type:b,tag:h,props:{},children:[{type:a,value:"etc\u002Fphp5\u002Fmods-available\u002F"}]},{type:a,value:bh},{type:b,tag:h,props:{},children:[{type:a,value:"usr\u002Flib\u002Fphp5\u002Ffoo"}]},{type:a,value:", so I created them\nmanually."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bt}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bR}]},{type:a,value:" etc\u002Fphp5\u002Fmods-available\u002F\n\n"},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Adjust memcached.ini to suit your tastes, then prepare it for packaging"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bS}]},{type:a,value:" memcached.ini etc\u002Fphp5\u002Fmods-available\u002F\n\n"},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Make sure the usr\u002Flib\u002Fphp5\u002Ffoo path matches in"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# the result of `dpkg -c` you issued"}]},{type:a,value:bE},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bt}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bR}]},{type:a,value:" usr\u002Flib\u002Fphp5\u002F20121212\u002F\n"},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bS}]},{type:a,value:" modules\u002Fmemcached.so usr\u002Flib\u002Fphp5\u002F20121212\u002F\n"}]}]}]},{type:a,value:e},{type:b,tag:K,props:{start:bD},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Magic will happen"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"fpm "},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-s"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"dir"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-t"}]},{type:a,value:" deb "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-n"}]},{type:a,value:" php5-memcached "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-v"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"2.2"}]},{type:a,value:".0-wpd "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-m"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'\u003Cyour@email.org\u003E'"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"--description"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'PHP 5.5 PECL igbinary + memcached support'"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-d"}]},{type:a,value:" libmemcached10 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n    etc\u002F usr\u002F\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"I could have used "},{type:b,tag:h,props:{},children:[{type:a,value:"--replaces REPLACES"}]},{type:a,value:" in "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fjordansissel\u002Ffpm\u002Fwiki",rel:[o,p,q],target:r},children:[{type:b,tag:h,props:{},children:[{type:a,value:dK}]},{type:a,value:" options"}]},{type:a,value:", but when I did\nthis package, I didn't know which syntax to use. Its an optional argument\nanyway."}]},{type:a,value:e},{type:b,tag:K,props:{start:5},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Test if the package works"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:dP},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-i"}]},{type:a,value:" \u002Fsrv\u002Fwebplatform\u002Fapt\u002Fphp5-memcached_2.2.0-wpd_amd64.deb\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The output ..."}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,av]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"  (Reading database ... 118781 files and directories currently installed.)\n  Preparing to unpack ...\u002Fphp5-memcached_2.2.0-wpd_amd64.deb ...\n  Unpacking php5-memcached (2.2.0-wpd) over (2.1.0-6build1) ...\n  Setting up php5-memcached (2.2.0-wpd) ...\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Success!"}]},{type:a,value:e},{type:b,tag:K,props:{start:dR},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Look at the "},{type:b,tag:h,props:{},children:[{type:a,value:"phpinfo"}]},{type:a,value:" output"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:am,props:{style:at,src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F02\u002Fsessions_memcached_after.png",alt:bp},children:[{type:a,value:"\nAter: registered session handlers\n"}]},{type:a,value:e},{type:b,tag:Y,props:{id:dD},children:[{type:b,tag:j,props:{href:"#update-your-private-apt-repository-or-create-one",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:dE}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Then, in your own apt repository (if you do have one) here's how I rebuild\nthe index. If you only have a handful of packages, it can simply be a folder\nwith a bunch of deb files."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bt}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bR}]},{type:a,value:" \u002Fsrv\u002Fapt\n"},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bS}]},{type:a,value:" php5-memcached_2.2.0-wpd_amd64.deb \u002Fsrv\u002Fapt\n"},{type:b,tag:c,props:{className:[d,aW,aX]},children:[{type:a,value:bO}]},{type:a,value:"  \u002Fsrv\u002Fapt\n"},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bP}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aA}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:aY}]},{type:a,value:" dpkg-dev\ndpkg-scanpackages "},{type:b,tag:c,props:{className:[d,aW,aX]},children:[{type:a,value:$}]},{type:a,value:" \u002Fdev\u002Fnull "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"gzip"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:"-9c"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:" Packages.gz\n"},{type:b,tag:c,props:{className:[d,aW,aX]},children:[{type:a,value:"echo"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'deb file:\u002Fsrv\u002Fapt .\u002F'"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:" \u002Fetc\u002Fapt\u002Fsources.list.d\u002Ffoo.list\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"If you want something more scalable than a directory with a bunch of "},{type:b,tag:h,props:{},children:[{type:a,value:dL}]},{type:a,value:" and\na "},{type:b,tag:h,props:{},children:[{type:a,value:"Package.gz"}]},{type:a,value:" that you rsync around, there are other procedures available\nonline."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Done!"}]},{type:a,value:e},{type:b,tag:Y,props:{id:dF},children:[{type:b,tag:j,props:{href:"#screenshots",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:dG}]},{type:a,value:e},{type:b,tag:u,props:{style:"overflow:hidden;clear:both;",className:["thumbnails","gallery","flex","flex-row","flex-wrap"]},children:[{type:a,value:e},{type:b,tag:am,props:{className:[dS],src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F02\u002Fsessions_memcached_before2.png",alt:bp},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Session handlers shows memcached"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:am,props:{className:[dS],src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F02\u002Fsessions_memcached_before.png",alt:bp},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:dH}]},{type:a,value:" support no?"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},dir:"\u002Fblog\u002F2015\u002F02",path:"\u002Fblog\u002F2015\u002F02\u002Finstall-php5-memcached-pecl-extension-support-igbinary",extension:ak,slug:"install-php5-memcached-pecl-extension-support-igbinary",createdAt:bT,updatedAt:bT,category:ag,prettyfiedTemporalDate:{prettified:"Wednesday, February 18, 2015",temporalDate:"2015-02-18"}},{title:dT,locale:ar,created:dU,updated:"2015-02-03T00:00:00.000Z",canonical:dV,status:aj,revising:C,migrateLinks:W,migrateImages:C,gallery:C,caption:C,categories:[ag],tags:[as,dW,ay,ac],keywords:["replication","database-server","cluster","configuration","mysql","MariaDB"],description:dT,excerpt:"Some notes on how I created our updated MariaDB database cluster with replication.",preamble:{text:"The following might still work if all software versions are still available in the exact versions ranges they were when initially published.\nPart of this article was written while maintaining WebPlatform’s Infrastructure maintenance. Mostly [in *WPD\u002FInfrastructure\u002Fprocedures\u002F* **Replacing a VM**](https:\u002F\u002Fwebplatform.github.io\u002Fdocs\u002FWPD\u002FInfrastructure\u002Fprocedures\u002FReplacing_a_VM\u002F), and [*WPD\u002FInfrastructure\u002Fprocedures\u002F* **Managing  MariaDB replication**](https:\u002F\u002Fwebplatform.github.io\u002Fdocs\u002FWPD\u002FInfrastructure\u002Fprocedures\u002FManaging_MySQL_replication\u002F)\n"},toc:[{id:dX,depth:S,text:dY},{id:bN,depth:S,text:dZ},{id:d_,depth:_,text:d$},{id:ea,depth:_,text:eb},{id:ec,depth:_,text:ed},{id:ee,depth:_,text:ef},{id:eg,depth:_,text:eh},{id:ei,depth:_,text:ej}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"While reworking WebPlatform infrastructure I had to rebuild a new database\ncluster."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The objective of the cluster is to have more than one database server so that\nour web applications can make reads on any node in the cluster."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"While the system has replication, and I can send reads on any nodes on the\ncluster. There is a flaw in it too, any nodes can "},{type:b,tag:v,props:{},children:[{type:a,value:"also"}]},{type:a,value:" make writes; nothing is\nblocking it."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"My plan is to change this so that it would be OK to send writes to anybody in\nthe cluster. There is now something called \"Galera\" that would allow me that.\nBut that's outside of the scope of this article."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In the current configuration, I'm purposefully not fixing it because my\nconfiguration management makes sure only the current master. So in this setup, I\ndecided that the VM that gets writes has a specific mention of \"masterdb\" in the\nhostname."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"That way, its easy to see and it gives me the ability to change master at\nanytime if an emergency requires me to."}]},{type:a,value:e},{type:b,tag:Y,props:{id:dX},children:[{type:b,tag:j,props:{href:"#changing-mariadb-replication-master",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:dY}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Changing master could be done in the following order:"}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Lock writes on masterdb databases"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Wait replication to catch up"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"On secondary database servers; remove replication configuration"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Tell all web apps to use new database master"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Remove database lock"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Setup new replication configuration to use new master"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Thanks to the fact that I manage "},{type:b,tag:J,props:{},children:[{type:a,value:"everything"}]},{type:a,value:" through configruation management\n--including the web app configuration files-- its only a matter of applying the\nstates everywhere in the cluster. That makes it fairly easy to do such an heavy\nmove, even under stress."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"This post will be updated once I have completed the multi writes setup."}]},{type:a,value:e},{type:b,tag:Y,props:{id:bN},children:[{type:b,tag:j,props:{href:"#procedure",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:dZ}]},{type:a,value:e},{type:b,tag:ad,props:{id:d_},children:[{type:b,tag:j,props:{href:"#assumptions",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:d$}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The rest of this article will assume the following:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"You are running VMs on OpenStack, and do have credentials to make API calls\nto it"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"You have a Salt master already running"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Your salt master has at least "},{type:b,tag:h,props:{},children:[{type:a,value:bM}]},{type:a,value:bg},{type:b,tag:h,props:{},children:[{type:a,value:bs}]},{type:a,value:" commands) available\non it"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"You have your Open Stack credentials already loaded in your salt master's\n"},{type:b,tag:h,props:{},children:[{type:a,value:dy}]},{type:a,value:" so you can use "},{type:b,tag:h,props:{},children:[{type:a,value:bs}]},{type:a,value:" directly"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ad,props:{id:ea},children:[{type:b,tag:j,props:{href:"#from-the-salt-master-initiate-a-few-vms-to-use-for-your-database-cluster",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:eb}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Before booting, ensure you have the following details in your OpenStack\ncluster and salt master;"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"You have a SSH key in your OpenStack cluster. Mine is called\n\"renoirb-production\" and my salt master user has the private key preinstalled"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"You have a "},{type:b,tag:h,props:{},children:[{type:a,value:ek}]},{type:a,value:" file that has settings that points to your salt\nmaster"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"cat"}]},{type:a,value:" \u002Fsrv\u002Fopsconfigs\u002Fuserdata.txt\n"}]}]}]},{type:a,value:e},{type:a,value:e},{type:b,tag:el,props:{title:em},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"I've noticed that this "},{type:b,tag:h,props:{},children:[{type:a,value:ek}]},{type:a,value:" file I've initially written for this\narticle has then been part of "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fops\u002Fblob\u002Ff6e0390a\u002Fsalt-master",rel:[o,p,q],target:r,title:"salt-master\u002F* on GitHub.com\u002Fwebplatform\u002Fops as of 2015-06-08"},children:[{type:a,value:"WebPlatform’s \"ops\" repository"}]},{type:a,value:"\nfrom which I was (2015) using to work locally. In this repo, there was the\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fops\u002Fblob\u002Ff6e0390a\u002Fsalt-master\u002Fsalt-userdata.yml",rel:[o,p,q],target:r,title:"salt-master\u002Fsalt-userdata.yml on GitHub.com\u002Fwebplatform\u002Fops as of 2015-06-08"},children:[{type:b,tag:h,props:{},children:[{type:a,value:"salt-master\u002Fsalt-userdata.yml"}]}]},{type:a,value:$}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,al]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:du}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"manage_etc_hosts"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,ah,az]},children:[{type:a,value:br}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Has to be set to false for everybody. Otherwise we need a DNS"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"manage-resolv-conf"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,ah,az]},children:[{type:a,value:br}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"locale"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:" en_US.UTF"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"8"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"timezone"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:" America\u002FNew_York\n"},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"package_upgrade"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,ah,az]},children:[{type:a,value:G}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"package_update"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,ah,az]},children:[{type:a,value:G}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"package_reboot_if_required"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,ah,az]},children:[{type:a,value:G}]},{type:a,value:bE},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"#"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# This is run at EVERY boot, good to ensure things are at the right place"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# IMPORTANT, make sure that `10.10.10.22` is a valid local DNS server."}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"bootcmd"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"e 'nameserver' \u002Fetc\u002Fresolvconf\u002Fresolv.conf.d\u002Fhead "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:X}]},{type:a,value:" printf\n    \"nameserver 10.10.10.22\\n\" "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:E}]},{type:a,value:" \u002Fetc\u002Fresolvconf\u002Fresolv.conf.d\u002Fhead\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"e 'wpdn' \u002Fetc\u002Fresolvconf\u002Fresolv.conf.d\u002Fbase "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:X}]},{type:a,value:" printf \"search\n    production.wpdn\\ndomain production.wpdn\\nnameserver 8.8.8.8\" "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:E}]},{type:a,value:"\n    \u002Fetc\u002Fresolvconf\u002Fresolv.conf.d\u002Fbase\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"e 'wpdn' \u002Fetc\u002Fresolv.conf "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:X}]},{type:a,value:" resolvconf "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"u\n\n"},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"runcmd"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:" sed "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"i \"s\u002F127.0.0.1 localhost\u002F127.0.1.1 $(hostname).production.wpdn\n    $(hostname)\\n127.0.0.1 localhost\u002F\" \u002Fetc\u002Fhosts\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bu},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"get install software"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"properties"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"common python"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:en},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"properties\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:" add"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:dI},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"repository "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"y ppa"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"saltstack\u002Fsalt\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bu},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"get update\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bu},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:eo},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"y upgrade\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:bu},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:eo},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"y autoremove\n\n"},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"packages"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"minion\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"common\n"},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# vim: et ts=2 sw=2 ft=yaml syntax=yaml"}]},{type:a,value:e}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:K,props:{start:S},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Create two "},{type:b,tag:h,props:{},children:[{type:a,value:"db"}]},{type:a,value:"-type VMs"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:dv},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bI}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n     --user-data \u002Fsrv\u002Fopsconfigs\u002Fuserdata.txt "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bK}]},{type:a,value:ep},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bL}]},{type:a,value:" lightspeed "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:dw},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n     db1-masterdb\n\n nova boot "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bI}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n      --user-data \u002Fsrv\u002Fopsconfigs\u002Fuserdata.txt "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bK}]},{type:a,value:ep},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bL}]},{type:a,value:" supersonic "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n      --security-groups default "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"\n      db2\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Accept them to the salt"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"salt-key "},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:aY}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:eq}]},{type:a,value:" db1-masterdb\nsalt-key "},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:aY}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:eq}]},{type:a,value:" db2\n"}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"As an aside. Imagine you want to run dependencies automatically once a VM is\npart of your salt-master. For example, adding its private IP address in a local\n"},{type:b,tag:v,props:{},children:[{type:a,value:"Redis"}]},{type:a,value:" or "},{type:b,tag:v,props:{},children:[{type:a,value:"Etcd"}]},{type:a,value:" live configuration object. One could create a "},{type:b,tag:j,props:{href:"https:\u002F\u002Fdocs.saltproject.io\u002Fen\u002Flatest\u002Ftopics\u002Freactor\u002F",rel:[o,p,q],target:r},children:[{type:a,value:"Salt\n\""},{type:b,tag:v,props:{},children:[{type:a,value:"Reactor"}]},{type:a,value:cZ}]},{type:a,value:" and make "},{type:b,tag:j,props:{href:bU,rel:[o,p,q],target:r},children:[{type:a,value:"sure the data is refreshed. This gist is a good\nstarting point"}]},{type:a,value:" 4. Wait the VM build to finish and get their private IP\naddresses"}]},{type:a,value:e},{type:b,tag:K,props:{start:bD},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Wait the VM build to finish and get their private IP addresses"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"nova list "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:dQ}]},{type:a,value:" db\n\n  "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:er}]},{type:a,value:es},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:" db1-masterdb "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:et},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:eu},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:ev},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bV}]},{type:a,value:".10.73 "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:er}]},{type:a,value:es},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:" db2          "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:et},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:eu},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:ev},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bV}]},{type:a,value:".10.74 "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:X}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:am,props:{style:at,src:cx,alt:"OpenStack nova command",figcaption:l},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Command output when issuing "},{type:b,tag:h,props:{},children:[{type:a,value:"nova list"}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Add them to the pillars. Note that the part of the name \"masterdb\" is what\nSalt states uses to know which one will get the writes to. Note that in the\nend, the web apps configs will use the private IP address. Its quicker to\ngenerate pages if the backend doesn't need to make name resolution each time\nit makes database queries. This is why we have to reflect the pillars. Ensure\nthe following structure exists in the file."}]},{type:a,value:e},{type:b,tag:el,props:{title:em},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The following file is now "},{type:b,tag:J,props:{},children:[{type:a,value:"GitHub.com\u002FWebPlatform\u002Fsalt-pillar"}]},{type:a,value:" project,\n"},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fsalt-pillar\u002Ftree\u002F3d718578\u002Finfra",rel:[o,p,q],target:r,title:"infra\u002F* on GitHub.com\u002Fwebplatform\u002Fsalt-pillar as of 2015-06-08"},children:[{type:a,value:"and looked like this"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,al]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"# Edit \u002Fsrv\u002Fpillar\u002Finfra\u002Finit.sls at the following blocks"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"infra"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:ew}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:bW}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:" 10.10.10.73\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Refer to the right IP address in the configuration file with a similar salt\n"},{type:b,tag:h,props:{},children:[{type:a,value:"pillar.get"}]},{type:a,value:" reference ("},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fsalt-states\u002Fblob\u002F20150608\u002Fcode\u002Ffiles\u002Fblog\u002Flocal.php.jinja",rel:[o,p,q],target:r,title:"code\u002Ffiles\u002Fblog\u002Flocal.php.jinja on GitHub.com\u002Fwebplatform\u002Fsalt-states as of 2015-06-08"},children:[{type:a,value:"config template"}]},{type:a,value:aC},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fwebplatform\u002Fsalt-states\u002Fblob\u002F20150608\u002Fcode\u002Fblog.sls#L48-L55",rel:[o,p,q],target:r,title:"code\u002Fblog.sls on GitHub.com\u002Fwebplatform\u002Fsalt-states as of 2015-06-08"},children:[{type:a,value:"state to write\nconfig template to filesystem"}]},{type:a,value:")."}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,al]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"\u002Fsrv\u002Fwebplatform\u002Fblog\u002Fwp-config.php"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"file.managed"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"source"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"\u002F\u002Fcode\u002Ffiles\u002Fblog\u002Fwp"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"config.php.jinja\n    "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"template"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:" jinja\n    "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:do0}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ex},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:ey},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"group"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ex},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:ey},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"context"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"db_creds"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:ez}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aF}]},{type:a,value:"('accounts"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"wiki"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"db') "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"masterdb_ip"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:T}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:ez}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aF}]},{type:a,value:"('infra"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ew},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:"masterdb') "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:V}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"require"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"cmd"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:" rsync"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"blog\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"... and the "},{type:b,tag:h,props:{},children:[{type:a,value:"wp-config.php.jinja"}]}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,eA]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,"php",eA]},children:[{type:b,tag:c,props:{className:[d,"delimiter",az]},children:[{type:a,value:"\u003C?php"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"## Managed by Salt Stack, please DO NOT TOUCH, or ALL CHANGES WILL be LOST!"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"## source {{ source }}"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,H,aK]},children:[{type:a,value:"'DB_CHARSET'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:au}]},{type:a,value:eB},{type:b,tag:c,props:{className:[d,H,aL]},children:[{type:a,value:"\"utf8\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,H,aK]},children:[{type:a,value:"'DB_COLLATE'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:au}]},{type:a,value:eB},{type:b,tag:c,props:{className:[d,H,aL]},children:[{type:a,value:dg}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,H,aK]},children:[{type:a,value:"'DB_HOST'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:au}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,H,aL]},children:[{type:a,value:"\"{{ masterdb_ip|default('127.0.0.1')    }}\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,H,aK]},children:[{type:a,value:"'DB_NAME'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:au}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,H,aL]},children:[{type:a,value:"\"{{ db_creds.database|default('wpblog') }}\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,H,aK]},children:[{type:a,value:"'DB_USER'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:au}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,H,aL]},children:[{type:a,value:"\"{{ db_creds.username|default('root')   }}\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aI}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,H,aK]},children:[{type:a,value:"'DB_PASSWORD'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:au}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H,aL]},children:[{type:a,value:"\"{{ db_creds.password|default('')       }}\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:e}]}]}]}]},{type:a,value:e},{type:b,tag:K,props:{start:7},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Refresh the pillars, rebuild the salt master "},{type:b,tag:h,props:{},children:[{type:a,value:eC}]},{type:a,value:", and test it\nout."}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"salt-call saltutil.sync_all\nsalt salt state.highstate\n\nsalt-call pillar.get infra:hosts_entries:masterdb\n"},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:" local:\n"},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:"   "},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bV}]},{type:a,value:".10.73\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Make sure the VMs has the same version of salt as you do"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:" salt-call test.version\n "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:" local:\n "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bX}]},{type:a,value:".0\n\n salt db"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"* test.version\n "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:" db2:\n "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bX}]},{type:a,value:".0\n "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:" db1-masterdb:\n "},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bX}]},{type:a,value:".0\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Kick the VMs installation"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"salt db"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:I}]},{type:a,value:"* state.highstate\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Highstate takes a while to run, but once you are done, you should be able to\nwork with them with the remaining of this tutorial"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:bY},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bZ}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:eD}]},{type:a,value:" mysql.version\n"},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eE},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:eF}]},{type:a,value:eG},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eH},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:eF}]},{type:a,value:eG}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Each db-type VM MySQL\u002FMariaDB\u002FPercona server will have a "},{type:b,tag:v,props:{},children:[{type:a,value:"different"}]},{type:a,value:" database\nmaintenance users defined in "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fetc\u002Fmysql\u002Fdebian.cnf"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Make sure you don't overwrite them unless you import everything all at once,\nincluding the users and their grants. 11. Check that each db VMs has their SSL\ncertificate generated by Salt"}]},{type:a,value:e},{type:b,tag:K,props:{start:11},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Check that each db VMs has their SSL certificate generated by Salt"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:bY},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bZ}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:eD}]},{type:a,value:" cmd.run "},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'ls \u002Fetc\u002Fmysql | grep pem'"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eE},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eI},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eJ},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eK},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eL},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eM},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eN},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eO},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eP},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eH},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eI},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eJ},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eK},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eL},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eM},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eN},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eO},{type:b,tag:c,props:{className:[d,y]},children:[{type:a,value:E}]},{type:a,value:eP}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Each file is a certificate so they can use to make replication through SSL."}]},{type:a,value:e},{type:b,tag:ad,props:{id:ec},children:[{type:b,tag:j,props:{href:"#now-on-each-database-server",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:ed}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Connect to both db nodes using the salt as a Jump Host"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:eQ}]},{type:a,value:" masterdb.production.wpdn\n"},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:eQ}]},{type:a,value:" db2.production.wpdn\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Get to the MySQL\u002FMariaDB\u002FPercona prompt on each VMs."}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"If you are used with terminal screens that allows to keep sessions running even\nif you get disconnected, that would be ideal. We never know if the connection\nhangs."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"On WebPlatform system we do have "},{type:b,tag:h,props:{},children:[{type:a,value:"screen"}]},{type:a,value:" but "},{type:b,tag:h,props:{},children:[{type:a,value:"tmux"}]},{type:a,value:" can do too."}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,av]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"mysql\n"}]}]}]},{type:a,value:e},{type:b,tag:K,props:{start:_},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Check if SSL is enabled on both MySQL\u002FMariaDB\u002FPercona servers"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,av]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"\u003E MariaDB [(none)]\u003E SHOW VARIABLES like '%ssl%';\n\u003E +---------------+----------------------------+\n\u003E | Variable_name | Value                      |\n\u003E +---------------+----------------------------+\n\u003E | have_openssl  | YES                        |\n\u003E | have_ssl      | YES                        |\n\u003E | ssl_ca        | \u002Fetc\u002Fmysql\u002Fca-cert.pem     |\n\u003E | ssl_capath    |                            |\n\u003E | ssl_cert      | \u002Fetc\u002Fmysql\u002Fserver-cert.pem |\n\u003E | ssl_cipher    | DHE-RSA-AES256-SHA         |\n\u003E | ssl_crl       |                            |\n\u003E | ssl_crlpath   |                            |\n\u003E | ssl_key       | \u002Fetc\u002Fmysql\u002Fserver-key.pem  |\n\u003E +---------------+----------------------------+\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Generate SSL certificates for MySQL\u002FMariaDB\u002FPercona server, see "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgist.github.com\u002FWebPlatformDocs\u002Fdee3c76a88b3c44da564",rel:[o,p,q],target:r},children:[{type:a,value:"this\ngist"}]},{type:a,value:" on how to do it."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Places to double check; To see which config keys sets what's shown in the\nprevious screen, take a look in the VMs "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fetc\u002Fmysql\u002Fconf.d\u002F"}]},{type:a,value:" folders with\nsimilar entries."}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:b_}]},{type:a,value:" is what allows us to communicate between servers, before MySQL\n5.5 we had "},{type:b,tag:h,props:{},children:[{type:a,value:"skip-networking"}]},{type:a,value:" but now only a "},{type:b,tag:h,props:{},children:[{type:a,value:b_}]},{type:a,value:" is sufficient. Make\nsure that your security groups allows only local network connections though."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:eR}]},{type:a,value:" MUST be with a different number for each nodes. Make sure no\nserver has the same number."}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,"language-ini"]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,eS]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,eT,eU]},children:[{type:a,value:"mysqld"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aF}]}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:b_}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"0.0.0.0"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:"log-basename"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"mariadbrepl"}]},{type:a,value:"\nlog-bin\n"},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:"binlog-format"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"row"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:eR}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:bz}]},{type:a,value:eV},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:"ssl-cipher"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"DHE-RSA-AES256-SHA"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:"ssl-ca"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"\u002Fetc\u002Fmysql\u002Fca-cert.pem"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:eW}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"\u002Fetc\u002Fmysql\u002Fserver-cert.pem"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:eX}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"\u002Fetc\u002Fmysql\u002Fserver-key.pem"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,eS]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,eT,eU]},children:[{type:a,value:"client"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aF}]}]},{type:a,value:eV},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:eW}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"\u002Fetc\u002Fmysql\u002Fclient-cert.pem"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,m,an]},children:[{type:a,value:eX}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,ao,ap]},children:[{type:a,value:"\u002Fetc\u002Fmysql\u002Fclient-key.pem"}]},{type:a,value:e}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:K,props:{start:dR},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:J,props:{},children:[{type:a,value:"From the database master"}]},{type:a,value:" (a.k.a \"masterdb\"), Get the replication log\nposition; We'll need the "},{type:b,tag:h,props:{},children:[{type:a,value:"File"}]},{type:a,value:bh},{type:b,tag:h,props:{},children:[{type:a,value:"Position"}]},{type:a,value:" values to setup the\nreplication node."}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,av]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"MariaDB [(none)]\u003E show master status;\n\u003E +------------------------+----------+--------------+------------------+\n\u003E | File                   | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n\u003E +------------------------+----------+--------------+------------------+\n\u003E | mariadbrepl-bin.000002 |      644 |              |                  |\n\u003E +------------------------+----------+--------------+------------------+\n"}]}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Configure the "},{type:b,tag:h,props:{},children:[{type:a,value:bW}]},{type:a,value:" to accept replication users. "},{type:b,tag:J,props:{},children:[{type:a,value:"From the salt\nmaster"}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,N]},children:[{type:b,tag:h,props:{},children:[{type:a,value:bY},{type:b,tag:c,props:{className:[d,D,z]},children:[{type:a,value:bZ}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'roles:masterdb'"}]},{type:a,value:" mysql.user_create replication_user "},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"'%'"}]},{type:a,value:" foobarbaz\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"NOTE: My salt states script creates a grain in "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fetc\u002Fsalt\u002Fgrains"}]},{type:a,value:" with the\nfollowing data;"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,al]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,m,t]},children:[{type:a,value:"roles"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:" masterdb\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Alternatively, you could call the VM "},{type:b,tag:h,props:{},children:[{type:a,value:"db1-masterdb"}]},{type:a,value:", use a "},{type:b,tag:j,props:{href:eY,rel:[o,p,q],target:r},children:[{type:a,value:"small python script\nthat'll parse the information for you and make it a "},{type:b,tag:J,props:{},children:[{type:a,value:"grain"}]},{type:a,value:"\nautomatically"}]},{type:a,value:". 8. "},{type:b,tag:J,props:{},children:[{type:a,value:"Back to the masterdb VM"}]},{type:a,value:", check if the user exists,\nensure SSL is required"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,av]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"MariaDB [(none)]\u003E show grants for 'replication_user';\n\u003E +---------------------------------------------------------------------------------------+\n\u003E | Grants for replication_user@%                                                         |\n\u003E +---------------------------------------------------------------------------------------+\n\u003E | GRANT REPLICATION SLAVE ON *.* TO 'replication_user'@'%' IDENTIFIED BY PASSWORD '...' |\n\u003E +---------------------------------------------------------------------------------------+\n\nMariaDB [(none)]\u003E GRANT REPLICATION SLAVE ON *.* TO 'replication_user'@'%.local.wpdn' REQUIRE SSL;\nMariaDB [(none)]\u003E GRANT USAGE ON *.* TO 'replication_user'@'%' REQUIRE SSL;\n\nMariaDB [(none)]\u003E SELECT User,Host,Repl_slave_priv,Repl_client_priv,ssl_type,ssl_cipher from mysql.user where User = 'replication_user';\n\u003E +------------------+--------------+-----------------+------------------+----------+\n\u003E | User             | Host         | Repl_slave_priv | Repl_client_priv | ssl_type |\n\u003E +------------------+--------------+-----------------+------------------+----------+\n\u003E | replication_user | %.local.wpdn | Y               | N                | ANY      |\n\u003E +------------------+--------------+-----------------+------------------+----------+\n"}]}]}]},{type:a,value:e},{type:b,tag:K,props:{start:9},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"On the secondary db VM, in mysql prompt, setup the initial "},{type:b,tag:h,props:{},children:[{type:a,value:"CHANGE MASTER"}]},{type:a,value:"\nstatement;"}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,av]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"CHANGE MASTER TO\n  MASTER_HOST='masterdb.local.wpdn',\n  MASTER_USER='replication_user',\n  MASTER_PASSWORD='foobarbaz',\n  MASTER_PORT=3306,\n  MASTER_LOG_FILE='mariadbrepl-bin.000002',\n  MASTER_LOG_POS=644,\n  MASTER_CONNECT_RETRY=10,\n  MASTER_SSL=1,\n  MASTER_SSL_CA='\u002Fetc\u002Fmysql\u002Fca-cert.pem',\n  MASTER_SSL_CERT='\u002Fetc\u002Fmysql\u002Fclient-cert.pem',\n  MASTER_SSL_KEY='\u002Fetc\u002Fmysql\u002Fclient-key.pem';\n"}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ad,props:{id:ee},children:[{type:b,tag:j,props:{href:"#checking-if-it-worked",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:ef}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"From one of the secondary servers, look for success indicators:"}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"Seconds_Behind_Master"}]},{type:a,value:eZ},{type:b,tag:J,props:{},children:[{type:a,value:cN}]},{type:a,value:au}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"Slave_IO_State"}]},{type:a,value:eZ},{type:b,tag:J,props:{},children:[{type:a,value:"Waiting for master to send event"}]}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,av]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"MariaDB [wpstats]\u003E show slave status\\G\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: masterdb.local.wpdn\n                  Master_User: replication_user\n                  Master_Port: 3306\n                Connect_Retry: 10\n              Master_Log_File: mariadbrepl-bin.000066\n          Read_Master_Log_Pos: 19382112\n               Relay_Log_File: mariadbrepl-relay-bin.000203\n                Relay_Log_Pos: 19382405\n        Relay_Master_Log_File: mariadbrepl-bin.000066\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB:\n          Replicate_Ignore_DB:\n           Replicate_Do_Table:\n       Replicate_Ignore_Table:\n      Replicate_Wild_Do_Table:\n  Replicate_Wild_Ignore_Table:\n                   Last_Errno: 0\n                   Last_Error:\n                 Skip_Counter: 0\n          Exec_Master_Log_Pos: 19382112\n              Relay_Log_Space: 19382757\n              Until_Condition: None\n               Until_Log_File:\n                Until_Log_Pos: 0\n           Master_SSL_Allowed: Yes\n           Master_SSL_CA_File: \u002Fetc\u002Fmysql\u002Fca-cert.pem\n           Master_SSL_CA_Path:\n              Master_SSL_Cert: \u002Fetc\u002Fmysql\u002Fclient-cert.pem\n            Master_SSL_Cipher:\n               Master_SSL_Key: \u002Fetc\u002Fmysql\u002Fclient-key.pem\n        Seconds_Behind_Master: 0\nMaster_SSL_Verify_Server_Cert: No\n                Last_IO_Errno: 0\n                Last_IO_Error:\n               Last_SQL_Errno: 0\n               Last_SQL_Error:\n  Replicate_Ignore_Server_Ids:\n             Master_Server_Id: 1\n               Master_SSL_Crl: \u002Fetc\u002Fmysql\u002Fca-cert.pem\n           Master_SSL_Crlpath:\n                   Using_Gtid: No\n                  Gtid_IO_Pos:\n      Replicate_Do_Domain_Ids:\n  Replicate_Ignore_Domain_Ids:\n1 row in set (0.00 sec)\n"}]}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ad,props:{id:eg},children:[{type:b,tag:j,props:{href:"#managing-users",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:eh}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In the end, since replication is active, you can add users to your system and\nall nodes will get the privileges."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The way I work is that I can use Salt stack states to add privileges in my\nstates (more details soon) or I can use a few salt commands from my salt master\nand send them to the database "},{type:b,tag:h,props:{},children:[{type:a,value:bW}]},{type:a,value:" VM."}]},{type:a,value:e},{type:b,tag:u,props:{className:[w]},children:[{type:b,tag:s,props:{className:[x,av]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"salt -G 'roles:masterdb' mysql.db_create 'accounts_oauth' 'utf8' 'utf8_general_ci'\nsalt -G 'roles:masterdb' mysql.user_create 'accounts' '%' 'barfoo'\nsalt -G 'roles:masterdb' mysql.grant_add 'ALL PRIVILEGES' 'accounts_oauth.*' 'accounts' ‘%’\n"}]}]}]},{type:a,value:e},{type:b,tag:ad,props:{id:ei},children:[{type:b,tag:j,props:{href:"#references",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:ej}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:e_,rel:[o,p,q],target:r},children:[{type:a,value:e_}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:e$,rel:[o,p,q],target:r},children:[{type:a,value:e$}]}]},{type:a,value:e}]},{type:a,value:e}]},dir:fa,path:"\u002Fblog\u002F2015\u002F01\u002Fcreate-mariadb-cluster-replication-ssl-salt-stack",extension:ak,slug:"create-mariadb-cluster-replication-ssl-salt-stack",createdAt:b$,updatedAt:b$,category:ag,prettyfiedTemporalDate:{prettified:"Wednesday, January 28, 2015",temporalDate:"2015-01-28"}},{title:"Quelques bouts de code pour automatiser le déploiement",locale:ca,created:dU,updated:"2015-02-17T00:00:00.000Z",canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F01\u002Fquelques-bouts-de-code-pour-automatiser-le-deploiement\u002F",status:aj,revising:C,migrateLinks:W,migrateImages:C,gallery:C,caption:C,categories:[ag],tags:[ac,fb,aO,ay],coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F01\u002Fautomate-all-the-things-300x284.png",srcset:["https:\u002F\u002Frenoirb.github.io\u002Fsite-assets\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F01\u002Fautomate-all-the-things-300x284.png 300w","https:\u002F\u002Frenoirb.github.io\u002Fsite-assets\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F01\u002Fautomate-all-the-things-1024x971.png 1024w","https:\u002F\u002Frenoirb.github.io\u002Fsite-assets\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F01\u002Fautomate-all-the-things.png 1600w"],sizes:fc,alt:"Illustration souvent utilisée pour un mème de l’Internet d’un dessin fait rapidement à la main illustrant un personnage avec une lumière éclatante derrière comme l’introduction d’un super héros. Le personnage tient un balai d’une main et brandissant l’autre bras et les yeux pas très alignés. Il proclame Automatisons tout!",text:"Automatisons Tout!!1\n"},preamble:{disable:W,text:l},excerpt:"Avez-vous déjà voulu automatiser le déploiement de votre infrastructure serveurs web de A-Z? C’est exactement sur quoi je travaille en ce moment.",toc:[{id:fd,depth:S,text:fe},{id:ff,depth:S,text:fg},{id:fh,depth:S,text:fi}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"Ce billet n’est qu’un simple «link dump» pour retrouver parmi plusieurs notes\néparpillés. Je compte éventuellement publier la totalité de mon travail dans des\nprojets publics sur GitHub une fois la boucle complétée. Le tout sans fournir\nles données privés, évidemment."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Faire le saut vers l’automatisation demande beaucoup de préparation et je prends\nle temps de publier ici quelques bouts de code que j’ai écrits pour compléter la\ntâche."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Au final, mon projet permettra de déployer un site qui s’appuie sur un cluster\nMariaDB, Memcached, une stack LAMP («prefork») lorsqu’on a pas le choix, une\nstack [HHVM\u002Fphp5-fpm, Python, nodejs] app servers pour le reste servi par un\nfrontend NGINX. Mes scripts vont déployer une série d’applications web avec\ntoutes les dépendances qui les adaptent géré dans leur propre «git repo» parent.\nDans mon cas, ce sera: WordPress, MediaWiki, Discourse, et quelques autres."}]},{type:a,value:e},{type:b,tag:Y,props:{id:fd},children:[{type:b,tag:j,props:{href:"#requis",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:fe}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Instantiation à partir de commandes "},{type:b,tag:h,props:{},children:[{type:a,value:bs}]},{type:a,value:" du terminal, crée une nouvelle VM\nmise à jour et son nom définit son rôle dans le réseau interne"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Les VMs sont uniquement accessible par un Jump box (i.e. réseau interne\nseulement)"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Un système regarde si un répertoire clone git à eu des changements sur la\nbranche «master», lance un événement si c’est le cas"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Chaque machine sont construites à partir d’une VM minimale. Dans ce cas-ci;\nUbuntu 14.04 LTS"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Système doit s’assurer que TOUTES les mises à jour sont appliqués\nrégulièrement"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Système doit s’assurer que ses services interne sont fonctionnels"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Dans le cas d’une situation où une VM atteint le seuil critique OOM, la VM\nredémarre automatiquement"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Le nom de la VM décrit son rôle, et les scripts d’installation installent les\nrequis qui y sont affectés"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Les configurations utilisent les détails (e.g. adresses IP privés et\npubliques) de chaque pool (e.g. redis, memcache, mariadb) et ajuste\nautomatiquement les configurations dans chaque application"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"... etc."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:Y,props:{id:ff},children:[{type:b,tag:j,props:{href:"#bouts-de-code",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:fg}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:dV,rel:[o,p,q],target:r},children:[{type:a,value:"Installation automatisée d’un cluster MariaDB avec réplication SSL"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fgist.github.com\u002FWebPlatformDocs\u002F6ecf0d852a9148741bef",rel:[o,p,q],target:r},children:[{type:a,value:"Configuration SSH pour accéder aux VMs du réseau interne"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fgist.github.com\u002FWebPlatformDocs\u002F437f763b948c926ca7ba",rel:[o,p,q],target:r},children:[{type:a,value:"Vérifier si un git repo a changé"}]},{type:a,value:", j’ai prévu faire un \"salt-call\" qui\ntrigger un événement Salt Reactor pour lancer un build run"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:fj,rel:[o,p,q],target:r},children:[{type:a,value:"Configuration Monit"}]},{type:a,value:" pour s’assurer que les services «sont up and running»"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:bU,rel:[o,p,q],target:r},children:[{type:a,value:"Installer automatiquement une VM enregistrée au salt-master"}]},{type:a,value:" via Salt\nReactor. Le nom de la VM déclare son rôle, le reste se fait tout seul\n(incomplet mais un début)"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fgist.github.com\u002Frenoirb\u002F1b42edac44c723185c9d",rel:[o,p,q],target:r},children:[{type:a,value:"Installer des plugins WordPress à partir des repos Git\u002FSVN\u002FFichiers Zip"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:fk,rel:[o,p,q],target:r},children:[{type:a,value:"Installation automatique d’un salt-master"}]},{type:a,value:" et des dépendances de build"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:eY,rel:[o,p,q],target:r},children:[{type:a,value:"Définir le rôle d’une VM basé sur son nom + TLD"}]},{type:a,value:" (e.g.\nredis-sessions.production.wpdn)"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fgist.github.com\u002Frenoirb\u002F11258261",rel:[o,p,q],target:r},children:[{type:a,value:"Vérifier avec l’origine d’un clone git s’il y a des changements upstream,\nlancer un événement si c’est le cas"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:bU,rel:[o,p,q],target:r},children:[{type:a,value:"Automatiser des commands selon certains événemnts dans un cluster géré par\nSalt"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:fk,rel:[o,p,q],target:r},children:[{type:a,value:"Automatiser l’installation d’un salt master basé uniquement sur une série de\ngit repos et d’un bootstrapper script"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"https:\u002F\u002Fgist.github.com\u002FWebPlatformDocs\u002Fe925fee9b6085d7cbec4",rel:[o,p,q],target:r},children:[{type:a,value:"Automatiser les backups ElasticSearch"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:fj,rel:[o,p,q],target:r},children:[{type:a,value:"Système pour s’assurer que tous les services son fonctionnels, comment tester\ns’ils fonctionnent et comment les redémarrer"}]},{type:a,value:" avec "},{type:b,tag:J,props:{},children:[{type:a,value:"Monit"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:Y,props:{id:fh},children:[{type:b,tag:j,props:{href:"#billets-inspirants-sur-le-sujet",ariaHidden:G,tabIndex:O},children:[{type:b,tag:c,props:{className:[P,Q]},children:[]}]},{type:a,value:fi}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"http:\u002F\u002Fblog.hendrikvolkmer.de\u002F2013\u002F04\u002F03\u002Fthere-will-be-no-reliable-cloud-part-1\u002F",rel:[o,p,q],target:r},children:[{type:a,value:"There will be no reliable cloud (part 1)"}]},{type:a,value:aC},{type:b,tag:j,props:{href:"http:\u002F\u002Fblog.hendrikvolkmer.de\u002F2013\u002F04\u002F09\u002Fthere-will-be-no-reliable-cloud-part-2\u002F",rel:[o,p,q],target:r},children:[{type:a,value:"part 2"}]},{type:a,value:aC},{type:b,tag:j,props:{href:"http:\u002F\u002Fblog.hendrikvolkmer.de\u002F2013\u002F04\u002F12\u002Fthere-will-be-no-reliable-cloud-part-3\u002F",rel:[o,p,q],target:r},children:[{type:a,value:"part 3"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"http:\u002F\u002Fblog.hendrikvolkmer.de\u002F2013\u002F10\u002F11\u002Fthe-missing-piece-operating-systems-for-web-scale-cloud-apps\u002F",rel:[o,p,q],target:r},children:[{type:a,value:"The missing piece operating systems for \"Web Scale\" Cloud Apps"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"http:\u002F\u002Fwww.rightbrainnetworks.com\u002Fblog\u002Fwhy-an-ec2-instance-isnt-a-server\u002F",rel:[o,p,q],target:r},children:[{type:a,value:"Why an X (VM) \"instance\" isn’t a server"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:j,props:{href:"http:\u002F\u002Fsamj.net\u002F2012\u002F03\u002F08\u002Fsimplifying-cloud-reliability\u002F",rel:[o,p,q],target:r},children:[{type:a,value:"Simplifying cloud reliability"}]}]},{type:a,value:e}]},{type:a,value:e}]},dir:fa,path:"\u002Fblog\u002F2015\u002F01\u002Fquelques-bouts-de-code-pour-automatiser-le-deploiement",extension:ak,slug:"quelques-bouts-de-code-pour-automatiser-le-deploiement",createdAt:b$,updatedAt:bT,category:ag,prettyfiedTemporalDate:{prettified:"mercredi 28 janvier 2015",temporalDate:"2015-01-28"}},{locale:ca,title:"Processus de création d'une VM faisant partie d'un parc géré par Salt Stack",canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2014\u002F01\u002Fprocessus-de-creation-dune-vm-faisant-partie-dun-parc-gere-par-salt-stack\u002F",status:aj,revising:W,caption:C,gallery:C,migrateCode:W,migrateImages:W,migrateLinks:W,created:"2014-01-22",updated:"2015-03-09",categories:[],tags:[ac,fl,fm,"logiciel-libre",ay],description:"Processus de création d'une VM faisant partie d'un parc Salt stack",coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2014\u002F01\u002Fsalt-spill-300x280.jpg",srcset:["~\u002Fassets\u002Fcontent\u002Fblog\u002F2014\u002F01\u002Fsalt-spill-300x280.jpg 300w","~\u002Fassets\u002Fcontent\u002Fblog\u002F2014\u002F01\u002Fsalt-spill.jpg 310w"],sizes:fc,alt:"Une salière a coté d’un déversement de sel, avec le mot sel écrit en anglais."},excerpt:"Voici une courte procédure décrivant comment je crée une nouvelle machine virtuelle et y applique les configurations automatiquement.",toc:[{depth:S,text:fn}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"A mon "},{type:b,tag:aV,props:{title:"I am joining the W3C to work on WebPlatform.org!",to:"\u002Fblog\u002F2013\u002F08\u002Fi-am-joining-w3c-to-work-on-the-webplatform-project\u002F"},children:[{type:a,value:"emploi "},{type:b,tag:v,props:{},children:[{type:a,value:"actuel"}]}]},{type:a,value:" je gère un parc de machines virtuelles (VMs) qui est automatisé par un système de gestion de configuration appelé "},{type:b,tag:J,props:{},children:[{type:b,tag:j,props:{href:fo,title:fp},children:[{type:a,value:bj}]}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:aP,props:{},children:[{type:a,value:ai},{type:b,tag:g,props:{},children:[{type:b,tag:j,props:{href:fo,title:fp},children:[{type:a,value:"Salt stack"}]},{type:a,value:" est un outil permettant de décrire quel est l’état désiré d’un serveur. Comme d’autres outils avec une utilité similaire, "},{type:b,tag:v,props:{},children:[{type:a,value:bj}]},{type:a,value:" peut être utilisé dans des "},{type:b,tag:v,props:{},children:[{type:a,value:"environnements hétérogènes"}]},{type:a,value:" sous "},{type:b,tag:J,props:{},children:[{type:a,value:"GNU\u002FLinux"}]},{type:a,value:aC},{type:b,tag:J,props:{},children:[{type:a,value:"Mac OS"}]},{type:a,value:", et "},{type:b,tag:J,props:{},children:[{type:a,value:"Windows"}]},{type:a,value:aC},{type:b,tag:J,props:{},children:[{type:a,value:"FreeBSD"}]},{type:a,value:", etc."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"L’environment que nous utilisons est un serveur avec des «blades». Chaque «blade» fournit les services créant un cluster OpenStack. Dans le futur, nous risquons d'avoir plus d'un fournisseur OpenStack. Pour automatiser comme nous l'aimons, nous utilisons grandement la ligne de commande avec le paquet "},{type:b,tag:h,props:{},children:[{type:a,value:bM}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Chaque machine virtuelle roule une version "},{type:b,tag:v,props:{},children:[{type:a,value:fq}]},{type:a,value:" («Long Term Support») de Ubuntu."}]},{type:a,value:e},{type:b,tag:aP,props:{},children:[{type:a,value:ai},{type:b,tag:g,props:{},children:[{type:a,value:"Absolument toutes les configurations sont appliqués via "},{type:b,tag:v,props:{},children:[{type:a,value:bj}]},{type:a,value:", la seule chose qui est fait manuellement en\n  ce moment est de créer la nouvelle instance, et de l'ajouter au «master» de Salt Stack."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Même là, ça risque de changer lorsque nous aurons déployé "},{type:b,tag:j,props:{href:"http:\u002F\u002Fwww.saltstack.com\u002Fsalt-cloud\u002F",title:"Salt Cloud, a Salt Stack component specialized in helping automating cloud deployment"},children:[{type:a,value:"Salt Cloud"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:Y,props:{},children:[{type:a,value:fn}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:J,props:{},children:[{type:a,value:"Mise à jour Mars 2015"}]},{type:a,value:": "},{type:b,tag:v,props:{},children:[{type:a,value:"Un nouvel article sur le même sujet"}]},{type:a,value:" a été écrit (en anglais) et illustre "},{type:b,tag:aV,props:{title:"Creating a new Ubuntu salt-master from the terminal using Cloud-Init",to:"\u002Fblog\u002F2015\u002F03\u002Fcreating-new-ubuntu-salt-master-terminal-using-cloud-init\u002F"},children:[{type:a,value:"comment faire une nouvelle VM avec encore moins d’étapes"}]}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Boot une nouvelle node avec Nova"}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"joe@master:~$ nova boot --image lucid-minion-template --flavor wpdn.large --key-name renoirb app6\n"}]}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Donner un nom en fonction du type de serveur a déployer avec un numéro à la fin. Exemple: "},{type:b,tag:h,props:{},children:[{type:a,value:"app6"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:v,props:{},children:[{type:a,value:dM}]},{type:a,value:" Dans mon cas, j'ai notamment: app, db, memcached, etc."}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Ajoute l'adresse floating dans "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fsrv\u002Fpillar\u002Fnodes\u002Finit.sls"}]},{type:a,value:" comme les autres"}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"nodes:\n  master:\n    public:  ####IP PUBLIQUE CACHÉE####\n    private: 10.0.0.1\n\n  app1:\n    public:  ####IP PUBLIQUE CACHÉE####\n    private: 10.0.0.7\n\n  memcache2:\n    public:  ####IP PUBLIQUE CACHÉE####\n    private: 10.0.0.4\n\n  app5:\n    public:  ####IP PUBLIQUE CACHÉE####\n    private: 10.0.0.3\n"}]}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Prend le fichier "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fhome\u002Fubuntu\u002Frunme"}]},{type:a,value:" de n'importe quel autre serveur et colle le dans la nouvelle machine. Puis execute ("},{type:b,tag:h,props:{},children:[{type:a,value:"sudo \u002Fbin\u002Fbash runme"}]},{type:a,value:aq}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Ajouter une ligne dans le nouveau serveir dans "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fetc\u002Fsalt\u002Fminion.d\u002Fmaster.conf"}]}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"id: app6\n"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"... Voir les autres nodes"}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Restart salt-minion"}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"ubuntu@node6:~$ sudo service salt-minion restart\n"}]}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Ajoute la clée au master"}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"joe@master:~$ sudo salt-key -a app6\n"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"... Le '-a foo' est optionnel et tu peux lister Les nodes."}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Run state.highstate"}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"joe@master:~$ sudo salt app6 state.highstate\n"}]}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Uploader le code via rsync dans la nouvelle app node, puis re-rouler state.highstate (certains scripts prennent pour aquis que le code est déjà déployé)"}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"joe@master:~$ sudo salt app6 state.sls code.node_app\njoe@master:~$ sudo salt app6 state.highstate\n"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Comme je disais, parfois, le premier "},{type:b,tag:h,props:{},children:[{type:a,value:eC}]},{type:a,value:" ne marche pas a cause du code pas déployé."}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Rafraichir les autorisations pour storage"}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"joe@master:~$ sudo salt 'storage*' state.highstate\njoe@master:~$ sudo salt 'monitor*' state.highstate\n"}]}]}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"Updater le hosts file de quelque nodes"}]},{type:a,value:e},{type:b,tag:s,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"joe@master:~$ sudo salt 'app*' state.sls hosts\njoe@master:~$ sudo salt 'db*' state.sls hosts\njoe@master:~$ sudo salt 'memcache*' state.sls hosts\n"}]}]}]},{type:a,value:e}]},{type:a,value:e}]},dir:"\u002Fblog\u002F2014\u002F01",path:"\u002Fblog\u002F2014\u002F01\u002Fprocessus-de-creation-dune-vm-faisant-partie-dun-parc-gere-par-salt-stack",extension:ak,slug:"processus-de-creation-dune-vm-faisant-partie-dun-parc-gere-par-salt-stack",createdAt:fr,updatedAt:fr,category:"",prettyfiedTemporalDate:{prettified:"mercredi 22 janvier 2014",temporalDate:"2014-01-22"}},{locale:ar,title:"Project idea: Creating a home made OpenStack cluster for development purposes",canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2013\u002F10\u002Fproject-idea-creating-a-home-made-openstack-cluster-for-development-purposes\u002F",status:aj,revising:W,created:"2013-10-24",updated:"2014-02-04",tags:[ac,fb,fl,as,ay],categories:[fs],coverImage:{src:"~\u002Fassets\u002Fcontent\u002Fblog\u002F2013\u002F10\u002Fcomputercloud-218x300.jpg",srcset:["~\u002Fassets\u002Fcontent\u002Fblog\u002F2013\u002F10\u002Fcomputercloud-218x300.jpg 218w","~\u002Fassets\u002Fcontent\u002Fblog\u002F2013\u002F10\u002Fcomputercloud.jpg 462w"],sizes:"(max-width: 218px) 100vw, 218px",alt:"Decorative image of a laptop floating in front of a cloudy sky."},description:"The idea of the project is to give an alternate life to a mostly unused laptops a second life.",excerpt:"At work, I use an OpenStack environment and a few Salt states to manage a set of virtual machines. I'd like to give another life to two old laptops that spend most of their time shut down, but without changing or using their local hard drives.",toc:[{depth:_,text:ft},{depth:_,text:fu},{depth:_,text:fv},{depth:_,text:fw},{depth:_,text:fx}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"Think about it. How about using spare computers to create a homemade OpenStack cluster for development."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"We can do that from our cloud provider, or create a separate project or even use Wikimedia's OpenStack infrastructure allowance for the project."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"With such setup, one could work locally with his Salt stack (or Puppet, or Ansible) deployment schemes, try them, trash "},{type:b,tag:aM,props:{},children:[{type:a,value:"VMs"}]},{type:a,value:", rebuild."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The beauty of it would be that it could be made in a fashion that would not even modify the computer running the VMs. The cluster member running OpenStack hypervisor would be installed seeded through net boot. Not booting from the network would revert the computer back as if it never been used."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Here is what I think would require to make this happen."}]},{type:a,value:e},{type:b,tag:ad,props:{},children:[{type:a,value:ft}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Not use Computer\u002FLaptop local hard drive"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Rely only on net boot"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ad,props:{},children:[{type:a,value:fu}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"1..n Computers\u002Flaptop supporting netboot"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"1 Storage device supporting one or more storage protocol ("},{type:b,tag:aM,props:{},children:[{type:a,value:"nfs"}]},{type:a,value:", samba, "},{type:b,tag:aM,props:{},children:[{type:a,value:"sshfs"}]},{type:a,value:aq}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ad,props:{},children:[{type:a,value:fv}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:fy},{type:b,tag:aM,props:{},children:[{type:a,value:fz}]},{type:a,value:" providing tftp, dhcp, dns to serve as net boot server that should run outide of the cluster (\"Networking node\")"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:fy},{type:b,tag:aM,props:{},children:[{type:a,value:fz}]},{type:a,value:" image of OpenStack controller (\"OpS controller\")"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"1 LiveCD+persistent image with OpenStack preinstalled, configured to use storage device credentials as it's root filesystem (\"OpS Hypervisor\")"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ad,props:{},children:[{type:a,value:fw}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"Networking node can be the smallest Linux possible, on a RaspberryPI, or a modified Router or Network Attached storage device?"}]},{type:a,value:e},{type:b,tag:i,props:{},children:[{type:a,value:"OpS Hypervisor to be among the supported OpenStack distributions (I think a Ubuntu precise 12.04 "},{type:b,tag:aM,props:{},children:[{type:a,value:fq}]},{type:a,value:" or a variant such as Puppy Linux might work too)"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ad,props:{},children:[{type:a,value:fx}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"I will keep you posted whenever possible on the outcome of my research."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Did you ever do this in your infra. Leave a comment."}]}]},dir:"\u002Fblog\u002F2013\u002F10",path:"\u002Fblog\u002F2013\u002F10\u002Fproject-idea-creating-a-home-made-openstack-cluster-for-development-purposes",extension:ak,slug:"project-idea-creating-a-home-made-openstack-cluster-for-development-purposes",createdAt:fA,updatedAt:fA,category:fs,prettyfiedTemporalDate:{prettified:"Thursday, October 24, 2013",temporalDate:"2013-10-24"}},{locale:ca,title:"What is Cloud computing when it is related to web application",canonical:"https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2012\u002F08\u002Fwhat-is-cloud-computing-when-it-is-related-to-web-application\u002F",status:aj,revising:W,created:"2012-08-15",updated:"2013-03-27",tags:["architecture",fm,ac,en,dW],categories:[fB],excerpt:"Some guidelines on what is Cloud Computing related to the scaling point of view. This is the continuity of the thread about a shopping cart and payment gateway commerce site using a CMS. The conversation persisted on what to do and look for cloud hosting.",toc:[{depth:_,text:fC},{depth:_,text:fD},{depth:_,text:fE}],body:{type:ae,children:[{type:b,tag:g,props:{},children:[{type:a,value:"During the discussion, the contributor persisted on knowing what would be considered and thresholds to use some kind of push-button-scaling."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Knowing his context, "},{type:b,tag:aV,props:{to:"\u002Fblog\u002F2012\u002F08\u002Fsome-steps-you-can-look-for-if-you-feel-your-web-application-is-slow"},children:[{type:a,value:"a unzipped install CMS with a buch of plugins"}]},{type:a,value:" I felt the urge to explain that there is not always need to get a bigger server capacity. Here is an overview of what I mean when I talk about cloud computing and continuous integration."}]},{type:a,value:e},{type:b,tag:ad,props:{},children:[{type:a,value:fC}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Let's talk about cloud! "}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"I mean in the web application hosting realm. Not the storage (Google Drive, Dropbox) or software as a service (Salesforce, Basecamp)."}]},{type:a,value:e},{type:b,tag:"h4",props:{},children:[{type:a,value:"Let's talk about a use case before and my own experience."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"My former company "},{type:b,tag:j,props:{href:"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20110808064111\u002Fhttp:\u002F\u002Fevo.cat.io\u002F",rel:[o]},children:[{type:a,value:"Evocatio Solutions technologiques"}]},{type:a,value:" manage a pretty large site at the domain "},{type:b,tag:j,props:{href:"https:\u002F\u002Fuda.ca\u002F"},children:[{type:a,value:"uda.ca"}]},{type:a,value:$}]},{type:a,value:e},{type:b,tag:ad,props:{},children:[{type:a,value:fD}]},{type:a,value:"\nThis is a complete business management web application that manages an union who represents french speaking artists in north america (mostly residents of Canada).  We built a complete web application that manages many aspects an artist needs to represent themselves and be found. A big part of it is a 140 tables worth of artist description listing details as small a hair length and types of musical instruments to voice tones. It also manages renewal, communication with agencies, portfolios, and management of contracts with managers and more.\n"},{type:b,tag:g,props:{},children:[{type:a,value:"Not to forget the very heavy databases queries we generate to search, for example: \u003Cexample\u003EAn "},{type:b,tag:v,props:{},children:[{type:a,value:"asian woman"}]},{type:a,value:" with "},{type:b,tag:v,props:{},children:[{type:a,value:"white hair"}]},{type:a,value:" playing "},{type:b,tag:v,props:{},children:[{type:a,value:"yuku lélé"}]},{type:a,value:" who can "},{type:b,tag:v,props:{},children:[{type:a,value:"pilot helicopter"}]},{type:a,value:" AND ride "},{type:b,tag:v,props:{},children:[{type:a,value:"motorcycle"}]},{type:a,value:" ...\u003C\u002Fexample\u003E"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Yes. Database queries get very big, very quickly. Not only in the search engine I described, but through all the features."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"That, to my opinion, is heavy. Also considering that that Artist's Union has several thousand members."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"This information is on top of my head, please do not take this into real numbers, I did not look the latest deployment needs.  But for the server side, it only uses a simple Virtual machine with 4Gb of RAM give or take."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"That is my point about expanding hosting without optimizing stuff around."}]},{type:a,value:e},{type:b,tag:ad,props:{},children:[{type:a,value:fE}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Amazon and other Cloud service is about mostly about automated server deployment."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"But the powerful offering of \"scale tour application\" with computing cubes that automatically scales requires more than just nodes."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"It requires the code (here again) to support:"}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:a_},{type:b,tag:i,props:{},children:[{type:a,value:"multiple databases hosts and types support (Cassandra, Solr, MySQL) specialized for the type of data to store"}]},{type:a,value:a_},{type:b,tag:i,props:{},children:[{type:a,value:"User upload files replication"}]},{type:a,value:a_},{type:b,tag:i,props:{},children:[{type:a,value:"Database\u002FKeystore (CouchDB, Mongo)"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"All spanable on multiple hosts by a mere change of one configuration file."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The code itself should:"}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:a_},{type:b,tag:i,props:{},children:[{type:a,value:"Be deployable by a simple phing\u002Fant\u002Fnant task"}]},{type:a,value:a_},{type:b,tag:i,props:{},children:[{type:a,value:"Hosted on a NAS mount that you could create an other machine and use when time of computing need happens"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"All this (for some parts)  is what is called "},{type:b,tag:j,props:{href:"http:\u002F\u002Fagile.dzone.com\u002Farticles\u002Fdigg-using-continuous"},children:[{type:a,value:"Continuous integration"}]},{type:a,value:bg},{type:b,tag:j,props:{href:"http:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FContinuous_integration"},children:[{type:a,value:"Wikipedia"}]},{type:a,value:") some "},{type:b,tag:j,props:{href:"http:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F425692\u002Fwhat-is-your-preferred-php-deployment-strategy",title:"Reference on some good deployment strategies"},children:[{type:a,value:"deployment strategies"}]},{type:a,value:bg},{type:b,tag:j,props:{href:"http:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F2180460\u002Fsetting-up-a-deployment-build-ci-cycle-for-php-projects",title:"Other relevant StackOverflow thread"},children:[{type:a,value:"also here"}]},{type:a,value:bh},{type:b,tag:j,props:{href:"http:\u002F\u002Ferichogue.ca\u002F2011\u002F05\u002Fphp\u002Fcontinuous-integration-in-php\u002F",title:"Blog post and presentation about Continous Integration by EricHogue"},children:[{type:a,value:"this blog post too"}]},{type:a,value:"), and most of the time. It's not just the continuity and automation that matters, but the underlying deployment mechanism can be provided by third parties, like "},{type:b,tag:j,props:{href:"http:\u002F\u002Fwww.iamproblematic.com\u002Fwhy-i-like-heroku\u002F",title:"Blog post about what is nice about Heroku"},children:[{type:a,value:"Heroku"}]},{type:a,value:" and many others."}]}]},dir:"\u002Fblog\u002F2012\u002F08",path:"\u002Fblog\u002F2012\u002F08\u002Fwhat-is-cloud-computing-when-it-is-related-to-web-application",extension:ak,slug:"what-is-cloud-computing-when-it-is-related-to-web-application",createdAt:"2024-10-24T19:43:51.713Z",updatedAt:"2024-10-24T19:43:51.714Z",category:fB,prettyfiedTemporalDate:{prettified:"mercredi 15 août 2012",temporalDate:"2012-08-15"}}],taxonomyKey:ac,taxonomy:{key:ac,human:{key:ac,text:"Info Nuagique",description:"Essais écrits sur mes observations de projets\u002Fproduits\nqui prennent avantage de la virtualisation et de l’infrastructure\net\u002Fou l’InfoNuagique\n"}}}],fetch:[],mutations:void 0}}("text","element","span","token","\n","punctuation","p","code","li","a","-"," ","key",":","nofollow","noopener","noreferrer","_blank","pre","atrule","div","em","nuxt-content-highlight","line-numbers","operator","variable","\n    ","keyword",false,"parameter","\u003E","function","true","string","\\","strong","ol","directive",";","language-bash",-1,"icon","icon-link","comment",2,"{","number","}",true,"|","h2","ul",3,".","\n        ","---","cloud-computing","h3","root","=","projects","boolean","\n  ","publish",".md","language-yaml","app-image","attr-name","value","attr-value",")","en-CA","linux","float:unset;",",","language-text","     ","Fastly","salt-stack","important","install","unchanged",", ","[","\n      ","]","Cloud-Init","\n     ","define","(","single-quoted-string","double-quoted-string","abbr","2023-02-18T00:00:00.000Z","operations","blockquote","class","IN","type","prefix","line","nuxt-link","builtin","class-name","-y"," salt","\n\t","A","CNAME","443","server","      ","include","snippet"," ("," and ","upstream","Salt Stack"," grep ","q ","2024-10-24T19:43:51.724Z","https:\u002F\u002Fcloudinit.readthedocs.org\u002Fen\u002Flatest\u002F","Cloud-Init reference documentation pages","OpenStack Cloud-Init dialog","https:\u002F\u002Fwww.digitalocean.com\u002Fcommunity\u002Ftutorials\u002Fan-introduction-to-cloud-config-scripting","false","nova","mkdir"," apt","listen","server_name","2024-10-24T19:43:51.726Z","0000","1","curl","2024-10-24T19:43:51.725Z","frontend",4,"\n\n","\n\n    ","cmd.run","An introduction to cloud-config scripting","--image"," Ubuntu-14.04-Trusty ","--key_name","--flavor","python-novaclient","procedure","cd","apt-get","${pecl_memcached_ver}","-p","cp","2024-10-24T19:43:51.723Z","https:\u002F\u002Fgist.github.com\u002FWebPlatformDocs\u002F563cb12326b92b22a452","10.10","masterdb","2014.7","salt ","-G","bind-address","2024-10-24T19:43:51.722Z","fr-CA","webplatform","Discourse","Docker","Varnish","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F11\u002Fdiscourse_migration_list_gravatar_images.png","Side by side comparison while working on migrating Discourse\nwith WICG\n","It is possible the code shown here no longer works.\nMaybe the code shown here uses parts of Discourse that no longer exists.\n","proposed-setup","Proposed setup","https:\u002F\u002Fmeta.discourse.org\u002Ft\u002Ffull-site-cdn-acceleration-for-discourse\u002F21467\u002F1","@sam","http:\u002F\u002Fexample.org\u002F","discoursepolling.example.org","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F04\u002Fdiscuss-fastly-origins.png","Fastly service configuration, at Hosts tab","Configure -\u003E Hosts","language-dns-zone-file","language-nginx"," discoursepolling.example.org discourse.example.org"," ssl","webplatform.org","\u002Fblog\u002F2015\u002F05","~\u002Fassets\u002Fcontent\u002Fblog\u002F2015\u002F05\u002Fwebplatform-openstack-cluster-2014-10-06.png","get-openstack-instance-detail-using-salt","Get OpenStack instance detail using Salt","what-data-you-can-get","What data you can get","what-does-the-script-do","What does the script do?","Install","https:\u002F\u002Fgithub.com\u002Fsaltstack\u002Fsalt-contrib\u002Fblob\u002Fmaster\u002Fgrains\u002Fec2_info.py","security-groups","7c55","4dd3","a00000000000\n","app1","availability_zone","\n            vda\n        ","0","name","...","\n        None\n    ","http:\u002F\u002Fdocs.openstack.org\u002Fadmin-guide-cloud\u002Fcontent\u002Fsection_metadata-service.html","coord","inserted","Enable a CDN for your Discourse","setup-detail","Setup detail","steps","Steps","\"","https:\u002F\u002Fdocs.fastly.com\u002Fguides\u002Fssl\u002Fwhich-ssl-options-are-available","\u002Fblog\u002F2015\u002F05\u002Fmake-discourse-long-polling-work-behind-fastly\u002F","Make Discourse \"long polling\" work behind\nFastly","SSL between ","keepalive","frontends"," tld ","on","\"\"","GNU","A common task while writing server configuration management manifests is to make sure that some enforcements are run in specific situations.","add-group-additional-membership-to-user","Add group additional membership to user","change-ownership-on-a-folder-only-if-its-not-what-we-expect","usermod -a -G amavis clamav","unless","user","\u002Fblog\u002F2015\u002F03","read-more","Read more","Easily automate The provisioning of your DigitalOcean Droplets ... using Cloud-Init","2013","#cloud-config","nova boot ","\n     --security-groups default ","\u002Fsrv\u002Fcloudconfig.yml","\u002Fetc\u002Fprofile.d\u002F","build-from-pecl-source","Build from PECL source","make-a-deb-package","Make a .deb package","update-your-private-apt-repository-or-create-one","Update your private apt repository (or create one)","screenshots","Screenshots","igbinary","apt","https:\u002F\u002Fgithub.com\u002Fjordansissel\u002Ffpm","fpm",".deb","NOTE","https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F24407095\u002Ferror-when-installing-pecl-memcached\u002F28597188#answer-24892703"," \u002Ftmp\u002Fphp5-memcached\n","dpkg ","grep",6,"w-1\u002F3","Create a MariaDB cluster with replication over SSL with Salt Stack","2015-01-28T00:00:00.000Z","https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F01\u002Fcreate-mariadb-cluster-replication-ssl-salt-stack\u002F","techniques","changing-mariadb-replication-master","Changing MariaDB replication master","Procedure","assumptions","Assumptions","from-the-salt-master-initiate-a-few-vms-to-use-for-your-database-cluster","From the salt-master, initiate a few VMs to use for your database cluster","now-on-each-database-server","Now on each database server;","checking-if-it-worked","Checking if it worked","managing-users","Managing users","references","References","userdata.txt","app-alert-box","While migrating this article...","software","get "," renoirb-production ","-a","..",". "," ACTIVE  "," Running     "," private-network","hosts_entries"," www","data\n    ","'pillar.get'","language-php","  ","state.highstate","'roles:db'"," db2:\n","10.1",".2-MariaDB-1~trusty-wsrep-log\n"," db1-masterdb:\n","     ca-cert.pem\n","     ca-key.pem\n","     client-cert.pem\n","     client-key.pem\n","     client-req.pem\n","     server-cert.pem\n","     server-key.pem\n","     server-req.pem\n","ssh","server_id","section","section-name","selector","\nssl\n","ssl-cert","ssl-key","https:\u002F\u002Fgist.github.com\u002Frenoirb\u002Fb2e0222ad52e5d453298"," says ","http:\u002F\u002Fdev.mysql.com\u002Fdoc\u002Frefman\u002F5.7\u002Fen\u002Freplication-solutions-ssl.html","https:\u002F\u002Fmariadb.com\u002Fkb\u002Fen\u002Fmariadb\u002Fdocumentation\u002Fmanaging-mariadb\u002Freplication\u002Fstandard-replication\u002Fsetting-up-replication\u002F","\u002Fblog\u002F2015\u002F01","development","(max-width: 300px) 100vw, 300px","requis","Requis","bouts-de-code","Bouts de code","billets-inspirants-sur-le-sujet","Billets inspirants sur le sujet","https:\u002F\u002Fgist.github.com\u002FWebPlatformDocs\u002F780307ff289864ba02f5","https:\u002F\u002Fgist.github.com\u002Frenoirb\u002Fa66b533c46ef7a8de8e3","favourites","best-practices","Procédure","http:\u002F\u002Fwww.saltstack.com\u002Fcommunity\u002F","Salt Stack, The Salt Open Source Software Project","LTS","2024-10-24T19:43:51.720Z","projets","Limitations","Material","Hardware requirements","Distribution choice factors","To be continued...","1 ","VM","2024-10-24T19:43:51.719Z","tranche-de-vie","The E-Mail","The use-case on my recent experience","What your web application has to consider then")));