__NUXT_JSONP__("/blog/2015/03/useful-gnulinux-truth-tests", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U){return {data:[{},{},{},{canonical:B,content:{title:"A few useful GNU\u002FLinux truth tests while creating salt states",locale:q,created:"2015-03-10T00:00:00.000Z",updated:"2023-02-18T00:00:00.000Z",canonical:B,status:"publish",revising:C,caption:k,caracteresBizzares:k,gallery:k,migrateCode:C,migrateImages:k,migrateLinks:k,categories:[D],tags:["linux","salt-stack","cloud-computing","procedures"],keywords:["GNU","usermod"],description:E,excerpt:E,toc:[{id:F,depth:G,text:H},{id:I,depth:G,text:"Change ownership on a folder only if its not what we expect"}],body:{type:r,children:[{type:b,tag:s,props:{},children:[{type:a,value:"Nothing amazing here, just that in some situations I want to run commands in\nsalt stack only in some situations that should be enforced."}]},{type:a,value:f},{type:b,tag:s,props:{},children:[{type:a,value:"Those tests are written within Salt stack states and YAML, but the test are\nplain GNU\u002FLinux "},{type:b,tag:m,props:{},children:[{type:a,value:"tests"}]},{type:a,value:"."}]},{type:a,value:f},{type:b,tag:J,props:{id:F},children:[{type:b,tag:K,props:{ariaHidden:L,href:"#add-group-additional-membership-to-user",tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:H}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:m,props:{},children:[{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"'grep \"^amavis\" \u002Fetc\u002Fgroup | grep -q -e clamav'"}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:s,props:{},children:[{type:a,value:"A similar alternate could also be"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:m,props:{},children:[{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" grep "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"q "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"e '^amavis."},{type:b,tag:c,props:{className:[d,"important"]},children:[{type:a,value:"*clamav$'"}]},{type:a,value:" \u002Fetc\u002Fgroup\n"}]}]}]},{type:a,value:f},{type:b,tag:J,props:{id:I},children:[{type:b,tag:K,props:{ariaHidden:L,href:"#change-ownership-on-a-folder-only-if-its-not-what-we-expect",tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:"Change ownership on a folder "},{type:b,tag:"strong",props:{},children:[{type:a,value:"only if"}]},{type:a,value:" its not what we expect"}]},{type:a,value:f},{type:b,tag:t,props:{className:[u]},children:[{type:b,tag:v,props:{className:[w,x]},children:[{type:b,tag:m,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"% for es_folder in "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"["}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"'\u002Fusr\u002Fshare\u002Felasticsearch\u002Fdata'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:","}]},{type:a,value:R},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"'\u002Fvar\u002Flib\u002Felasticsearch'"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"]"}]},{type:a,value:" %"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\nchown "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"R app"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"user"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"app"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"user "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" es_folder "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:y},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:A},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"onlyif"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"\"test `stat -c %G {{ es_folder }}` != app-user\""}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"% endfor %"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:f}]}]}]}]},text:"---\ntitle: A few useful GNU\u002FLinux truth tests while creating salt states\nlocale: en-CA\ncreated: 2015-03-10\nupdated: 2023-02-18\ncanonical: https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F03\u002Fuseful-gnulinux-truth-tests\u002F\nstatus: publish\nrevising: true\ncaption: false\ncaracteresBizzares: false\ngallery: false\nmigrateCode: true\nmigrateImages: false\nmigrateLinks: false\ncategories:\n  - snippet\ntags:\n  - linux\n  - salt-stack\n  - cloud-computing\n  - procedures\nkeywords:\n  - GNU\n  - usermod\ndescription: \u003E-\n  A common task while writing server configuration management manifests is to\n  make sure that some enforcements are run in specific situations.\nexcerpt: \u003E-\n  A common task while writing server configuration management manifests is to\n  make sure that some enforcements are run in specific situations.\n---\n\nNothing amazing here, just that in some situations I want to run commands in\nsalt stack only in some situations that should be enforced.\n\nThose tests are written within Salt stack states and YAML, but the test are\nplain GNU\u002FLinux `tests`.\n\n## Add group additional membership to user\n\n```yaml\nusermod -a -G amavis clamav:\n  cmd.run:\n    - unless: 'grep \"^amavis\" \u002Fetc\u002Fgroup | grep -q -e clamav'\n```\n\nA similar alternate could also be\n\n```yaml\nusermod -a -G amavis clamav:\n  cmd.run:\n    - unless: grep -q -e '^amavis.*clamav$' \u002Fetc\u002Fgroup\n```\n\n## Change ownership on a folder **only if** its not what we expect\n\n```yaml\n{% for es_folder in [\n      '\u002Fusr\u002Fshare\u002Felasticsearch\u002Fdata',\n      '\u002Fvar\u002Flib\u002Felasticsearch'\n] %}\nchown -R app-user:app-user {{ es_folder }}:\n  cmd.run:\n    - onlyif: \"test `stat -c %G {{ es_folder }}` != app-user\"\n{% endfor %}\n```\n",dir:"\u002Fblog\u002F2015\u002F03",path:"\u002Fblog\u002F2015\u002F03\u002Fuseful-gnulinux-truth-tests",extension:".md",slug:S,createdAt:T,updatedAt:T,category:D},coverImage:{toc:[],body:{type:r,children:[]},text:U},month:"03",next:{title:"Install Discourse and Docker on Ubuntu 14.04 with aufs enabled",locale:q,path:"\u002Fblog\u002F2015\u002F04\u002Finstall-discourse-docker-ubuntu-14-04-aufs-enabled",slug:"install-discourse-docker-ubuntu-14-04-aufs-enabled"},preamble:{toc:[],body:{type:r,children:[]},text:U},prettyfiedTemporalDate:{prettified:"Tuesday, March 10, 2015",temporalDate:"2015-03-10"},prev:{title:"Creating a new Ubuntu Salt master from the terminal using Cloud-Init",locale:q,path:"\u002Fblog\u002F2015\u002F03\u002Fcreating-new-ubuntu-salt-master-terminal-using-cloud-init",slug:"creating-new-ubuntu-salt-master-terminal-using-cloud-init"},slug:S,year:"2015"}],fetch:[],mutations:void 0}}("text","element","span","token","punctuation","\n",":","key","atrule","-",false," ","code","string","{","}","en-CA","root","p","div","nuxt-content-highlight","pre","language-yaml","line-numbers","\n  ","cmd.run","\n    ","https:\u002F\u002Frenoirboulanger.com\u002Fblog\u002F2015\u002F03\u002Fuseful-gnulinux-truth-tests\u002F",true,"snippet","A common task while writing server configuration management manifests is to make sure that some enforcements are run in specific situations.","add-group-additional-membership-to-user",2,"Add group additional membership to user","change-ownership-on-a-folder-only-if-its-not-what-we-expect","h2","a","true",-1,"icon","icon-link","usermod -a -G amavis clamav","unless","\n      ","useful-gnulinux-truth-tests","2024-10-24T19:43:51.724Z","")));